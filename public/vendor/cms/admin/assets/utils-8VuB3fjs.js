import{_ as ce,aF as me,b as V,w as d,aP as ve,o as m,a as h,i as he,aQ as ge,c as p,F as O,a4 as E,j as te,f as w,aR as pe,l as C,t as g,aS as ye,aT as we,a6 as Ce,a7 as U,aw as ke,a8 as P,aU as _e,d as H,aV as b,aW as ne,n as z,a1 as re,aX as ae,k as Z,aJ as se,aY as Ve}from"../index.js";const Te={props:{item:{type:Object,required:!0}},setup(){return{drawer:me()}},computed:{values(){const t={};return this.item.id&&(t[this.$gettext("id")]=this.item.id),this.item.mime&&(t[this.$gettext("mime")]=this.item.mime),this.item.editor&&(t[this.$gettext("editor")]=this.item.editor),this.item.created_at&&(t[this.$gettext("created")]=new Date(this.item.created_at).toLocaleString(this.$vuetify.locale.current)),this.item.updated_at&&(t[this.$gettext("updated")]=new Date(this.item.updated_at).toLocaleString(this.$vuetify.locale.current)),this.item.deleted_at&&(t[this.$gettext("deleted")]=new Date(this.item.deleted_at).toLocaleString(this.$vuetify.locale.current)),t}}};function Le(t,e,n,s,l,r){return m(),V(ve,{modelValue:s.drawer.aside,"onUpdate:modelValue":e[0]||(e[0]=i=>s.drawer.aside=i),"mobile-breakpoint":"md",location:"end"},{default:d(()=>[h(he,{opened:[0]},{default:d(()=>[h(ge,{value:0},{activator:d(({props:i})=>[h(te,ye(we(i)),{default:d(()=>[C(g(t.$gettext("Meta data")),1)]),_:2},1040)]),default:d(()=>[(m(!0),p(O,null,E(r.values,(i,o)=>(m(),V(te,{key:o,rounded:"lg"},{default:d(()=>[h(pe,{class:"name"},{default:d(()=>[C(g(o),1)]),_:2},1024),w("div",null,g(i),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Ze=ce(Te,[["render",Le],["__scopeId","data-v-602996ad"]]);function k(){}k.prototype={diff:function(e,n){var s,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=l.callback;typeof l=="function"&&(r=l,l={});var i=this;function o(v){return v=i.postProcess(v,l),r?(setTimeout(function(){r(v)},0),!0):v}e=this.castInput(e,l),n=this.castInput(n,l),e=this.removeEmpty(this.tokenize(e,l)),n=this.removeEmpty(this.tokenize(n,l));var a=n.length,u=e.length,f=1,c=a+u;l.maxEditLength!=null&&(c=Math.min(c,l.maxEditLength));var L=(s=l.timeout)!==null&&s!==void 0?s:1/0,T=Date.now()+L,y=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(y[0],n,e,0,l);if(y[0].oldPos+1>=u&&_+1>=a)return o(ie(i,y[0].lastComponent,n,e,i.useLongestToken));var I=-1/0,x=1/0;function q(){for(var v=Math.max(I,-f);v<=Math.min(x,f);v+=2){var D=void 0,A=y[v-1],M=y[v+1];A&&(y[v-1]=void 0);var j=!1;if(M){var K=M.oldPos-v;j=M&&0<=K&&K<a}var ee=A&&A.oldPos+1<u;if(!j&&!ee){y[v]=void 0;continue}if(!ee||j&&A.oldPos<M.oldPos?D=i.addToPath(M,!0,!1,0,l):D=i.addToPath(A,!1,!0,1,l),_=i.extractCommon(D,n,e,v,l),D.oldPos+1>=u&&_+1>=a)return o(ie(i,D.lastComponent,n,e,i.useLongestToken));y[v]=D,D.oldPos+1>=u&&(x=Math.min(x,v-1)),_+1>=a&&(I=Math.max(I,v+1))}f++}if(r)(function v(){setTimeout(function(){if(f>c||Date.now()>T)return r();q()||v()},0)})();else for(;f<=c&&Date.now()<=T;){var R=q();if(R)return R}},addToPath:function(e,n,s,l,r){var i=e.lastComponent;return i&&!r.oneChangePerToken&&i.added===n&&i.removed===s?{oldPos:e.oldPos+l,lastComponent:{count:i.count+1,added:n,removed:s,previousComponent:i.previousComponent}}:{oldPos:e.oldPos+l,lastComponent:{count:1,added:n,removed:s,previousComponent:i}}},extractCommon:function(e,n,s,l,r){for(var i=n.length,o=s.length,a=e.oldPos,u=a-l,f=0;u+1<i&&a+1<o&&this.equals(s[a+1],n[u+1],r);)u++,a++,f++,r.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return f&&!r.oneChangePerToken&&(e.lastComponent={count:f,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=a,u},equals:function(e,n,s){return s.comparator?s.comparator(e,n):e===n||s.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],s=0;s<e.length;s++)e[s]&&n.push(e[s]);return n},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function ie(t,e,n,s,l){for(var r=[],i;e;)r.push(e),i=e.previousComponent,delete e.previousComponent,e=i;r.reverse();for(var o=0,a=r.length,u=0,f=0;o<a;o++){var c=r[o];if(c.removed)c.value=t.join(s.slice(f,f+c.count)),f+=c.count;else{if(!c.added&&l){var L=n.slice(u,u+c.count);L=L.map(function(T,y){var _=s[f+y];return _.length>T.length?_:T}),c.value=t.join(L)}else c.value=t.join(n.slice(u,u+c.count));u+=c.count,c.added||(f+=c.count)}}return r}function le(t,e){var n;for(n=0;n<t.length&&n<e.length;n++)if(t[n]!=e[n])return t.slice(0,n);return t.slice(0,n)}function oe(t,e){var n;if(!t||!e||t[t.length-1]!=e[e.length-1])return"";for(n=0;n<t.length&&n<e.length;n++)if(t[t.length-(n+1)]!=e[e.length-(n+1)])return t.slice(-n);return t.slice(-n)}function Y(t,e,n){if(t.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return n+t.slice(e.length)}function G(t,e,n){if(!e)return t+n;if(t.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(t)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return t.slice(0,-e.length)+n}function N(t,e){return Y(t,e,"")}function B(t,e){return G(t,e,"")}function ue(t,e){return e.slice(0,De(t,e))}function De(t,e){var n=0;t.length>e.length&&(n=t.length-e.length);var s=e.length;t.length<e.length&&(s=t.length);var l=Array(s),r=0;l[0]=0;for(var i=1;i<s;i++){for(e[i]==e[r]?l[i]=l[r]:l[i]=r;r>0&&e[i]!=e[r];)r=l[r];e[i]==e[r]&&r++}r=0;for(var o=n;o<t.length;o++){for(;r>0&&t[o]!=e[r];)r=l[r];t[o]==e[r]&&r++}return r}var J="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ze=new RegExp("[".concat(J,"]+|\\s+|[^").concat(J,"]"),"ug"),F=new k;F.equals=function(t,e,n){return n.ignoreCase&&(t=t.toLowerCase(),e=e.toLowerCase()),t.trim()===e.trim()};F.tokenize=function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');n=Array.from(e.intlSegmenter.segment(t),function(r){return r.segment})}else n=t.match(ze)||[];var s=[],l=null;return n.forEach(function(r){/\s/.test(r)?l==null?s.push(r):s.push(s.pop()+r):/\s/.test(l)?s[s.length-1]==l?s.push(s.pop()+r):s.push(l+r):s.push(r),l=r}),s};F.join=function(t){return t.map(function(e,n){return n==0?e:e.replace(/^\s+/,"")}).join("")};F.postProcess=function(t,e){if(!t||e.oneChangePerToken)return t;var n=null,s=null,l=null;return t.forEach(function(r){r.added?s=r:r.removed?l=r:((s||l)&&fe(n,l,s,r),n=r,s=null,l=null)}),(s||l)&&fe(n,l,s,null),t};function fe(t,e,n,s){if(e&&n){var l=e.value.match(/^\s*/)[0],r=e.value.match(/\s*$/)[0],i=n.value.match(/^\s*/)[0],o=n.value.match(/\s*$/)[0];if(t){var a=le(l,i);t.value=G(t.value,i,a),e.value=N(e.value,a),n.value=N(n.value,a)}if(s){var u=oe(r,o);s.value=Y(s.value,o,u),e.value=B(e.value,u),n.value=B(n.value,u)}}else if(n)t&&(n.value=n.value.replace(/^\s*/,"")),s&&(s.value=s.value.replace(/^\s*/,""));else if(t&&s){var f=s.value.match(/^\s*/)[0],c=e.value.match(/^\s*/)[0],L=e.value.match(/\s*$/)[0],T=le(f,c);e.value=N(e.value,T);var y=oe(N(f,T),L);e.value=B(e.value,y),s.value=Y(s.value,f,y),t.value=G(t.value,f,f.slice(0,f.length-y.length))}else if(s){var _=s.value.match(/^\s*/)[0],I=e.value.match(/\s*$/)[0],x=ue(I,_);e.value=B(e.value,x)}else if(t){var q=t.value.match(/\s*$/)[0],R=e.value.match(/^\s*/)[0],v=ue(q,R);e.value=N(e.value,v)}}var Oe=new k;Oe.tokenize=function(t){var e=new RegExp("(\\r?\\n)|[".concat(J,"]+|[^\\S\\n\\r]+|[^").concat(J,"]"),"ug");return t.match(e)||[]};var S=new k;S.tokenize=function(t,e){e.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));var n=[],s=t.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(var l=0;l<s.length;l++){var r=s[l];l%2&&!e.newlineIsToken?n[n.length-1]+=r:n.push(r)}return n};S.equals=function(t,e,n){return n.ignoreWhitespace?((!n.newlineIsToken||!t.includes(`
`))&&(t=t.trim()),(!n.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):n.ignoreNewlineAtEof&&!n.newlineIsToken&&(t.endsWith(`
`)&&(t=t.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),k.prototype.equals.call(this,t,e,n)};var Ee=new k;Ee.tokenize=function(t){return t.split(/(\S.+?[.!?])(?=\s+|$)/)};var $e=new k;$e.tokenize=function(t){return t.split(/([{}:;,]|\s+)/)};function Q(t){"@babel/helpers - typeof";return Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(t)}var $=new k;$.useLongestToken=!0;$.tokenize=S.tokenize;$.castInput=function(t,e){var n=e.undefinedReplacement,s=e.stringifyReplacer,l=s===void 0?function(r,i){return typeof i>"u"?n:i}:s;return typeof t=="string"?t:JSON.stringify(W(t,null,null,l),l,"  ")};$.equals=function(t,e,n){return k.prototype.equals.call($,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),n)};function de(t,e,n){return $.diff(t,e,n)}function W(t,e,n,s,l){e=e||[],n=n||[],s&&(t=s(l,t));var r;for(r=0;r<e.length;r+=1)if(e[r]===t)return n[r];var i;if(Object.prototype.toString.call(t)==="[object Array]"){for(e.push(t),i=new Array(t.length),n.push(i),r=0;r<t.length;r+=1)i[r]=W(t[r],e,n,s,l);return e.pop(),n.pop(),i}if(t&&t.toJSON&&(t=t.toJSON()),Q(t)==="object"&&t!==null){e.push(t),i={},n.push(i);var o=[],a;for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&o.push(a);for(o.sort(),r=0;r<o.length;r+=1)a=o[r],i[a]=W(t[a],e,n,s,a);e.pop(),n.pop()}else i=t;return i}var X=new k;X.tokenize=function(t){return t.slice()};X.join=X.removeEmpty=function(t){return t};const Ie={props:{modelValue:{type:Boolean,required:!0},current:{type:Object,required:!0},load:{type:Function,required:!0}},emit:["update:modelValue","use","revert"],inject:["url","srcset"],data:()=>({list:[],latest:null,loading:!1,show:!1}),computed:{versions(){return this.list.filter(t=>this.isModified(t,this.current)||t.published||t.publish_at)}},methods:{diff(t,e){return t&&e?de(t,e):e?[e]:[]},filesdiff(t,e){const n=Object.keys(t||{}),s=Object.keys(e||{}),l=n.filter(a=>!s.includes(a)),r=s.filter(a=>!n.includes(a)),i=Object.fromEntries(Object.entries(t||{}).filter(([a])=>l.includes(a)).map(([a,u])=>[a,{...u,css:"added"}])),o=Object.fromEntries(Object.entries(e||{}).filter(([a])=>r.includes(a)).map(([a,u])=>[a,{...u,css:"removed"}]));return{...i,...o}},isModified(t,e){return!t||!e?!1:de(t.data||{},e.data||{}).length!==1},reset(){this.list=[],this.latest=null}},watch:{modelValue:{immediate:!0,handler(t){t&&!this.latest&&(this.loading=!0,this.load().then(e=>{this.latest=e.shift(),this.list=e}).finally(()=>{this.loading=!1}))}}}},xe={class:"loading"},Ae={class:"media-list"},Me=["poster","src"],Ne={key:2},qe=["src"],Re={key:3},be=["onClick"],Be={class:"media-list"},Je=["poster","src"],Fe={key:2},je=["src"],Ue={key:3};function Pe(t,e,n,s,l,r){return m(),V(Ce,{modelValue:n.modelValue,onAfterLeave:e[4]||(e[4]=i=>t.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:d(()=>[h(U,{"prepend-icon":"mdi-history"},{append:d(()=>[h(Z,{title:t.$gettext("Close"),onClick:e[0]||(e[0]=i=>t.$emit("update:modelValue",!1)),icon:"mdi-close",variant:"text",elevation:"0"},null,8,["title"])]),title:d(()=>[C(g(t.$gettext("History")),1)]),default:d(()=>[h(ke),h(P,null,{default:d(()=>[h(_e,{side:"end",align:"start"},{default:d(()=>[t.loading?(m(),V(b,{key:0,"dot-color":"grey-lighten-1",size:"small",width:"100%"},{default:d(()=>[w("div",xe,[C(g(t.$gettext("Loading"))+" ",1),e[5]||(e[5]=w("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[w("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),w("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),w("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])]),_:1})):H("",!0),!t.loading&&!(t.latest&&r.isModified(t.latest,n.current)||r.versions.length)?(m(),V(b,{key:1,"dot-color":"grey-lighten-1",width:"100%",size:"small"},{default:d(()=>[C(g(t.$gettext("No changes")),1)]),_:1})):H("",!0),!t.loading&&t.latest&&r.isModified(t.latest,n.current)?(m(),V(b,{key:2,"dot-color":"blue",width:"100%",size:"small"},{default:d(()=>[h(U,{class:"elevation-2"},{default:d(()=>[h(ne,{onClick:e[1]||(e[1]=i=>t.show=!t.show)},{default:d(()=>[C(g(t.$gettext("Current")),1)]),_:1}),h(P,null,{default:d(()=>{var i,o;return[w("div",{class:z(["diff",{show:t.show}]),onClick:e[2]||(e[2]=a=>t.show=!t.show)},[(m(!0),p(O,null,E(r.diff((i=t.latest)==null?void 0:i.data,n.current.data),a=>(m(),p("span",{class:z({added:a.added,removed:a.removed})},g(a.value||a),3))),256))],2),w("div",Ae,[(m(!0),p(O,null,E(r.filesdiff(n.current.files,(o=t.latest)==null?void 0:o.files),a=>{var u,f,c;return m(),p("div",{key:a.id,class:z([a.css,"file"])},[(u=a.mime)!=null&&u.startsWith("image/")?(m(),V(re,{key:0,srcset:r.srcset(a.previews),src:r.url(a.path),alt:a.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(f=a.mime)!=null&&f.startsWith("video/")?(m(),p("video",{key:1,poster:r.url(Object.values(a.previews).shift()),src:r.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Me)):(c=a.mime)!=null&&c.startsWith("audio/")?(m(),p("div",Ne,[w("audio",{src:r.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,qe),C(" "+g(a.name),1)])):(m(),p("div",Re,g(a.name),1))],2)}),128))])]}),_:1}),h(ae,null,{default:d(()=>[h(Z,{variant:"outlined",onClick:e[3]||(e[3]=se(i=>t.$emit("revert",t.latest),["stop"]))},{default:d(()=>[C(g(t.$gettext("Revert")),1)]),_:1})]),_:1})]),_:1})]),_:1})):H("",!0),(m(!0),p(O,null,E(r.versions,(i,o)=>(m(),V(b,{key:o,"dot-color":i.published?"success":"grey-lighten-1",class:z({publish:i.publish_at}),width:"100%",size:"small"},{default:d(()=>[h(U,{class:"elevation-2"},{default:d(()=>[h(ne,{onClick:a=>i._show=!i._show},{default:d(()=>[C(g(new Date(i.publish_at||i.created_at).toLocaleString(t.$vuetify.locale.current)),1)]),_:2},1032,["onClick"]),h(Ve,{onClick:a=>i._show=!i._show},{default:d(()=>[C(g(i.editor),1)]),_:2},1032,["onClick"]),h(P,null,{default:d(()=>[w("div",{class:z(["diff",{show:i._show}]),onClick:a=>i._show=!i._show},[(m(!0),p(O,null,E(r.diff(i.data,n.current.data),a=>(m(),p("span",{class:z({added:a.removed,removed:a.added})},g(a.value||a),3))),256))],10,be),w("div",Be,[(m(!0),p(O,null,E(r.filesdiff(i.files,n.current.files),a=>{var u,f,c;return m(),p("div",{key:a.id,class:z([a.css,"file"])},[(u=a.mime)!=null&&u.startsWith("image/")?(m(),V(re,{key:0,srcset:r.srcset(a.previews),src:r.url(a.path),alt:a.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(f=a.mime)!=null&&f.startsWith("video/")?(m(),p("video",{key:1,poster:r.url(Object.values(a.previews).shift()),src:r.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Je)):(c=a.mime)!=null&&c.startsWith("audio/")?(m(),p("div",Fe,[w("audio",{src:r.url(a.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,je),C(" "+g(a.name),1)])):(m(),p("div",Ue,g(a.name),1))],2)}),128))])]),_:2},1024),h(ae,null,{default:d(()=>[h(Z,{variant:"outlined",onClick:se(a=>t.$emit("use",i),["stop"])},{default:d(()=>[C(g(t.$gettext("Use version")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color","class"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Ye=ce(Ie,[["render",Pe],["__scopeId","data-v-ffa8f32c"]]),Ge=function(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",e=new Date("2025-01-01T00:00:00Z").getTime();let n=0;return function(){n=(n+1)%8;const s=(Date.now()-e)/256<<3|n;return Array.from({length:6},(l,r)=>{const i=s>>6*(5-r)&63;return t[r===0?i%52:i]}).join("")}}();async function Qe(t){const e=new AudioContext,s=await(await fetch(t)).arrayBuffer(),l=await e.decodeAudioData(s),r=[];for(let o=0;o<l.numberOfChannels;o++)r.push(l.getChannelData(o));const i=new Worker(new URL(""+new URL("worker-uYZwUMq5.js",import.meta.url).href,import.meta.url),{type:"module"});return new Promise(o=>{i.onmessage=a=>o(a.data),i.postMessage({channels:r,length:l.length,sampleRate:l.sampleRate},r.map(a=>a.buffer))})}export{Ze as A,Ye as H,Ge as a,Qe as u};
