import{_ as C,K as x,a2 as _,b as f,w as a,a4 as F,o as r,a as d,a5 as b,a6 as w,$ as B,aw as $,E,a9 as I,c as g,F as L,a3 as U,aa as D,f as u,h as V,t as p,k,d as T,r as z,ax as A}from"../index.js";import{F as O}from"./FileListItems-DVEk2ghK.js";const S={props:{modelValue:{type:Boolean,required:!0},multiple:{type:Boolean,required:!1},mime:{type:String,default:""}},emits:["update:modelValue","add"],setup(){return{app:_()}},data(){return{errors:[],input:"",items:{},loading:!1}},methods:{add(){const t=[],e=Object.values(this.items);e.length&&(this.loading=!0,e.forEach(l=>{t.push(this.$apollo.mutate({mutation:x`mutation($input: FileInput) {
              addFile(input: $input) {
                id
                mime
                name
                path
                previews
                updated_at
                editor
              }
            }`,variables:{input:{path:l.path,name:l.name}}}).then(n=>{if(n.errors)throw n.errors;Object.assign(l,n.data.addFile,{previews:JSON.parse(n.data.addFile.previews||"{}")})}).catch(n=>{this.$log("FileUrlDialog::add(): Error adding file:",l,n)}).finally(()=>{this.loading=!1}))}),Promise.all(t).then(()=>{this.$emit("update:modelValue",!1),this.$emit("add",e),this.input="",this.items={}}))},remove(t){delete this.items[t]},size(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(2)} KB`:t<1024*1024*1024?`${(t/(1024*1024)).toFixed(2)} MB`:`${(t/(1024*1024*1024)).toFixed(2)} GB`:""},update(){const t=this.input.split(`
`).map(e=>e.trim()).filter(e=>e&&e.startsWith("http"));for(const e of Object.keys(this.items))t.includes(e)||delete this.items[e];t.forEach(e=>{this.items[e]||fetch(this.app.urlproxy.replace(":url",encodeURIComponent(e)),{credentials:"include",method:"HEAD"}).then(l=>{var n,s,o,i,m,c,h;if(!l.ok)throw new Error(`Failed to fetch ${e}`,l);(s=(n=l.headers)==null?void 0:n.get("Content-Type"))!=null&&s.startsWith(this.mime)?this.items[e]={path:e,mime:(o=l.headers)==null?void 0:o.get("Content-Type"),size:parseInt((i=l.headers)==null?void 0:i.get("Content-Length")),name:(((h=(c=(m=e.split("?"))==null?void 0:m.shift())==null?void 0:c.split("/"))==null?void 0:h.pop())||e).splice(0,100)}:this.errors=this.multiple?[this.$gettext('At least one file is not of type "%{mime}*"',{mime:this.mime})]:[this.$gettext('The file is not of type "%{mime}*"',{mime:this.mime})]}).catch(l=>{this.$log(`FileUrlDialog::update(): Error fetching ${e}`,l)})})}}},j=["onClick"],K=["src"],N=["src"],R=["src"],W=["href"],q=["onClick"],G={class:"item-text"},H={class:"item-title"},J={class:"item-mime item-subtitle"},M={class:"item-aux"},P={class:"item-size"};function Q(t,e,l,n,s,o){return r(),f(F,{modelValue:l.modelValue,"max-width":"1200",scrollable:""},{default:a(()=>[d(b,{loading:s.loading?"primary":!1},{append:a(()=>[Object.keys(s.items).length?(r(),f(V,{key:0,variant:"outlined",onClick:e[0]||(e[0]=i=>o.add())},{default:a(()=>[k(p(t.$gettext("Add file","Add files",+l.multiple)),1)]),_:1})):T("",!0),d(V,{onClick:e[1]||(e[1]=i=>t.$emit("update:modelValue",!1)),title:t.$gettext("Close"),icon:"mdi-close",variant:"flat"},null,8,["title"])]),title:a(()=>[k(p(t.$gettext("Add files from URLs")),1)]),default:a(()=>[d(w,null,{default:a(()=>[l.multiple?(r(),f(B,{key:0,ref:"input",modelValue:s.input,"onUpdate:modelValue":e[2]||(e[2]=i=>s.input=i),onKeyup:e[3]||(e[3]=$(i=>o.update(),["enter"])),"onClick:appendInner":e[4]||(e[4]=i=>o.update()),"onClick:clear":e[5]||(e[5]=i=>s.errors=[]),"error-messages":s.errors,"append-inner-icon":s.input?"mdi-check":"",placeholder:t.$gettext("Enter one URL per line"),variant:"underlined",autofocus:"",clearable:"","auto-grow":"",rows:"3"},null,8,["modelValue","error-messages","append-inner-icon","placeholder"])):(r(),f(E,{key:1,ref:"input",modelValue:s.input,"onUpdate:modelValue":e[6]||(e[6]=i=>s.input=i),onKeyup:e[7]||(e[7]=$(i=>o.update(),["enter"])),"onClick:appendInner":e[8]||(e[8]=i=>o.update()),"onClick:clear":e[9]||(e[9]=i=>s.errors=[]),"error-messages":s.errors,"append-inner-icon":s.input?"mdi-check":"",placeholder:t.$gettext("Enter URL"),variant:"underlined",autofocus:"",clearable:""},null,8,["modelValue","error-messages","append-inner-icon","placeholder"])),d(I,{class:"items grid"},{default:a(()=>[(r(!0),g(L,null,U(s.items,(i,m)=>(r(),f(D,{key:m},{default:a(()=>{var c,h,v;return[d(V,{onClick:y=>o.remove(m),title:t.$gettext("Remove file"),class:"btn-overlay",icon:"mdi-delete"},null,8,["onClick","title"]),u("div",{class:"item-preview",onClick:y=>t.$emit("select",i)},[(c=i.mime)!=null&&c.startsWith("image/")?(r(),g("img",{key:0,src:i.path},null,8,K)):(h=i.mime)!=null&&h.startsWith("video/")?(r(),g("video",{key:1,preload:"metadata",controls:"",src:i.path},null,8,N)):(v=i.mime)!=null&&v.startsWith("audio/")?(r(),g("audio",{key:2,preload:"metadata",controls:"",src:i.path},null,8,R)):(r(),g("a",{key:3,href:i.path,target:"_blank"},p(i.path),9,W))],8,j),u("div",{class:"item-content",onClick:y=>t.$emit("select",i)},[u("div",G,[u("span",H,p(i.name),1),u("div",J,p(i.mime),1)]),u("div",M,[u("div",P,"Size: "+p(o.size(i.size)),1)])],8,q)]}),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1},8,["modelValue"])}const te=C(S,[["render",Q],["__scopeId","data-v-2e7a3b1f"]]),X={components:{FileListItems:O},props:{modelValue:{type:Boolean,required:!0},filter:{type:Object,default:()=>({})},grid:{type:Boolean,default:!1}},emits:["update:modelValue","add"]};function Y(t,e,l,n,s,o){const i=z("FileListItems");return r(),f(F,{modelValue:l.modelValue,"max-width":"1200",scrollable:""},{default:a(()=>[d(b,null,{append:a(()=>[d(V,{onClick:e[0]||(e[0]=m=>t.$emit("update:modelValue",!1)),title:t.$gettext("Close"),icon:"mdi-close",variant:"flat"},null,8,["title"])]),title:a(()=>[k(p(t.$gettext("Files")),1)]),default:a(()=>[d(A),d(w,null,{default:a(()=>[d(i,{filter:l.filter,grid:l.grid,onSelect:e[1]||(e[1]=m=>t.$emit("add",m)),embed:""},null,8,["filter","grid"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ie=C(X,[["render",Y]]);export{te as F,ie as a};
