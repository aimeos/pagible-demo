import{_ as Y,aF as K,b as _,w as d,aP as Q,o as f,a as h,i as X,aQ as ee,c as p,F as k,a4 as D,j as S,f as w,aR as te,l as y,t as g,aS as se,aT as ne,a6 as ie,a7 as M,aw as ae,a8 as $,aU as le,d as W,aV as x,aW as U,n as L,a1 as J,aX as F,k as N,aJ as H,aY as re}from"./index-zamkCzJL.js";const oe={props:{item:{type:Object,required:!0}},setup(){return{drawer:K()}},computed:{values(){const t={};return this.item.id&&(t[this.$gettext("id")]=this.item.id),this.item.mime&&(t[this.$gettext("mime")]=this.item.mime),this.item.editor&&(t[this.$gettext("editor")]=this.item.editor),this.item.created_at&&(t[this.$gettext("created")]=new Date(this.item.created_at).toLocaleString(this.$vuetify.locale.current)),this.item.updated_at&&(t[this.$gettext("updated")]=new Date(this.item.updated_at).toLocaleString(this.$vuetify.locale.current)),this.item.deleted_at&&(t[this.$gettext("deleted")]=new Date(this.item.deleted_at).toLocaleString(this.$vuetify.locale.current)),t}}};function de(t,e,n,i,r,l){return f(),_(Q,{modelValue:i.drawer.aside,"onUpdate:modelValue":e[0]||(e[0]=a=>i.drawer.aside=a),"mobile-breakpoint":"md",location:"end"},{default:d(()=>[h(X,{opened:[0]},{default:d(()=>[h(ee,{value:0},{activator:d(({props:a})=>[h(S,se(ne(a)),{default:d(()=>[y(g(t.$gettext("Meta data")),1)]),_:2},1040)]),default:d(()=>[(f(!0),p(k,null,D(l.values,(a,o)=>(f(),_(S,{key:o,rounded:"lg"},{default:d(()=>[h(te,{class:"name"},{default:d(()=>[y(g(o),1)]),_:2},1024),w("div",null,g(a),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])}const be=Y(oe,[["render",de],["__scopeId","data-v-602996ad"]]);class Z{diff(e,n,i={}){let r;typeof i=="function"?(r=i,i={}):"callback"in i&&(r=i.callback);const l=this.castInput(e,i),a=this.castInput(n,i),o=this.removeEmpty(this.tokenize(l,i)),s=this.removeEmpty(this.tokenize(a,i));return this.diffWithOptionsObj(o,s,i,r)}diffWithOptionsObj(e,n,i,r){var l;const a=m=>{if(m=this.postProcess(m,i),r){setTimeout(function(){r(m)},0);return}else return m},o=n.length,s=e.length;let c=1,u=o+s;i.maxEditLength!=null&&(u=Math.min(u,i.maxEditLength));const v=(l=i.timeout)!==null&&l!==void 0?l:1/0,O=Date.now()+v,C=[{oldPos:-1,lastComponent:void 0}];let V=this.extractCommon(C[0],n,e,0,i);if(C[0].oldPos+1>=s&&V+1>=o)return a(this.buildValues(C[0].lastComponent,n,e));let T=-1/0,A=1/0;const B=()=>{for(let m=Math.max(T,-c);m<=Math.min(A,c);m+=2){let P;const b=C[m-1],z=C[m+1];b&&(C[m-1]=void 0);let E=!1;if(z){const j=z.oldPos-m;E=z&&0<=j&&j<o}const R=b&&b.oldPos+1<s;if(!E&&!R){C[m]=void 0;continue}if(!R||E&&b.oldPos<z.oldPos?P=this.addToPath(z,!0,!1,0,i):P=this.addToPath(b,!1,!0,1,i),V=this.extractCommon(P,n,e,m,i),P.oldPos+1>=s&&V+1>=o)return a(this.buildValues(P.lastComponent,n,e))||!0;C[m]=P,P.oldPos+1>=s&&(A=Math.min(A,m-1)),V+1>=o&&(T=Math.max(T,m+1))}c++};if(r)(function m(){setTimeout(function(){if(c>u||Date.now()>O)return r(void 0);B()||m()},0)})();else for(;c<=u&&Date.now()<=O;){const m=B();if(m)return m}}addToPath(e,n,i,r,l){const a=e.lastComponent;return a&&!l.oneChangePerToken&&a.added===n&&a.removed===i?{oldPos:e.oldPos+r,lastComponent:{count:a.count+1,added:n,removed:i,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+r,lastComponent:{count:1,added:n,removed:i,previousComponent:a}}}extractCommon(e,n,i,r,l){const a=n.length,o=i.length;let s=e.oldPos,c=s-r,u=0;for(;c+1<a&&s+1<o&&this.equals(i[s+1],n[c+1],l);)c++,s++,u++,l.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return u&&!l.oneChangePerToken&&(e.lastComponent={count:u,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=s,c}equals(e,n,i){return i.comparator?i.comparator(e,n):e===n||!!i.ignoreCase&&e.toLowerCase()===n.toLowerCase()}removeEmpty(e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(e[i]);return n}castInput(e,n){return e}tokenize(e,n){return Array.from(e)}join(e){return e.join("")}postProcess(e,n){return e}get useLongestToken(){return!1}buildValues(e,n,i){const r=[];let l;for(;e;)r.push(e),l=e.previousComponent,delete e.previousComponent,e=l;r.reverse();const a=r.length;let o=0,s=0,c=0;for(;o<a;o++){const u=r[o];if(u.removed)u.value=this.join(i.slice(c,c+u.count)),c+=u.count;else{if(!u.added&&this.useLongestToken){let v=n.slice(s,s+u.count);v=v.map(function(O,C){const V=i[c+C];return V.length>O.length?V:O}),u.value=this.join(v)}else u.value=this.join(n.slice(s,s+u.count));s+=u.count,u.added||(c+=u.count)}}return r}}class ue extends Z{constructor(){super(...arguments),this.tokenize=G}equals(e,n,i){return i.ignoreWhitespace?((!i.newlineIsToken||!e.includes(`
`))&&(e=e.trim()),(!i.newlineIsToken||!n.includes(`
`))&&(n=n.trim())):i.ignoreNewlineAtEof&&!i.newlineIsToken&&(e.endsWith(`
`)&&(e=e.slice(0,-1)),n.endsWith(`
`)&&(n=n.slice(0,-1))),super.equals(e,n,i)}}new ue;function G(t,e){e.stripTrailingCr&&(t=t.replace(/\r\n/g,`
`));const n=[],i=t.split(/(\n|\r\n)/);i[i.length-1]||i.pop();for(let r=0;r<i.length;r++){const l=i[r];r%2&&!e.newlineIsToken?n[n.length-1]+=l:n.push(l)}return n}class ce extends Z{constructor(){super(...arguments),this.tokenize=G}get useLongestToken(){return!0}castInput(e,n){const{undefinedReplacement:i,stringifyReplacer:r=(l,a)=>typeof a>"u"?i:a}=n;return typeof e=="string"?e:JSON.stringify(q(e,null,null,r),null,"  ")}equals(e,n,i){return super.equals(e.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"),i)}}const I=new ce;function q(t,e,n,i,r){e=e||[],n=n||[],i&&(t=i(r===void 0?"":r,t));let l;for(l=0;l<e.length;l+=1)if(e[l]===t)return n[l];let a;if(Object.prototype.toString.call(t)==="[object Array]"){for(e.push(t),a=new Array(t.length),n.push(a),l=0;l<t.length;l+=1)a[l]=q(t[l],e,n,i,String(l));return e.pop(),n.pop(),a}if(t&&t.toJSON&&(t=t.toJSON()),typeof t=="object"&&t!==null){e.push(t),a={},n.push(a);const o=[];let s;for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&o.push(s);for(o.sort(),l=0;l<o.length;l+=1)s=o[l],a[s]=q(t[s],e,n,i,s);e.pop(),n.pop()}else a=t;return a}const fe=I.castInput;I.castInput=function(t,e){let n=fe.call(this,t,e);return typeof n=="string"&&(n=n.replace(/\\n/g,`
`)),n};const me={props:{modelValue:{type:Boolean,required:!0},current:{type:Object,required:!0},load:{type:Function,required:!0}},emit:["update:modelValue","use","revert"],inject:["url","srcset"],data:()=>({list:[],latest:null,loading:!1,show:!1}),computed:{versions(){return this.list.filter(t=>this.isModified(t,this.current)||t.published||t.publish_at)}},methods:{diff(t,e){return t&&e?I.diff(t,e):e?[e]:[]},filesdiff(t,e){const n=Object.keys(t||{}),i=Object.keys(e||{}),r=n.filter(s=>!i.includes(s)),l=i.filter(s=>!n.includes(s)),a=Object.fromEntries(Object.entries(t||{}).filter(([s])=>r.includes(s)).map(([s,c])=>[s,{...c,css:"added"}])),o=Object.fromEntries(Object.entries(e||{}).filter(([s])=>l.includes(s)).map(([s,c])=>[s,{...c,css:"removed"}]));return{...a,...o}},isModified(t,e){return!t||!e?!1:I.diff(t.data||{},e.data||{}).length!==1},reset(){this.list=[],this.latest=null}},watch:{modelValue:{immediate:!0,handler(t){t&&!this.latest&&(this.loading=!0,this.load().then(e=>{this.list=e||[],this.latest=(e==null?void 0:e.shift())||null}).finally(()=>{this.loading=!1}))}}}},he={class:"loading"},ge={class:"media-list"},pe=["poster","src"],we={key:2},ye=["src"],ve={key:3},Ce=["onClick"],_e={class:"media-list"},Ve=["poster","src"],Pe={key:2},Le=["src"],ke={key:3};function De(t,e,n,i,r,l){return f(),_(ie,{modelValue:n.modelValue,onAfterLeave:e[4]||(e[4]=a=>t.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:d(()=>[h(M,{"prepend-icon":"mdi-history"},{append:d(()=>[h(N,{title:t.$gettext("Close"),onClick:e[0]||(e[0]=a=>t.$emit("update:modelValue",!1)),icon:"mdi-close",variant:"text",elevation:"0"},null,8,["title"])]),title:d(()=>[y(g(t.$gettext("History")),1)]),default:d(()=>[h(ae),h($,null,{default:d(()=>[h(le,{side:"end",align:"start"},{default:d(()=>[t.loading?(f(),_(x,{key:0,"dot-color":"grey-lighten-1",size:"small",width:"100%"},{default:d(()=>[w("div",he,[y(g(t.$gettext("Loading"))+" ",1),e[5]||(e[5]=w("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[w("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),w("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),w("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])]),_:1})):W("",!0),!t.loading&&!(t.latest&&l.isModified(t.latest,n.current)||l.versions.length)?(f(),_(x,{key:1,"dot-color":"grey-lighten-1",width:"100%",size:"small"},{default:d(()=>[y(g(t.$gettext("No changes")),1)]),_:1})):W("",!0),!t.loading&&t.latest&&l.isModified(t.latest,n.current)?(f(),_(x,{key:2,"dot-color":"blue",width:"100%",size:"small"},{default:d(()=>[h(M,{class:"elevation-2"},{default:d(()=>[h(U,{onClick:e[1]||(e[1]=a=>t.show=!t.show)},{default:d(()=>[y(g(t.$gettext("Current")),1)]),_:1}),h($,null,{default:d(()=>{var a,o;return[w("div",{class:L(["diff",{show:t.show}]),onClick:e[2]||(e[2]=s=>t.show=!t.show)},[(f(!0),p(k,null,D(l.diff((a=t.latest)==null?void 0:a.data,n.current.data),s=>(f(),p("span",{class:L({added:s.added,removed:s.removed})},g(s.value||s),3))),256))],2),w("div",ge,[(f(!0),p(k,null,D(l.filesdiff(n.current.files,(o=t.latest)==null?void 0:o.files),s=>{var c,u,v;return f(),p("div",{key:s.id,class:L([s.css,"file"])},[(c=s.mime)!=null&&c.startsWith("image/")?(f(),_(J,{key:0,srcset:l.srcset(s.previews),src:l.url(s.path),alt:s.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(u=s.mime)!=null&&u.startsWith("video/")?(f(),p("video",{key:1,poster:l.url(Object.values(s.previews).shift()),src:l.url(s.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,pe)):(v=s.mime)!=null&&v.startsWith("audio/")?(f(),p("div",we,[w("audio",{src:l.url(s.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,ye),y(" "+g(s.name),1)])):(f(),p("div",ve,g(s.name),1))],2)}),128))])]}),_:1}),h(F,null,{default:d(()=>[h(N,{variant:"outlined",onClick:e[3]||(e[3]=H(a=>t.$emit("revert",t.latest),["stop"]))},{default:d(()=>[y(g(t.$gettext("Revert")),1)]),_:1})]),_:1})]),_:1})]),_:1})):W("",!0),(f(!0),p(k,null,D(l.versions,(a,o)=>(f(),_(x,{key:o,"dot-color":a.published?"success":"grey-lighten-1",class:L({publish:a.publish_at}),width:"100%",size:"small"},{default:d(()=>[h(M,{class:"elevation-2"},{default:d(()=>[h(U,{onClick:s=>a._show=!a._show},{default:d(()=>[y(g(new Date(a.publish_at||a.created_at).toLocaleString(t.$vuetify.locale.current)),1)]),_:2},1032,["onClick"]),h(re,{onClick:s=>a._show=!a._show},{default:d(()=>[y(g(a.editor),1)]),_:2},1032,["onClick"]),h($,null,{default:d(()=>[w("div",{class:L(["diff",{show:a._show}]),onClick:s=>a._show=!a._show},[(f(!0),p(k,null,D(l.diff(a.data,n.current.data),s=>(f(),p("span",{class:L({added:s.removed,removed:s.added})},g(s.value||s),3))),256))],10,Ce),w("div",_e,[(f(!0),p(k,null,D(l.filesdiff(a.files,n.current.files),s=>{var c,u,v;return f(),p("div",{key:s.id,class:L([s.css,"file"])},[(c=s.mime)!=null&&c.startsWith("image/")?(f(),_(J,{key:0,srcset:l.srcset(s.previews),src:l.url(s.path),alt:s.name,draggable:"false",loading:"lazy"},null,8,["srcset","src","alt"])):(u=s.mime)!=null&&u.startsWith("video/")?(f(),p("video",{key:1,poster:l.url(Object.values(s.previews).shift()),src:l.url(s.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Ve)):(v=s.mime)!=null&&v.startsWith("audio/")?(f(),p("div",Pe,[w("audio",{src:l.url(s.path),crossorigin:"anonymous",draggable:"false",loading:"lazy",controls:""},null,8,Le),y(" "+g(s.name),1)])):(f(),p("div",ke,g(s.name),1))],2)}),128))])]),_:2},1024),h(F,null,{default:d(()=>[h(N,{variant:"outlined",onClick:H(s=>t.$emit("use",a),["stop"])},{default:d(()=>[y(g(t.$gettext("Use version")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color","class"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}const ze=Y(me,[["render",De],["__scopeId","data-v-3b62810a"]]),xe=(function(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",e=new Date("2025-01-01T00:00:00Z").getTime();let n=0;return function(){const i=(Date.now()-e)/4096<<7|n;return n=n+1&127,Array.from({length:6},(r,l)=>{const a=i>>6*(5-l)&63;return t[l===0?a%52:a]}).join("")}})();async function Ie(t){const e=new AudioContext,i=await(await fetch(t)).arrayBuffer(),r=await e.decodeAudioData(i),l=[];for(let o=0;o<r.numberOfChannels;o++)l.push(r.getChannelData(o));const a=new Worker(new URL(""+new URL("worker-uYZwUMq5.js",import.meta.url).href,import.meta.url),{type:"module"});return new Promise(o=>{a.onmessage=s=>o(s.data),a.postMessage({channels:l,length:r.length,sampleRate:r.sampleRate},l.map(s=>s.buffer))})}export{be as A,ze as H,xe as a,Ie as u};
