var ci=Object.defineProperty;var di=(e,t,n)=>t in e?ci(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var lt=(e,t,n)=>di(e,typeof t!="symbol"?t+"":t,n);import{_ as we,aF as kn,aB as Et,b as I,w as p,aP as hi,o as v,a as m,i as ut,c as z,F as ue,a4 as Ie,aN as He,aQ as fi,j as R,f as V,t as E,m as nt,l as F,aO as Rt,a5 as rt,b7 as $t,a2 as Ke,b8 as Ht,ax as dt,a6 as qt,T as St,r as ee,ay as ht,d as $,ab as bn,ac as xn,n as ce,ad as wn,k as T,ae as Cn,a7 as Kt,a8 as Wt,L as le,aA as Sn,b9 as pr,a3 as En,V as Ot,e as Qe,al as gt,I as je,a9 as Jt,aa as Re,aD as $n,aE as Ge,ba as pi,aw as et,bb as gi,a0 as gr,aJ as Ue,aL as Ft,h as ct,aC as Be,av as mr,aG as yr,aH as vr,aI as kr,Z as mi,aK as yi,ao as It,bc as he,bd as tt,R as mt,y as xe,a$ as wt,U as cn,ar as vi,b2 as Gt,be as Ve}from"./index-zamkCzJL.js";import{U as ki,A as bi,N as xi}from"./Navigation-CHcKxWFw.js";import{a as Ce,H as wi,A as Ci}from"./utils-B-NTB7yu.js";import{S as In,F as Qt,E as Si}from"./ElementListItems-Co4RWbo7.js";import{l as Ei}from"./vue-draggable-plus-CVpprB4C.js";const $i={data:()=>({active:{},open:[0,1,2]}),setup(){const e=kn(),t=Et();return{drawer:e,side:t}},computed:{stores(){const e=Object.keys(this.side.store).sort(),t={};for(const n of e)t[n]=this.side.store[n];return t}},methods:{isActive(e,t){return typeof this.active[e]>"u"&&(this.active[e]={}),typeof this.active[e][t]>"u"&&(this.active[e][t]=!1),this.active[e][t]},sort(e){const t=Object.keys(e).sort(),n={};for(const r of t)n[r]=e[r];return n},toggle(e,t){this.side.toggle(e,t),this.active[e][t]=!this.active[e][t]}}},Ii={class:"name"},Pi={class:"value"};function Oi(e,t,n,r,a,i){return v(),I(hi,{modelValue:r.drawer.aside,"onUpdate:modelValue":t[1]||(t[1]=s=>r.drawer.aside=s),"mobile-breakpoint":"md",location:"end"},{default:p(()=>[m(ut,{opened:e.open,"onUpdate:opened":t[0]||(t[0]=s=>e.open=s)},{default:p(()=>[(v(!0),z(ue,null,Ie(i.stores,(s,l)=>He((v(),I(fi,{key:l,value:Object.keys(i.stores).indexOf(l)},{activator:p(({props:u})=>[m(R,nt({ref_for:!0},u),{default:p(()=>[F(E(e.$pgettext("as",l)),1)]),_:2},1040)]),default:p(()=>[(v(!0),z(ue,null,Ie(s,(u,o)=>(v(),I(R,{key:o,active:i.isActive(l,o),onClick:c=>i.toggle(l,o),rounded:"lg"},{default:p(()=>[V("span",Ii,E(e.$pgettext("st",o)),1),V("span",Pi,E(u),1)]),_:2},1032,["active","onClick"]))),128))]),_:2},1032,["value"])),[[Rt,Object.keys(s).length]])),128))]),_:1},8,["opened"])]),_:1},8,["modelValue"])}const Di=we($i,[["render",Oi],["__scopeId","data-v-d199f32c"]]),Ti={components:{Fields:Qt,SchemaItems:In},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=rt(),t=$t(),n=Et();return{auth:Ke(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.meta||(this.item.meta={}),this.item.meta[e.type]){this.messages.add(this.$gettext("The element has already been added"),"error");return}this.item.meta[e.type]={id:Ce(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.meta).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.meta||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.meta[e])!=null&&t.fields?(n=this.schemas.meta[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.meta[e],this.$emit("change",!0),this.$nextTick(()=>{this.validate().then(t=>{this.$emit("error",!t)})})},reset(){Object.values(this.item.meta||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const r of Object.values(this.item.meta||{}))r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(r=>r&&typeof r!="object"&&typeof r!="boolean"?r:null).filter(r=>!!r).join(" - ")).substring(0,100)||this.$pgettext("st",e.type)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},Ai={class:"element-title"},_i={class:"element-type"},Li={key:0,class:"btn-group"};function Fi(e,t,n,r,a,i){const s=ee("Fields"),l=ee("SchemaItems"),u=Ht("observe-visibility");return v(),z(ue,null,[He((v(),I(dt,null,{default:p(()=>[m(ht,null,{default:p(()=>[m(bn,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=o=>e.panel=o),elevation:"0",multiple:""},{default:p(()=>[(v(!0),z(ue,null,Ie(n.item.meta||{},(o,c)=>He((v(),I(xn,{key:c,class:ce({changed:o._changed,error:o._error})},{default:p(()=>[m(wn,{"expand-icon":"mdi-pencil"},{default:p(()=>[r.auth.can("page:save")?(v(),I(T,{key:0,onClick:h=>i.remove(c),icon:"mdi-delete",variant:"text"},null,8,["onClick"])):$("",!0),V("div",Ai,E(i.title(o)),1),V("div",_i,E(o.type),1)]),_:2},1024),m(Cn,{eager:""},{default:p(()=>[m(s,{ref_for:!0,ref:"field",data:o.data,"onUpdate:data":h=>o.data=h,files:o.files,"onUpdate:files":h=>o.files=h,onError:h=>i.error(o,h),onChange:h=>i.update(o),readonly:!r.auth.can("page:save"),fields:i.fields(o.type),assets:n.assets,type:o.type},null,8,["data","onUpdate:data","files","onUpdate:files","onError","onChange","readonly","fields","assets","type"])]),_:2},1024)]),_:2},1032,["class"])),[[Rt,i.shown(o)]])),128))]),_:1},8,["modelValue"]),i.available&&r.auth.can("page:save")?(v(),z("div",Li,[m(T,{onClick:t[1]||(t[1]=o=>e.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):$("",!0)]),_:1})]),_:1})),[[u,i.store]]),(v(),I(St,{to:"body"},[m(qt,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=o=>e.vschemas=o),onAfterLeave:t[4]||(t[4]=o=>e.vschemas=!1),scrollable:"",width:"auto"},{default:p(()=>[m(Kt,null,{default:p(()=>[m(Wt,null,{default:p(()=>[m(l,{type:"meta",onAdd:t[2]||(t[2]=o=>i.add(o))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))],64)}const Vi=we(Ti,[["render",Fi],["__scopeId","data-v-ce8b6785"]]),zi={props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],inject:["debounce","locales","slugify"],data:()=>({errors:{},messages:{}}),setup(){const e=Sn(),t=pr(),n=Et(),r=Ke();return{app:En(),auth:r,side:n,config:t,languages:e}},created(){this.checkPathd=this.debounce(this.checkPath,500)},computed:{readonly(){return!this.auth.can("page:save")}},methods:{checkPath(){var e;return((e=this.$apollo)==null?void 0:e.query({query:le`query($filter: PageFilter) {
            pages(filter: $filter) {
              data {
                id
              }
            }
          }`,variables:{filter:{path:this.item.path||"",domain:this.item.domain||""}}}).then(t=>{var n,r,a,i,s,l;return((a=(r=(n=t==null?void 0:t.data)==null?void 0:n.pages)==null?void 0:r.data)==null?void 0:a.length)>0&&((l=(s=(i=t==null?void 0:t.data)==null?void 0:i.pages)==null?void 0:s.data)!=null&&l.some(u=>u.id!=this.item.id))?this.messages.path=[this.$gettext("The path is already in use by another page")]:this.messages.path=[],this.$emit("error",!!this.messages.path.length),this.messages.path}).catch(t=>{console.error("PageDetailItemProps::checkPath: Error checking path",t)}))||[]},reset(){this.errors={}},setPath(e){var t;!e&&((t=this.item.path)==null?void 0:t.at(0))==="_"&&this.updatePath(this.item.title)},update(e,t){this.item[e]=typeof t=="string"?t.trim():t,this.$emit("change",!0)},updatePath(e){this.update("path",this.slugify(e)),this.checkPath()},async validate(e=!1){await this.$nextTick();const t=[e?this.checkPathd():this.checkPath()];return Object.values(this.$refs).forEach(n=>{t.push(n.validate())}),Promise.all(t).then(n=>{const r=n.reduce((a,i)=>a+((i==null?void 0:i.length)||0),0);return this.$emit("error",!!r),r||!0})}},watch:{item:{deep:!0,immediate:!0,handler(e){this.validate(!0)}}}};function Bi(e,t,n,r,a,i){return v(),I(dt,null,{default:p(()=>[m(ht,null,{default:p(()=>[m(Ot,null,{default:p(()=>[m(Qe,{cols:"12",md:"6"},{default:p(()=>[m(gt,{ref:"status",items:[{key:0,val:e.$gettext("Disabled")},{key:1,val:e.$gettext("Enabled")},{key:2,val:e.$gettext("Hidden in navigation")}],readonly:i.readonly,modelValue:n.item.status,label:e.$gettext("Status"),"onUpdate:modelValue":t[0]||(t[0]=s=>i.update("status",s)),variant:"underlined","item-title":"val","item-value":"key"},null,8,["items","readonly","modelValue","label"])]),_:1}),m(Qe,{cols:"12",md:"6"},{default:p(()=>[m(gt,{ref:"lang",items:i.locales(),readonly:i.readonly,modelValue:n.item.lang,label:e.$gettext("Language"),"onUpdate:modelValue":t[1]||(t[1]=s=>i.update("lang",s)),variant:"underlined"},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),m(Ot,null,{default:p(()=>[m(Qe,{cols:"12",md:"6"},{default:p(()=>[m(je,{ref:"title",rules:[s=>!!s||e.$gettext("Field is required")],readonly:i.readonly,modelValue:n.item.title,label:e.$gettext("Page title"),"onUpdate:modelValue":t[2]||(t[2]=s=>i.update("title",s)),"onUpdate:focused":t[3]||(t[3]=s=>i.setPath(s)),variant:"underlined",maxlength:"60",counter:"60"},null,8,["rules","readonly","modelValue","label"]),m(je,{ref:"name",readonly:i.readonly,modelValue:n.item.name,label:e.$gettext("Page name"),"onUpdate:modelValue":t[4]||(t[4]=s=>i.update("name",s)),variant:"underlined",counter:"30",maxlength:"30"},null,8,["readonly","modelValue","label"])]),_:1}),m(Qe,{cols:"12",md:"6"},{default:p(()=>[m(je,{ref:"path",rules:[s=>!s||s&&s[0]!=="/"||e.$gettext("Path must not start with a slash (/)")],error:!!(e.messages.path||[]).length,"error-messages":e.messages.path,readonly:i.readonly,modelValue:n.item.path,label:e.$gettext("URL path"),"onUpdate:modelValue":t[5]||(t[5]=s=>i.update("path",s)),onChange:t[6]||(t[6]=s=>i.updatePath(s.target.value)),variant:"underlined",maxlength:"255",counter:"255"},null,8,["rules","error","error-messages","readonly","modelValue","label"]),r.app.multidomain?(v(),I(je,{key:0,ref:"domain",rules:[s=>!!s||e.$gettext("Field is required"),s=>!s||s&&/^([0-9a-z]+[.-])*[0-9a-z]+\.[a-z]{2,}$/.test(s)||e.$gettext("Domain name is invalid")],readonly:i.readonly,modelValue:n.item.domain,label:e.$gettext("Domain"),"onUpdate:modelValue":t[7]||(t[7]=s=>i.update("domain",s)),variant:"underlined",maxlength:"255",counter:"255"},null,8,["rules","readonly","modelValue","label"])):$("",!0)]),_:1})]),_:1}),m(Ot,null,{default:p(()=>[m(Qe,{cols:"12",md:"6"},{default:p(()=>[m(gt,{ref:"theme",readonly:i.readonly,modelValue:n.item.theme,label:e.$gettext("Theme"),items:Object.keys(r.config.get("themes",{cms:""})),"onUpdate:modelValue":t[8]||(t[8]=s=>{i.update("theme",s),n.item.type=""}),variant:"underlined"},null,8,["readonly","modelValue","label","items"]),m(gt,{ref:"type",readonly:i.readonly,modelValue:n.item.type,label:e.$gettext("Page type"),items:Object.keys(r.config.get(`themes.${n.item.theme||"cms"}.types`,{page:""})),"onUpdate:modelValue":t[9]||(t[9]=s=>i.update("type",s)),variant:"underlined"},null,8,["readonly","modelValue","label","items"])]),_:1}),m(Qe,{cols:"12",md:"6"},{default:p(()=>[m(je,{ref:"tag",modelValue:n.item.tag,"onUpdate:modelValue":[t[10]||(t[10]=s=>n.item.tag=s),t[11]||(t[11]=s=>i.update())],readonly:i.readonly,label:e.$gettext("Page tag"),variant:"underlined",maxlength:"30",counter:"30"},null,8,["modelValue","readonly","label"]),m(gt,{ref:"cache",items:[{key:0,val:e.$gettext("No cache")},{key:1,val:e.$ngettext("%{num} minute","%{num} minutes",1,{num:1})},{key:5,val:e.$ngettext("%{num} minute","%{num} minutes",5,{num:5})},{key:15,val:e.$ngettext("%{num} minute","%{num} minutes",15,{num:15})},{key:30,val:e.$ngettext("%{num} minute","%{num} minutes",30,{num:30})},{key:60,val:e.$ngettext("%{num} hour","%{num} hours",1,{num:1})},{key:180,val:e.$ngettext("%{num} hour","%{num} hours",3,{num:3})},{key:360,val:e.$ngettext("%{num} hour","%{num} hours",6,{num:6})},{key:720,val:e.$ngettext("%{num} hour","%{num} hours",12,{num:12})},{key:1440,val:e.$ngettext("%{num} hour","%{num} hours",24,{num:24})}],readonly:i.readonly,modelValue:n.item.cache,label:e.$gettext("Cache time"),"onUpdate:modelValue":t[12]||(t[12]=s=>i.update("cache",s)),variant:"underlined","item-title":"val","item-value":"key"},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),m(Ot,null,{default:p(()=>[m(Qe,{cols:"12"},{default:p(()=>[m(je,{ref:"to",rules:[s=>!s||s.match("^((https?:)?//([^\\s/:@]+(:[^\\s/:@]+)?@)?([0-9a-z]+(\\.|-))*[0-9a-z]+\\.[a-z]{2,}(:[0-9]{1,5})?)?(/[^\\s]*)*$")!==null||e.$gettext("URL is not valid")],readonly:i.readonly,modelValue:n.item.to,label:e.$gettext("Redirect URL"),"onUpdate:modelValue":t[13]||(t[13]=s=>i.update("to",s)),variant:"underlined",maxlength:"255",counter:"255"},null,8,["rules","readonly","modelValue","label"])]),_:1})]),_:1})]),_:1})]),_:1})}const Ni=we(zi,[["render",Bi]]),Mi={components:{Fields:Qt,SchemaItems:In},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["change","error"],data:()=>({vschemas:!1,panel:[]}),setup(){const e=rt(),t=$t(),n=Et();return{auth:Ke(),messages:e,schemas:t,side:n}},computed:{available(){return Object.keys(this.schemas).length}},methods:{add(e){if(this.item.config||(this.item.config={}),this.item.config[e.type]){this.messages.add(this.$gettext("The element has already been added"),"error");return}this.item.config[e.type]={id:Ce(),type:e.type,data:{}},this.panel.push(Object.keys(this.item.config).length-1),this.vschemas=!1},error(e,t){e._error=t,this.$emit("error",Object.values(this.item.config||{}).some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.config[e])!=null&&t.fields?(n=this.schemas.config[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" available`),[])},remove(e){delete this.item.config[e],this.$emit("change",!0),this.$nextTick(()=>{this.validate().then(t=>{this.$emit("error",!t)})})},reset(){Object.values(this.item.config||{}).forEach(e=>{delete e._changed,delete e._error})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},store(e=!0){if(!e)return;const t={},n={};for(const r of Object.values(this.item.config||{}))r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1);this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(r=>r&&typeof r!="object"&&typeof r!="boolean"?r:null).filter(r=>!!r).join(" - ")).substring(0,100)||this.$pgettext("st",e.type)||""},update(e){e._changed=!0,this.$emit("change",!0),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}}},ji={class:"element-title"},Ui={class:"element-type"},Ri={key:0,class:"btn-group"};function Hi(e,t,n,r,a,i){const s=ee("Fields"),l=ee("SchemaItems"),u=Ht("observe-visibility");return v(),z(ue,null,[He((v(),I(dt,null,{default:p(()=>[m(ht,null,{default:p(()=>[m(bn,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=o=>e.panel=o),elevation:"0",multiple:""},{default:p(()=>[(v(!0),z(ue,null,Ie(n.item.config||{},(o,c)=>He((v(),I(xn,{key:c,class:ce({changed:o._changed,error:o._error})},{default:p(()=>[m(wn,{"expand-icon":"mdi-pencil"},{default:p(()=>[r.auth.can("page:save")?(v(),I(T,{key:0,onClick:h=>i.remove(c),title:e.$gettext("Remove content element"),icon:"mdi-delete",variant:"text"},null,8,["onClick","title"])):$("",!0),V("div",ji,E(i.title(o)),1),V("div",Ui,E(o.type),1)]),_:2},1024),m(Cn,{eager:""},{default:p(()=>[m(s,{ref_for:!0,ref:"field",data:o.data,"onUpdate:data":h=>o.data=h,files:o.files,"onUpdate:files":h=>o.files=h,onError:h=>i.error(o,h),onChange:h=>i.update(o),readonly:!r.auth.can("page:save"),fields:i.fields(o.type),assets:n.assets,type:o.type},null,8,["data","onUpdate:data","files","onUpdate:files","onError","onChange","readonly","fields","assets","type"])]),_:2},1024)]),_:2},1032,["class"])),[[Rt,i.shown(o)]])),128))]),_:1},8,["modelValue"]),i.available&&r.auth.can("page:save")?(v(),z("div",Ri,[m(T,{onClick:t[1]||(t[1]=o=>e.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):$("",!0)]),_:1})]),_:1})),[[u,i.store]]),(v(),I(St,{to:"body"},[m(qt,{modelValue:e.vschemas,"onUpdate:modelValue":t[3]||(t[3]=o=>e.vschemas=o),onAfterLeave:t[4]||(t[4]=o=>e.vschemas=!1),scrollable:"",width:"auto"},{default:p(()=>[m(Kt,null,{default:p(()=>[m(Wt,null,{default:p(()=>[m(l,{type:"config",onAdd:t[2]||(t[2]=o=>i.add(o))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))],64)}const qi=we(Mi,[["render",Hi],["__scopeId","data-v-a6736a49"]]),Ki={components:{PageDetailItemMeta:Vi,PageDetailItemProps:Ni,PageDetailItemConfig:qi},props:{item:{type:Object,required:!0},assets:{type:Object,default:()=>{}}},emits:["update:item","update:aside","error"],data:()=>({changed:{},errors:{},tab:"details"}),methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e,t,n;this.changed={},this.errors={},(e=this.$refs.props)==null||e.reset(),(t=this.$refs.meta)==null||t.reset(),(n=this.$refs.config)==null||n.reset()},update(e){this.changed[e]=!0,this.$emit("update:item",this.item)},validate(){const e=Object.values(this.$refs).map(t=>t.validate());return Promise.all(e).then(t=>t.every(n=>n))}}};function Wi(e,t,n,r,a,i){const s=ee("PageDetailItemProps"),l=ee("PageDetailItemMeta"),u=ee("PageDetailItemConfig");return v(),I(dt,null,{default:p(()=>[m(ht,{class:"box scroll"},{default:p(()=>[m(Jt,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=o=>e.tab=o),"align-tabs":"center"},{default:p(()=>[m(Re,{value:"details",class:ce({changed:e.changed.details,error:e.errors.details}),onClick:t[0]||(t[0]=o=>e.$emit("update:aside","meta"))},{default:p(()=>[F(E(e.$gettext("Detail")),1)]),_:1},8,["class"]),m(Re,{value:"meta",class:ce({changed:e.changed.meta,error:e.errors.meta}),onClick:t[1]||(t[1]=o=>e.$emit("update:aside","count"))},{default:p(()=>[F(E(e.$gettext("Meta")),1)]),_:1},8,["class"]),m(Re,{value:"config",class:ce({changed:e.changed.config,error:e.errors.config}),onClick:t[2]||(t[2]=o=>e.$emit("update:aside","count"))},{default:p(()=>[F(E(e.$gettext("Config")),1)]),_:1},8,["class"])]),_:1},8,["modelValue"]),m($n,{modelValue:e.tab,"onUpdate:modelValue":t[10]||(t[10]=o=>e.tab=o),touch:!1},{default:p(()=>[m(Ge,{value:"details"},{default:p(()=>[m(s,{ref:"props",item:n.item,assets:n.assets,onChange:t[4]||(t[4]=o=>i.update("details")),onError:t[5]||(t[5]=o=>i.error("details",o))},null,8,["item","assets"])]),_:1}),m(Ge,{value:"meta"},{default:p(()=>[m(l,{ref:"meta",item:n.item,assets:n.assets,onChange:t[6]||(t[6]=o=>i.update("meta")),onError:t[7]||(t[7]=o=>i.error("meta",o))},null,8,["item","assets"])]),_:1}),m(Ge,{value:"config"},{default:p(()=>[m(u,{ref:"config",item:n.item,assets:n.assets,onChange:t[8]||(t[8]=o=>i.update("config")),onError:t[9]||(t[9]=o=>i.error("config",o))},null,8,["item","assets"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ji=we(Ki,[["render",Wi],["__scopeId","data-v-f6e5717a"]]);var en,Nn;function Qi(){return Nn||(Nn=1,en=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,a,i;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(a=r;a--!==0;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(i=Object.keys(t),r=i.length,r!==Object.keys(n).length)return!1;for(a=r;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[a]))return!1;for(a=r;a--!==0;){var s=i[a];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n}),en}var Yi=Qi();const Xi=pi(Yi),Zi={components:{ElementListItems:Si,SchemaItems:In},props:{modelValue:{type:Boolean,required:!0},elements:{type:Boolean,default:!0}},emits:["update:modelValue","add"]},Gi={key:0};function ea(e,t,n,r,a,i){const s=ee("SchemaItems"),l=ee("ElementListItems");return v(),I(qt,{modelValue:n.modelValue,onAfterLeave:t[3]||(t[3]=u=>e.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:p(()=>[m(Kt,null,{append:p(()=>[m(T,{title:e.$gettext("Close"),onClick:t[0]||(t[0]=u=>e.$emit("update:modelValue",!1)),icon:"mdi-close",variant:"text",elevation:"0"},null,8,["title"])]),title:p(()=>[F(E(e.$gettext("Content elements")),1)]),default:p(()=>[m(et),m(Wt,null,{default:p(()=>[m(s,{type:"content",onAdd:t[1]||(t[1]=u=>e.$emit("add",u))}),n.elements?(v(),z("div",Gi,[m(Jt,null,{default:p(()=>[m(Re,null,{default:p(()=>[F(E(e.$gettext("Shared elements")),1)]),_:1})]),_:1}),m(l,{onSelect:t[2]||(t[2]=u=>e.$emit("add",u)),embed:""})])):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])}const br=we(Zi,[["render",ea],["__scopeId","data-v-0da6b96b"]]),ta={};function Yt(e,t){const n=ta,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,a=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return xr(e,r,a)}function xr(e,t,n){if(na(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return Mn(e.children,t,n)}return Array.isArray(e)?Mn(e,t,n):""}function Mn(e,t,n){const r=[];let a=-1;for(;++a<e.length;)r[a]=xr(e[a],t,n);return r.join("")}function na(e){return!!(e&&typeof e=="object")}const jn={}.hasOwnProperty;function ra(e,t){const n=t||{};function r(a,...i){let s=r.invalid;const l=r.handlers;if(a&&jn.call(a,e)){const u=String(a[e]);s=jn.call(l,u)?l[u]:r.unknown}if(s)return s.call(this,a,...i)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}const ia={}.hasOwnProperty;function wr(e,t){let n=-1,r;if(t.extensions)for(;++n<t.extensions.length;)wr(e,t.extensions[n]);for(r in t)if(ia.call(t,r))switch(r){case"extensions":break;case"unsafe":{Un(e[r],t[r]);break}case"join":{Un(e[r],t[r]);break}case"handlers":{aa(e[r],t[r]);break}default:e.options[r]=t[r]}return e}function Un(e,t){t&&e.push(...t)}function aa(e,t){t&&Object.assign(e,t)}function sa(e,t,n,r){const a=n.enter("blockquote"),i=n.createTracker(r);i.move("> "),i.shift(2);const s=n.indentLines(n.containerFlow(e,i.current()),la);return a(),s}function la(e,t,n){return">"+(n?"":" ")+e}function Cr(e,t){return Rn(e,t.inConstruct,!0)&&!Rn(e,t.notInConstruct,!1)}function Rn(e,t,n){if(typeof t=="string"&&(t=[t]),!t||t.length===0)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function Hn(e,t,n,r){let a=-1;for(;++a<n.unsafe.length;)if(n.unsafe[a].character===`
`&&Cr(n.stack,n.unsafe[a]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function oa(e,t){const n=String(e);let r=n.indexOf(t),a=r,i=0,s=0;if(typeof t!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===a?++i>s&&(s=i):i=1,a=r+t.length,r=n.indexOf(t,a);return s}function dn(e,t){return!!(t.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function ua(e){const t=e.options.fence||"`";if(t!=="`"&&t!=="~")throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}function ca(e,t,n,r){const a=ua(n),i=e.value||"",s=a==="`"?"GraveAccent":"Tilde";if(dn(e,n)){const h=n.enter("codeIndented"),f=n.indentLines(i,da);return h(),f}const l=n.createTracker(r),u=a.repeat(Math.max(oa(i,a)+1,3)),o=n.enter("codeFenced");let c=l.move(u);if(e.lang){const h=n.enter(`codeFencedLang${s}`);c+=l.move(n.safe(e.lang,{before:c,after:" ",encode:["`"],...l.current()})),h()}if(e.lang&&e.meta){const h=n.enter(`codeFencedMeta${s}`);c+=l.move(" "),c+=l.move(n.safe(e.meta,{before:c,after:`
`,encode:["`"],...l.current()})),h()}return c+=l.move(`
`),i&&(c+=l.move(i+`
`)),c+=l.move(u),o(),c}function da(e,t,n){return(n?"":"    ")+e}function Pn(e){const t=e.options.quote||'"';if(t!=='"'&&t!=="'")throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function ha(e,t,n,r){const a=Pn(n),i=a==='"'?"Quote":"Apostrophe",s=n.enter("definition");let l=n.enter("label");const u=n.createTracker(r);let o=u.move("[");return o+=u.move(n.safe(n.associationId(e),{before:o,after:"]",...u.current()})),o+=u.move("]: "),l(),!e.url||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),o+=u.move("<"),o+=u.move(n.safe(e.url,{before:o,after:">",...u.current()})),o+=u.move(">")):(l=n.enter("destinationRaw"),o+=u.move(n.safe(e.url,{before:o,after:e.title?" ":`
`,...u.current()}))),l(),e.title&&(l=n.enter(`title${i}`),o+=u.move(" "+a),o+=u.move(n.safe(e.title,{before:o,after:a,...u.current()})),o+=u.move(a),l()),s(),o}function fa(e){const t=e.options.emphasis||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}function qe(e){return"&#x"+e.toString(16).toUpperCase()+";"}const De=We(/[A-Za-z]/),$e=We(/[\dA-Za-z]/),pa=We(/[#-'*+\--9=?A-Z^-~]/);function hn(e){return e!==null&&(e<32||e===127)}const fn=We(/\d/),ga=We(/[\dA-Fa-f]/),ma=We(/[!-/:-@[-`{-~]/);function H(e){return e!==null&&e<-2}function me(e){return e!==null&&(e<0||e===32)}function G(e){return e===-2||e===-1||e===32}const ya=We(new RegExp("\\p{P}|\\p{S}","u")),va=We(/\s/);function We(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function Vt(e){if(e===null||me(e)||va(e))return 1;if(ya(e))return 2}function zt(e,t,n){const r=Vt(e),a=Vt(t);return r===void 0?a===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Sr.peek=ka;function Sr(e,t,n,r){const a=fa(n),i=n.enter("emphasis"),s=n.createTracker(r),l=s.move(a);let u=s.move(n.containerPhrasing(e,{after:a,before:l,...s.current()}));const o=u.charCodeAt(0),c=zt(r.before.charCodeAt(r.before.length-1),o,a);c.inside&&(u=qe(o)+u.slice(1));const h=u.charCodeAt(u.length-1),f=zt(r.after.charCodeAt(0),h,a);f.inside&&(u=u.slice(0,-1)+qe(h));const d=s.move(a);return i(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},l+u+d}function ka(e,t,n){return n.options.emphasis||"*"}const On=(function(e){if(e==null)return Ca;if(typeof e=="function")return Xt(e);if(typeof e=="object")return Array.isArray(e)?ba(e):xa(e);if(typeof e=="string")return wa(e);throw new Error("Expected function, string, or object as test")});function ba(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=On(e[n]);return Xt(r);function r(...a){let i=-1;for(;++i<t.length;)if(t[i].apply(this,a))return!0;return!1}}function xa(e){const t=e;return Xt(n);function n(r){const a=r;let i;for(i in e)if(a[i]!==t[i])return!1;return!0}}function wa(e){return Xt(t);function t(n){return n&&n.type===e}}function Xt(e){return t;function t(n,r,a){return!!(Sa(n)&&e.call(this,n,typeof r=="number"?r:void 0,a||void 0))}}function Ca(){return!0}function Sa(e){return e!==null&&typeof e=="object"&&"type"in e}const Er=[],Ea=!0,pn=!1,$a="skip";function Ia(e,t,n,r){let a;typeof t=="function"&&typeof n!="function"?(r=n,n=t):a=t;const i=On(a),s=r?-1:1;l(e,void 0,[])();function l(u,o,c){const h=u&&typeof u=="object"?u:{};if(typeof h.type=="string"){const d=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(u.type+(d?"<"+d+">":""))+")"})}return f;function f(){let d=Er,k,C,_;if((!t||i(u,o,c[c.length-1]||void 0))&&(d=Pa(n(u,c)),d[0]===pn))return d;if("children"in u&&u.children){const x=u;if(x.children&&d[0]!==$a)for(C=(r?x.children.length:-1)+s,_=c.concat(x);C>-1&&C<x.children.length;){const N=x.children[C];if(k=l(N,C,_)(),k[0]===pn)return k;C=typeof k[1]=="number"?k[1]:C+s}}return d}}}function Pa(e){return Array.isArray(e)?e:typeof e=="number"?[Ea,e]:e==null?Er:[e]}function Oa(e,t,n,r){let a,i,s;typeof t=="function"&&typeof n!="function"?(i=void 0,s=t,a=n):(i=t,s=n,a=r),Ia(e,i,l,a);function l(u,o){const c=o[o.length-1],h=c?c.children.indexOf(u):void 0;return s(u,h,c)}}function $r(e,t){let n=!1;return Oa(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,pn}),!!((!e.depth||e.depth<3)&&Yt(e)&&(t.options.setext||n))}function Da(e,t,n,r){const a=Math.max(Math.min(6,e.depth||1),1),i=n.createTracker(r);if($r(e,n)){const c=n.enter("headingSetext"),h=n.enter("phrasing"),f=n.containerPhrasing(e,{...i.current(),before:`
`,after:`
`});return h(),c(),f+`
`+(a===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const s="#".repeat(a),l=n.enter("headingAtx"),u=n.enter("phrasing");i.move(s+" ");let o=n.containerPhrasing(e,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(o)&&(o=qe(o.charCodeAt(0))+o.slice(1)),o=o?s+" "+o:s,n.options.closeAtx&&(o+=" "+s),u(),l(),o}Ir.peek=Ta;function Ir(e){return e.value||""}function Ta(){return"<"}Pr.peek=Aa;function Pr(e,t,n,r){const a=Pn(n),i=a==='"'?"Quote":"Apostrophe",s=n.enter("image");let l=n.enter("label");const u=n.createTracker(r);let o=u.move("![");return o+=u.move(n.safe(e.alt,{before:o,after:"]",...u.current()})),o+=u.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),o+=u.move("<"),o+=u.move(n.safe(e.url,{before:o,after:">",...u.current()})),o+=u.move(">")):(l=n.enter("destinationRaw"),o+=u.move(n.safe(e.url,{before:o,after:e.title?" ":")",...u.current()}))),l(),e.title&&(l=n.enter(`title${i}`),o+=u.move(" "+a),o+=u.move(n.safe(e.title,{before:o,after:a,...u.current()})),o+=u.move(a),l()),o+=u.move(")"),s(),o}function Aa(){return"!"}Or.peek=_a;function Or(e,t,n,r){const a=e.referenceType,i=n.enter("imageReference");let s=n.enter("label");const l=n.createTracker(r);let u=l.move("![");const o=n.safe(e.alt,{before:u,after:"]",...l.current()});u+=l.move(o+"]["),s();const c=n.stack;n.stack=[],s=n.enter("reference");const h=n.safe(n.associationId(e),{before:u,after:"]",...l.current()});return s(),n.stack=c,i(),a==="full"||!o||o!==h?u+=l.move(h+"]"):a==="shortcut"?u=u.slice(0,-1):u+=l.move("]"),u}function _a(){return"!"}Dr.peek=La;function Dr(e,t,n){let r=e.value||"",a="`",i=-1;for(;new RegExp("(^|[^`])"+a+"([^`]|$)").test(r);)a+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++i<n.unsafe.length;){const s=n.unsafe[i],l=n.compilePattern(s);let u;if(s.atBreak)for(;u=l.exec(r);){let o=u.index;r.charCodeAt(o)===10&&r.charCodeAt(o-1)===13&&o--,r=r.slice(0,o)+" "+r.slice(u.index+1)}}return a+r+a}function La(){return"`"}function Tr(e,t){const n=Yt(e);return!!(!t.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}Ar.peek=Fa;function Ar(e,t,n,r){const a=Pn(n),i=a==='"'?"Quote":"Apostrophe",s=n.createTracker(r);let l,u;if(Tr(e,n)){const c=n.stack;n.stack=[],l=n.enter("autolink");let h=s.move("<");return h+=s.move(n.containerPhrasing(e,{before:h,after:">",...s.current()})),h+=s.move(">"),l(),n.stack=c,h}l=n.enter("link"),u=n.enter("label");let o=s.move("[");return o+=s.move(n.containerPhrasing(e,{before:o,after:"](",...s.current()})),o+=s.move("]("),u(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(u=n.enter("destinationLiteral"),o+=s.move("<"),o+=s.move(n.safe(e.url,{before:o,after:">",...s.current()})),o+=s.move(">")):(u=n.enter("destinationRaw"),o+=s.move(n.safe(e.url,{before:o,after:e.title?" ":")",...s.current()}))),u(),e.title&&(u=n.enter(`title${i}`),o+=s.move(" "+a),o+=s.move(n.safe(e.title,{before:o,after:a,...s.current()})),o+=s.move(a),u()),o+=s.move(")"),l(),o}function Fa(e,t,n){return Tr(e,n)?"<":"["}_r.peek=Va;function _r(e,t,n,r){const a=e.referenceType,i=n.enter("linkReference");let s=n.enter("label");const l=n.createTracker(r);let u=l.move("[");const o=n.containerPhrasing(e,{before:u,after:"]",...l.current()});u+=l.move(o+"]["),s();const c=n.stack;n.stack=[],s=n.enter("reference");const h=n.safe(n.associationId(e),{before:u,after:"]",...l.current()});return s(),n.stack=c,i(),a==="full"||!o||o!==h?u+=l.move(h+"]"):a==="shortcut"?u=u.slice(0,-1):u+=l.move("]"),u}function Va(){return"["}function Dn(e){const t=e.options.bullet||"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function za(e){const t=Dn(e),n=e.options.bulletOther;if(!n)return t==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}function Ba(e){const t=e.options.bulletOrdered||".";if(t!=="."&&t!==")")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}function Lr(e){const t=e.options.rule||"*";if(t!=="*"&&t!=="-"&&t!=="_")throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function Na(e,t,n,r){const a=n.enter("list"),i=n.bulletCurrent;let s=e.ordered?Ba(n):Dn(n);const l=e.ordered?s==="."?")":".":za(n);let u=t&&n.bulletLastUsed?s===n.bulletLastUsed:!1;if(!e.ordered){const c=e.children?e.children[0]:void 0;if((s==="*"||s==="-")&&c&&(!c.children||!c.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(u=!0),Lr(n)===s&&c){let h=-1;for(;++h<e.children.length;){const f=e.children[h];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){u=!0;break}}}}u&&(s=l),n.bulletCurrent=s;const o=n.containerFlow(e,r);return n.bulletLastUsed=s,n.bulletCurrent=i,a(),o}function Ma(e){const t=e.options.listItemIndent||"one";if(t!=="tab"&&t!=="one"&&t!=="mixed")throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}function ja(e,t,n,r){const a=Ma(n);let i=n.bulletCurrent||Dn(n);t&&t.type==="list"&&t.ordered&&(i=(typeof t.start=="number"&&t.start>-1?t.start:1)+(n.options.incrementListMarker===!1?0:t.children.indexOf(e))+i);let s=i.length+1;(a==="tab"||a==="mixed"&&(t&&t.type==="list"&&t.spread||e.spread))&&(s=Math.ceil(s/4)*4);const l=n.createTracker(r);l.move(i+" ".repeat(s-i.length)),l.shift(s);const u=n.enter("listItem"),o=n.indentLines(n.containerFlow(e,l.current()),c);return u(),o;function c(h,f,d){return f?(d?"":" ".repeat(s))+h:(d?i:i+" ".repeat(s-i.length))+h}}function Ua(e,t,n,r){const a=n.enter("paragraph"),i=n.enter("phrasing"),s=n.containerPhrasing(e,r);return i(),a(),s}const Ra=On(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Ha(e,t,n,r){return(e.children.some(function(s){return Ra(s)})?n.containerPhrasing:n.containerFlow).call(n,e,r)}function qa(e){const t=e.options.strong||"*";if(t!=="*"&&t!=="_")throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}Fr.peek=Ka;function Fr(e,t,n,r){const a=qa(n),i=n.enter("strong"),s=n.createTracker(r),l=s.move(a+a);let u=s.move(n.containerPhrasing(e,{after:a,before:l,...s.current()}));const o=u.charCodeAt(0),c=zt(r.before.charCodeAt(r.before.length-1),o,a);c.inside&&(u=qe(o)+u.slice(1));const h=u.charCodeAt(u.length-1),f=zt(r.after.charCodeAt(0),h,a);f.inside&&(u=u.slice(0,-1)+qe(h));const d=s.move(a+a);return i(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},l+u+d}function Ka(e,t,n){return n.options.strong||"*"}function Wa(e,t,n,r){return n.safe(e.value,r)}function Ja(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}function Qa(e,t,n){const r=(Lr(n)+(n.options.ruleSpaces?" ":"")).repeat(Ja(n));return n.options.ruleSpaces?r.slice(0,-1):r}const Ya={blockquote:sa,break:Hn,code:ca,definition:ha,emphasis:Sr,hardBreak:Hn,heading:Da,html:Ir,image:Pr,imageReference:Or,inlineCode:Dr,link:Ar,linkReference:_r,list:Na,listItem:ja,paragraph:Ua,root:Ha,strong:Fr,text:Wa,thematicBreak:Qa},Xa=[Za];function Za(e,t,n,r){if(t.type==="code"&&dn(t,r)&&(e.type==="list"||e.type===t.type&&dn(e,r)))return!1;if("spread"in n&&typeof n.spread=="boolean")return e.type==="paragraph"&&(e.type===t.type||t.type==="definition"||t.type==="heading"&&$r(t,r))?void 0:n.spread?1:0}const Ye=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],Ga=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:Ye},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:Ye},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:Ye},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:Ye},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:Ye},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:Ye},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:Ye},{atBreak:!0,character:"~"}],qn=document.createElement("i");function Tn(e){const t="&"+e+";";qn.innerHTML=t;const n=qn.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}function Vr(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"�":String.fromCodePoint(n)}const es=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function zr(e){return e.replace(es,ts)}function ts(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const a=n.charCodeAt(1),i=a===120||a===88;return Vr(n.slice(i?2:1),i?16:10)}return Tn(n)||e}function ns(e){return e.label||!e.identifier?e.label||"":zr(e.identifier)}function rs(e){if(!e._compiled){const t=(e.atBreak?"[\\r\\n][\\t ]*":"")+(e.before?"(?:"+e.before+")":"");e._compiled=new RegExp((t?"("+t+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(e.character)?"\\":"")+e.character+(e.after?"(?:"+e.after+")":""),"g")}return e._compiled}function is(e,t,n){const r=t.indexStack,a=e.children||[],i=[];let s=-1,l=n.before,u;r.push(-1);let o=t.createTracker(n);for(;++s<a.length;){const c=a[s];let h;if(r[r.length-1]=s,s+1<a.length){let k=t.handle.handlers[a[s+1].type];k&&k.peek&&(k=k.peek),h=k?k(a[s+1],e,t,{before:"",after:"",...o.current()}).charAt(0):""}else h=n.after;i.length>0&&(l==="\r"||l===`
`)&&c.type==="html"&&(i[i.length-1]=i[i.length-1].replace(/(\r?\n|\r)$/," "),l=" ",o=t.createTracker(n),o.move(i.join("")));let f=t.handle(c,e,t,{...o.current(),after:h,before:l});u&&u===f.slice(0,1)&&(f=qe(u.charCodeAt(0))+f.slice(1));const d=t.attentionEncodeSurroundingInfo;t.attentionEncodeSurroundingInfo=void 0,u=void 0,d&&(i.length>0&&d.before&&l===i[i.length-1].slice(-1)&&(i[i.length-1]=i[i.length-1].slice(0,-1)+qe(l.charCodeAt(0))),d.after&&(u=h)),o.move(f),i.push(f),l=f.slice(-1)}return r.pop(),i.join("")}function as(e,t,n){const r=t.indexStack,a=e.children||[],i=t.createTracker(n),s=[];let l=-1;for(r.push(-1);++l<a.length;){const u=a[l];r[r.length-1]=l,s.push(i.move(t.handle(u,e,t,{before:`
`,after:`
`,...i.current()}))),u.type!=="list"&&(t.bulletLastUsed=void 0),l<a.length-1&&s.push(i.move(ss(u,a[l+1],e,t)))}return r.pop(),s.join("")}function ss(e,t,n,r){let a=r.join.length;for(;a--;){const i=r.join[a](e,t,n,r);if(i===!0||i===1)break;if(typeof i=="number")return`
`.repeat(1+i);if(i===!1)return`

<!---->

`}return`

`}const ls=/\r?\n|\r/g;function os(e,t){const n=[];let r=0,a=0,i;for(;i=ls.exec(e);)s(e.slice(r,i.index)),n.push(i[0]),r=i.index+i[0].length,a++;return s(e.slice(r)),n.join("");function s(l){n.push(t(l,a,!l))}}function us(e,t,n){const r=(n.before||"")+(t||"")+(n.after||""),a=[],i=[],s={};let l=-1;for(;++l<e.unsafe.length;){const c=e.unsafe[l];if(!Cr(e.stack,c))continue;const h=e.compilePattern(c);let f;for(;f=h.exec(r);){const d="before"in c||!!c.atBreak,k="after"in c,C=f.index+(d?f[1].length:0);a.includes(C)?(s[C].before&&!d&&(s[C].before=!1),s[C].after&&!k&&(s[C].after=!1)):(a.push(C),s[C]={before:d,after:k})}}a.sort(cs);let u=n.before?n.before.length:0;const o=r.length-(n.after?n.after.length:0);for(l=-1;++l<a.length;){const c=a[l];c<u||c>=o||c+1<o&&a[l+1]===c+1&&s[c].after&&!s[c+1].before&&!s[c+1].after||a[l-1]===c-1&&s[c].before&&!s[c-1].before&&!s[c-1].after||(u!==c&&i.push(Kn(r.slice(u,c),"\\")),u=c,/[!-/:-@[-`{-~]/.test(r.charAt(c))&&(!n.encode||!n.encode.includes(r.charAt(c)))?i.push("\\"):(i.push(qe(r.charCodeAt(c))),u++))}return i.push(Kn(r.slice(u,o),n.after)),i.join("")}function cs(e,t){return e-t}function Kn(e,t){const n=/\\(?=[!-/:-@[-`{-~])/g,r=[],a=[],i=e+t;let s=-1,l=0,u;for(;u=n.exec(i);)r.push(u.index);for(;++s<r.length;)l!==r[s]&&a.push(e.slice(l,r[s])),a.push("\\"),l=r[s];return a.push(e.slice(l)),a.join("")}function ds(e){const t=e||{},n=t.now||{};let r=t.lineShift||0,a=n.line||1,i=n.column||1;return{move:u,current:s,shift:l};function s(){return{now:{line:a,column:i},lineShift:r}}function l(o){r+=o}function u(o){const c=o||"",h=c.split(/\r?\n|\r/g),f=h[h.length-1];return a+=h.length-1,i=h.length===1?i+f.length:1+f.length+r,c}}function hs(e,t){const n={},r={associationId:ns,containerPhrasing:ms,containerFlow:ys,createTracker:ds,compilePattern:rs,enter:i,handlers:{...Ya},handle:void 0,indentLines:os,indexStack:[],join:[...Xa],options:{},safe:vs,stack:[],unsafe:[...Ga]};wr(r,n),r.options.tightDefinitions&&r.join.push(gs),r.handle=ra("type",{invalid:fs,unknown:ps,handlers:r.handlers});let a=r.handle(e,void 0,r,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return a&&a.charCodeAt(a.length-1)!==10&&a.charCodeAt(a.length-1)!==13&&(a+=`
`),a;function i(s){return r.stack.push(s),l;function l(){r.stack.pop()}}}function fs(e){throw new Error("Cannot handle value `"+e+"`, expected node")}function ps(e){const t=e;throw new Error("Cannot handle unknown node `"+t.type+"`")}function gs(e,t){if(e.type==="definition"&&e.type===t.type)return 0}function ms(e,t){return is(e,this,t)}function ys(e,t){return as(e,this,t)}function vs(e,t){return us(this,e,t)}function _e(e,t,n,r){const a=e.length;let i=0,s;if(t<0?t=-t>a?0:a+t:t=t>a?a:t,n=n>0?n:0,r.length<1e4)s=Array.from(r),s.unshift(t,n),e.splice(...s);else for(n&&e.splice(t,n);i<r.length;)s=r.slice(i,i+1e4),s.unshift(t,0),e.splice(...s),i+=1e4,t+=1e4}function Se(e,t){return e.length>0?(_e(e,e.length,0,t),e):t}const Wn={}.hasOwnProperty;function ks(e){const t={};let n=-1;for(;++n<e.length;)bs(t,e[n]);return t}function bs(e,t){let n;for(n in t){const a=(Wn.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n];let s;if(i)for(s in i){Wn.call(a,s)||(a[s]=[]);const l=i[s];xs(a[s],Array.isArray(l)?l:l?[l]:[])}}}function xs(e,t){let n=-1;const r=[];for(;++n<t.length;)(t[n].add==="after"?e:r).push(t[n]);_e(e,0,0,r)}function ot(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}function ae(e,t,n,r){const a=r?r-1:Number.POSITIVE_INFINITY;let i=0;return s;function s(u){return G(u)?(e.enter(n),l(u)):t(u)}function l(u){return G(u)&&i++<a?(e.consume(u),l):(e.exit(n),t(u))}}const ws={tokenize:Cs};function Cs(e){const t=e.attempt(this.parser.constructs.contentInitial,r,a);let n;return t;function r(l){if(l===null){e.consume(l);return}return e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),ae(e,t,"linePrefix")}function a(l){return e.enter("paragraph"),i(l)}function i(l){const u=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=u),n=u,s(l)}function s(l){if(l===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(l);return}return H(l)?(e.consume(l),e.exit("chunkText"),i):(e.consume(l),s)}}const Ss={tokenize:Es},Jn={tokenize:$s};function Es(e){const t=this,n=[];let r=0,a,i,s;return l;function l(A){if(r<n.length){const j=n[r];return t.containerState=j[1],e.attempt(j[0].continuation,u,o)(A)}return o(A)}function u(A){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,a&&N();const j=t.events.length;let Q=j,w;for(;Q--;)if(t.events[Q][0]==="exit"&&t.events[Q][1].type==="chunkFlow"){w=t.events[Q][1].end;break}x(r);let W=j;for(;W<t.events.length;)t.events[W][1].end={...w},W++;return _e(t.events,Q+1,0,t.events.slice(j)),t.events.length=W,o(A)}return l(A)}function o(A){if(r===n.length){if(!a)return f(A);if(a.currentConstruct&&a.currentConstruct.concrete)return k(A);t.interrupt=!!(a.currentConstruct&&!a._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Jn,c,h)(A)}function c(A){return a&&N(),x(r),f(A)}function h(A){return t.parser.lazy[t.now().line]=r!==n.length,s=t.now().offset,k(A)}function f(A){return t.containerState={},e.attempt(Jn,d,k)(A)}function d(A){return r++,n.push([t.currentConstruct,t.containerState]),f(A)}function k(A){if(A===null){a&&N(),x(0),e.consume(A);return}return a=a||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:a,contentType:"flow",previous:i}),C(A)}function C(A){if(A===null){_(e.exit("chunkFlow"),!0),x(0),e.consume(A);return}return H(A)?(e.consume(A),_(e.exit("chunkFlow")),r=0,t.interrupt=void 0,l):(e.consume(A),C)}function _(A,j){const Q=t.sliceStream(A);if(j&&Q.push(null),A.previous=i,i&&(i.next=A),i=A,a.defineSkip(A.start),a.write(Q),t.parser.lazy[A.start.line]){let w=a.events.length;for(;w--;)if(a.events[w][1].start.offset<s&&(!a.events[w][1].end||a.events[w][1].end.offset>s))return;const W=t.events.length;let Y=W,X,te;for(;Y--;)if(t.events[Y][0]==="exit"&&t.events[Y][1].type==="chunkFlow"){if(X){te=t.events[Y][1].end;break}X=!0}for(x(r),w=W;w<t.events.length;)t.events[w][1].end={...te},w++;_e(t.events,Y+1,0,t.events.slice(W)),t.events.length=w}}function x(A){let j=n.length;for(;j-- >A;){const Q=n[j];t.containerState=Q[1],Q[0].exit.call(t,e)}n.length=A}function N(){a.write([null]),i=void 0,a=void 0,t.containerState._closeFlow=void 0}}function $s(e,t,n){return ae(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function An(e,t,n){const r=[];let a=-1;for(;++a<e.length;){const i=e[a].resolveAll;i&&!r.includes(i)&&(t=i(t,n),r.push(i))}return t}const gn={name:"attention",resolveAll:Is,tokenize:Ps};function Is(e,t){let n=-1,r,a,i,s,l,u,o,c;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;u=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const h={...e[r][1].end},f={...e[n][1].start};Qn(h,-u),Qn(f,u),s={type:u>1?"strongSequence":"emphasisSequence",start:h,end:{...e[r][1].end}},l={type:u>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:f},i={type:u>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[n][1].start}},a={type:u>1?"strong":"emphasis",start:{...s.start},end:{...l.end}},e[r][1].end={...s.start},e[n][1].start={...l.end},o=[],e[r][1].end.offset-e[r][1].start.offset&&(o=Se(o,[["enter",e[r][1],t],["exit",e[r][1],t]])),o=Se(o,[["enter",a,t],["enter",s,t],["exit",s,t],["enter",i,t]]),o=Se(o,An(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),o=Se(o,[["exit",i,t],["enter",l,t],["exit",l,t],["exit",a,t]]),e[n][1].end.offset-e[n][1].start.offset?(c=2,o=Se(o,[["enter",e[n][1],t],["exit",e[n][1],t]])):c=0,_e(e,r-1,n-r+3,o),n=r+o.length-c-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function Ps(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,a=Vt(r);let i;return s;function s(u){return i=u,e.enter("attentionSequence"),l(u)}function l(u){if(u===i)return e.consume(u),l;const o=e.exit("attentionSequence"),c=Vt(u),h=!c||c===2&&a||n.includes(u),f=!a||a===2&&c||n.includes(r);return o._open=!!(i===42?h:h&&(a||!f)),o._close=!!(i===42?f:f&&(c||!h)),t(u)}}function Qn(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const Os={name:"autolink",tokenize:Ds};function Ds(e,t,n){let r=0;return a;function a(d){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(d),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}function i(d){return De(d)?(e.consume(d),s):d===64?n(d):o(d)}function s(d){return d===43||d===45||d===46||$e(d)?(r=1,l(d)):o(d)}function l(d){return d===58?(e.consume(d),r=0,u):(d===43||d===45||d===46||$e(d))&&r++<32?(e.consume(d),l):(r=0,o(d))}function u(d){return d===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(d),e.exit("autolinkMarker"),e.exit("autolink"),t):d===null||d===32||d===60||hn(d)?n(d):(e.consume(d),u)}function o(d){return d===64?(e.consume(d),c):pa(d)?(e.consume(d),o):n(d)}function c(d){return $e(d)?h(d):n(d)}function h(d){return d===46?(e.consume(d),r=0,c):d===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(d),e.exit("autolinkMarker"),e.exit("autolink"),t):f(d)}function f(d){if((d===45||$e(d))&&r++<63){const k=d===45?f:h;return e.consume(d),k}return n(d)}}const Zt={partial:!0,tokenize:Ts};function Ts(e,t,n){return r;function r(i){return G(i)?ae(e,a,"linePrefix")(i):a(i)}function a(i){return i===null||H(i)?t(i):n(i)}}const Br={continuation:{tokenize:_s},exit:Ls,name:"blockQuote",tokenize:As};function As(e,t,n){const r=this;return a;function a(s){if(s===62){const l=r.containerState;return l.open||(e.enter("blockQuote",{_container:!0}),l.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(s),e.exit("blockQuoteMarker"),i}return n(s)}function i(s){return G(s)?(e.enter("blockQuotePrefixWhitespace"),e.consume(s),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(s))}}function _s(e,t,n){const r=this;return a;function a(s){return G(s)?ae(e,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):i(s)}function i(s){return e.attempt(Br,t,n)(s)}}function Ls(e){e.exit("blockQuote")}const Nr={name:"characterEscape",tokenize:Fs};function Fs(e,t,n){return r;function r(i){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(i),e.exit("escapeMarker"),a}function a(i){return ma(i)?(e.enter("characterEscapeValue"),e.consume(i),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(i)}}const Mr={name:"characterReference",tokenize:Vs};function Vs(e,t,n){const r=this;let a=0,i,s;return l;function l(h){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(h),e.exit("characterReferenceMarker"),u}function u(h){return h===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(h),e.exit("characterReferenceMarkerNumeric"),o):(e.enter("characterReferenceValue"),i=31,s=$e,c(h))}function o(h){return h===88||h===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(h),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,s=ga,c):(e.enter("characterReferenceValue"),i=7,s=fn,c(h))}function c(h){if(h===59&&a){const f=e.exit("characterReferenceValue");return s===$e&&!Tn(r.sliceSerialize(f))?n(h):(e.enter("characterReferenceMarker"),e.consume(h),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return s(h)&&a++<i?(e.consume(h),c):n(h)}}const Yn={partial:!0,tokenize:Bs},Xn={concrete:!0,name:"codeFenced",tokenize:zs};function zs(e,t,n){const r=this,a={partial:!0,tokenize:Q};let i=0,s=0,l;return u;function u(w){return o(w)}function o(w){const W=r.events[r.events.length-1];return i=W&&W[1].type==="linePrefix"?W[2].sliceSerialize(W[1],!0).length:0,l=w,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),c(w)}function c(w){return w===l?(s++,e.consume(w),c):s<3?n(w):(e.exit("codeFencedFenceSequence"),G(w)?ae(e,h,"whitespace")(w):h(w))}function h(w){return w===null||H(w)?(e.exit("codeFencedFence"),r.interrupt?t(w):e.check(Yn,C,j)(w)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),f(w))}function f(w){return w===null||H(w)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),h(w)):G(w)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),ae(e,d,"whitespace")(w)):w===96&&w===l?n(w):(e.consume(w),f)}function d(w){return w===null||H(w)?h(w):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),k(w))}function k(w){return w===null||H(w)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),h(w)):w===96&&w===l?n(w):(e.consume(w),k)}function C(w){return e.attempt(a,j,_)(w)}function _(w){return e.enter("lineEnding"),e.consume(w),e.exit("lineEnding"),x}function x(w){return i>0&&G(w)?ae(e,N,"linePrefix",i+1)(w):N(w)}function N(w){return w===null||H(w)?e.check(Yn,C,j)(w):(e.enter("codeFlowValue"),A(w))}function A(w){return w===null||H(w)?(e.exit("codeFlowValue"),N(w)):(e.consume(w),A)}function j(w){return e.exit("codeFenced"),t(w)}function Q(w,W,Y){let X=0;return te;function te(M){return w.enter("lineEnding"),w.consume(M),w.exit("lineEnding"),B}function B(M){return w.enter("codeFencedFence"),G(M)?ae(w,S,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(M):S(M)}function S(M){return M===l?(w.enter("codeFencedFenceSequence"),O(M)):Y(M)}function O(M){return M===l?(X++,w.consume(M),O):X>=s?(w.exit("codeFencedFenceSequence"),G(M)?ae(w,D,"whitespace")(M):D(M)):Y(M)}function D(M){return M===null||H(M)?(w.exit("codeFencedFence"),W(M)):Y(M)}}}function Bs(e,t,n){const r=this;return a;function a(s){return s===null?n(s):(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),i)}function i(s){return r.parser.lazy[r.now().line]?n(s):t(s)}}const tn={name:"codeIndented",tokenize:Ms},Ns={partial:!0,tokenize:js};function Ms(e,t,n){const r=this;return a;function a(o){return e.enter("codeIndented"),ae(e,i,"linePrefix",5)(o)}function i(o){const c=r.events[r.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?s(o):n(o)}function s(o){return o===null?u(o):H(o)?e.attempt(Ns,s,u)(o):(e.enter("codeFlowValue"),l(o))}function l(o){return o===null||H(o)?(e.exit("codeFlowValue"),s(o)):(e.consume(o),l)}function u(o){return e.exit("codeIndented"),t(o)}}function js(e,t,n){const r=this;return a;function a(s){return r.parser.lazy[r.now().line]?n(s):H(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),a):ae(e,i,"linePrefix",5)(s)}function i(s){const l=r.events[r.events.length-1];return l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?t(s):H(s)?a(s):n(s)}}const Us={name:"codeText",previous:Hs,resolve:Rs,tokenize:qs};function Rs(e){let t=e.length-4,n=3,r,a;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)a===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(a=r):(r===t||e[r][1].type==="lineEnding")&&(e[a][1].type="codeTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),t-=r-a-2,r=a+2),a=void 0);return e}function Hs(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function qs(e,t,n){let r=0,a,i;return s;function s(h){return e.enter("codeText"),e.enter("codeTextSequence"),l(h)}function l(h){return h===96?(e.consume(h),r++,l):(e.exit("codeTextSequence"),u(h))}function u(h){return h===null?n(h):h===32?(e.enter("space"),e.consume(h),e.exit("space"),u):h===96?(i=e.enter("codeTextSequence"),a=0,c(h)):H(h)?(e.enter("lineEnding"),e.consume(h),e.exit("lineEnding"),u):(e.enter("codeTextData"),o(h))}function o(h){return h===null||h===32||h===96||H(h)?(e.exit("codeTextData"),u(h)):(e.consume(h),o)}function c(h){return h===96?(e.consume(h),a++,c):a===r?(e.exit("codeTextSequence"),e.exit("codeText"),t(h)):(i.type="codeTextData",o(h))}}class Ks{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(t,r):t>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(t,n,r){const a=n||0;this.setCursor(Math.trunc(t));const i=this.right.splice(this.right.length-a,Number.POSITIVE_INFINITY);return r&&yt(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),yt(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),yt(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);yt(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);yt(this.left,n.reverse())}}}function yt(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function jr(e){const t={};let n=-1,r,a,i,s,l,u,o;const c=new Ks(e);for(;++n<c.length;){for(;n in t;)n=t[n];if(r=c.get(n),n&&r[1].type==="chunkFlow"&&c.get(n-1)[1].type==="listItemPrefix"&&(u=r[1]._tokenizer.events,i=0,i<u.length&&u[i][1].type==="lineEndingBlank"&&(i+=2),i<u.length&&u[i][1].type==="content"))for(;++i<u.length&&u[i][1].type!=="content";)u[i][1].type==="chunkText"&&(u[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(t,Ws(c,n)),n=t[n],o=!0);else if(r[1]._container){for(i=n,a=void 0;i--;)if(s=c.get(i),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank")s[0]==="enter"&&(a&&(c.get(a)[1].type="lineEndingBlank"),s[1].type="lineEnding",a=i);else if(!(s[1].type==="linePrefix"||s[1].type==="listItemIndent"))break;a&&(r[1].end={...c.get(a)[1].start},l=c.slice(a,n),l.unshift(r),c.splice(a,n-a+1,l))}}return _e(e,0,Number.POSITIVE_INFINITY,c.slice(0)),!o}function Ws(e,t){const n=e.get(t)[1],r=e.get(t)[2];let a=t-1;const i=[];let s=n._tokenizer;s||(s=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(s._contentTypeTextTrailing=!0));const l=s.events,u=[],o={};let c,h,f=-1,d=n,k=0,C=0;const _=[C];for(;d;){for(;e.get(++a)[1]!==d;);i.push(a),d._tokenizer||(c=r.sliceStream(d),d.next||c.push(null),h&&s.defineSkip(d.start),d._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(c),d._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),h=d,d=d.next}for(d=n;++f<l.length;)l[f][0]==="exit"&&l[f-1][0]==="enter"&&l[f][1].type===l[f-1][1].type&&l[f][1].start.line!==l[f][1].end.line&&(C=f+1,_.push(C),d._tokenizer=void 0,d.previous=void 0,d=d.next);for(s.events=[],d?(d._tokenizer=void 0,d.previous=void 0):_.pop(),f=_.length;f--;){const x=l.slice(_[f],_[f+1]),N=i.pop();u.push([N,N+x.length-1]),e.splice(N,2,x)}for(u.reverse(),f=-1;++f<u.length;)o[k+u[f][0]]=k+u[f][1],k+=u[f][1]-u[f][0]-1;return o}const Js={resolve:Ys,tokenize:Xs},Qs={partial:!0,tokenize:Zs};function Ys(e){return jr(e),e}function Xs(e,t){let n;return r;function r(l){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),a(l)}function a(l){return l===null?i(l):H(l)?e.check(Qs,s,i)(l):(e.consume(l),a)}function i(l){return e.exit("chunkContent"),e.exit("content"),t(l)}function s(l){return e.consume(l),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,a}}function Zs(e,t,n){const r=this;return a;function a(s){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),ae(e,i,"linePrefix")}function i(s){if(s===null||H(s))return n(s);const l=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?t(s):e.interrupt(r.parser.constructs.flow,n,t)(s)}}function Ur(e,t,n,r,a,i,s,l,u){const o=u||Number.POSITIVE_INFINITY;let c=0;return h;function h(x){return x===60?(e.enter(r),e.enter(a),e.enter(i),e.consume(x),e.exit(i),f):x===null||x===32||x===41||hn(x)?n(x):(e.enter(r),e.enter(s),e.enter(l),e.enter("chunkString",{contentType:"string"}),C(x))}function f(x){return x===62?(e.enter(i),e.consume(x),e.exit(i),e.exit(a),e.exit(r),t):(e.enter(l),e.enter("chunkString",{contentType:"string"}),d(x))}function d(x){return x===62?(e.exit("chunkString"),e.exit(l),f(x)):x===null||x===60||H(x)?n(x):(e.consume(x),x===92?k:d)}function k(x){return x===60||x===62||x===92?(e.consume(x),d):d(x)}function C(x){return!c&&(x===null||x===41||me(x))?(e.exit("chunkString"),e.exit(l),e.exit(s),e.exit(r),t(x)):c<o&&x===40?(e.consume(x),c++,C):x===41?(e.consume(x),c--,C):x===null||x===32||x===40||hn(x)?n(x):(e.consume(x),x===92?_:C)}function _(x){return x===40||x===41||x===92?(e.consume(x),C):C(x)}}function Rr(e,t,n,r,a,i){const s=this;let l=0,u;return o;function o(d){return e.enter(r),e.enter(a),e.consume(d),e.exit(a),e.enter(i),c}function c(d){return l>999||d===null||d===91||d===93&&!u||d===94&&!l&&"_hiddenFootnoteSupport"in s.parser.constructs?n(d):d===93?(e.exit(i),e.enter(a),e.consume(d),e.exit(a),e.exit(r),t):H(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),h(d))}function h(d){return d===null||d===91||d===93||H(d)||l++>999?(e.exit("chunkString"),c(d)):(e.consume(d),u||(u=!G(d)),d===92?f:h)}function f(d){return d===91||d===92||d===93?(e.consume(d),l++,h):h(d)}}function Hr(e,t,n,r,a,i){let s;return l;function l(f){return f===34||f===39||f===40?(e.enter(r),e.enter(a),e.consume(f),e.exit(a),s=f===40?41:f,u):n(f)}function u(f){return f===s?(e.enter(a),e.consume(f),e.exit(a),e.exit(r),t):(e.enter(i),o(f))}function o(f){return f===s?(e.exit(i),u(s)):f===null?n(f):H(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),ae(e,o,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(f))}function c(f){return f===s||f===null||H(f)?(e.exit("chunkString"),o(f)):(e.consume(f),f===92?h:c)}function h(f){return f===s||f===92?(e.consume(f),c):c(f)}}function Ct(e,t){let n;return r;function r(a){return H(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),n=!0,r):G(a)?ae(e,r,n?"linePrefix":"lineSuffix")(a):t(a)}}const Gs={name:"definition",tokenize:tl},el={partial:!0,tokenize:nl};function tl(e,t,n){const r=this;let a;return i;function i(d){return e.enter("definition"),s(d)}function s(d){return Rr.call(r,e,l,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(d)}function l(d){return a=ot(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),d===58?(e.enter("definitionMarker"),e.consume(d),e.exit("definitionMarker"),u):n(d)}function u(d){return me(d)?Ct(e,o)(d):o(d)}function o(d){return Ur(e,c,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(d)}function c(d){return e.attempt(el,h,h)(d)}function h(d){return G(d)?ae(e,f,"whitespace")(d):f(d)}function f(d){return d===null||H(d)?(e.exit("definition"),r.parser.defined.push(a),t(d)):n(d)}}function nl(e,t,n){return r;function r(l){return me(l)?Ct(e,a)(l):n(l)}function a(l){return Hr(e,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(l)}function i(l){return G(l)?ae(e,s,"whitespace")(l):s(l)}function s(l){return l===null||H(l)?t(l):n(l)}}const rl={name:"hardBreakEscape",tokenize:il};function il(e,t,n){return r;function r(i){return e.enter("hardBreakEscape"),e.consume(i),a}function a(i){return H(i)?(e.exit("hardBreakEscape"),t(i)):n(i)}}const al={name:"headingAtx",resolve:sl,tokenize:ll};function sl(e,t){let n=e.length-2,r=3,a,i;return e[r][1].type==="whitespace"&&(r+=2),n-2>r&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&e[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(a={type:"atxHeadingText",start:e[r][1].start,end:e[n][1].end},i={type:"chunkText",start:e[r][1].start,end:e[n][1].end,contentType:"text"},_e(e,r,n-r+1,[["enter",a,t],["enter",i,t],["exit",i,t],["exit",a,t]])),e}function ll(e,t,n){let r=0;return a;function a(c){return e.enter("atxHeading"),i(c)}function i(c){return e.enter("atxHeadingSequence"),s(c)}function s(c){return c===35&&r++<6?(e.consume(c),s):c===null||me(c)?(e.exit("atxHeadingSequence"),l(c)):n(c)}function l(c){return c===35?(e.enter("atxHeadingSequence"),u(c)):c===null||H(c)?(e.exit("atxHeading"),t(c)):G(c)?ae(e,l,"whitespace")(c):(e.enter("atxHeadingText"),o(c))}function u(c){return c===35?(e.consume(c),u):(e.exit("atxHeadingSequence"),l(c))}function o(c){return c===null||c===35||me(c)?(e.exit("atxHeadingText"),l(c)):(e.consume(c),o)}}const ol=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Zn=["pre","script","style","textarea"],ul={concrete:!0,name:"htmlFlow",resolveTo:hl,tokenize:fl},cl={partial:!0,tokenize:gl},dl={partial:!0,tokenize:pl};function hl(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function fl(e,t,n){const r=this;let a,i,s,l,u;return o;function o(g){return c(g)}function c(g){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(g),h}function h(g){return g===33?(e.consume(g),f):g===47?(e.consume(g),i=!0,C):g===63?(e.consume(g),a=3,r.interrupt?t:y):De(g)?(e.consume(g),s=String.fromCharCode(g),_):n(g)}function f(g){return g===45?(e.consume(g),a=2,d):g===91?(e.consume(g),a=5,l=0,k):De(g)?(e.consume(g),a=4,r.interrupt?t:y):n(g)}function d(g){return g===45?(e.consume(g),r.interrupt?t:y):n(g)}function k(g){const re="CDATA[";return g===re.charCodeAt(l++)?(e.consume(g),l===re.length?r.interrupt?t:S:k):n(g)}function C(g){return De(g)?(e.consume(g),s=String.fromCharCode(g),_):n(g)}function _(g){if(g===null||g===47||g===62||me(g)){const re=g===47,de=s.toLowerCase();return!re&&!i&&Zn.includes(de)?(a=1,r.interrupt?t(g):S(g)):ol.includes(s.toLowerCase())?(a=6,re?(e.consume(g),x):r.interrupt?t(g):S(g)):(a=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(g):i?N(g):A(g))}return g===45||$e(g)?(e.consume(g),s+=String.fromCharCode(g),_):n(g)}function x(g){return g===62?(e.consume(g),r.interrupt?t:S):n(g)}function N(g){return G(g)?(e.consume(g),N):te(g)}function A(g){return g===47?(e.consume(g),te):g===58||g===95||De(g)?(e.consume(g),j):G(g)?(e.consume(g),A):te(g)}function j(g){return g===45||g===46||g===58||g===95||$e(g)?(e.consume(g),j):Q(g)}function Q(g){return g===61?(e.consume(g),w):G(g)?(e.consume(g),Q):A(g)}function w(g){return g===null||g===60||g===61||g===62||g===96?n(g):g===34||g===39?(e.consume(g),u=g,W):G(g)?(e.consume(g),w):Y(g)}function W(g){return g===u?(e.consume(g),u=null,X):g===null||H(g)?n(g):(e.consume(g),W)}function Y(g){return g===null||g===34||g===39||g===47||g===60||g===61||g===62||g===96||me(g)?Q(g):(e.consume(g),Y)}function X(g){return g===47||g===62||G(g)?A(g):n(g)}function te(g){return g===62?(e.consume(g),B):n(g)}function B(g){return g===null||H(g)?S(g):G(g)?(e.consume(g),B):n(g)}function S(g){return g===45&&a===2?(e.consume(g),ne):g===60&&a===1?(e.consume(g),Z):g===62&&a===4?(e.consume(g),fe):g===63&&a===3?(e.consume(g),y):g===93&&a===5?(e.consume(g),pe):H(g)&&(a===6||a===7)?(e.exit("htmlFlowData"),e.check(cl,K,O)(g)):g===null||H(g)?(e.exit("htmlFlowData"),O(g)):(e.consume(g),S)}function O(g){return e.check(dl,D,K)(g)}function D(g){return e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),M}function M(g){return g===null||H(g)?O(g):(e.enter("htmlFlowData"),S(g))}function ne(g){return g===45?(e.consume(g),y):S(g)}function Z(g){return g===47?(e.consume(g),s="",oe):S(g)}function oe(g){if(g===62){const re=s.toLowerCase();return Zn.includes(re)?(e.consume(g),fe):S(g)}return De(g)&&s.length<8?(e.consume(g),s+=String.fromCharCode(g),oe):S(g)}function pe(g){return g===93?(e.consume(g),y):S(g)}function y(g){return g===62?(e.consume(g),fe):g===45&&a===2?(e.consume(g),y):S(g)}function fe(g){return g===null||H(g)?(e.exit("htmlFlowData"),K(g)):(e.consume(g),fe)}function K(g){return e.exit("htmlFlow"),t(g)}}function pl(e,t,n){const r=this;return a;function a(s){return H(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),i):n(s)}function i(s){return r.parser.lazy[r.now().line]?n(s):t(s)}}function gl(e,t,n){return r;function r(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),e.attempt(Zt,t,n)}}const ml={name:"htmlText",tokenize:yl};function yl(e,t,n){const r=this;let a,i,s;return l;function l(y){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(y),u}function u(y){return y===33?(e.consume(y),o):y===47?(e.consume(y),Q):y===63?(e.consume(y),A):De(y)?(e.consume(y),Y):n(y)}function o(y){return y===45?(e.consume(y),c):y===91?(e.consume(y),i=0,k):De(y)?(e.consume(y),N):n(y)}function c(y){return y===45?(e.consume(y),d):n(y)}function h(y){return y===null?n(y):y===45?(e.consume(y),f):H(y)?(s=h,Z(y)):(e.consume(y),h)}function f(y){return y===45?(e.consume(y),d):h(y)}function d(y){return y===62?ne(y):y===45?f(y):h(y)}function k(y){const fe="CDATA[";return y===fe.charCodeAt(i++)?(e.consume(y),i===fe.length?C:k):n(y)}function C(y){return y===null?n(y):y===93?(e.consume(y),_):H(y)?(s=C,Z(y)):(e.consume(y),C)}function _(y){return y===93?(e.consume(y),x):C(y)}function x(y){return y===62?ne(y):y===93?(e.consume(y),x):C(y)}function N(y){return y===null||y===62?ne(y):H(y)?(s=N,Z(y)):(e.consume(y),N)}function A(y){return y===null?n(y):y===63?(e.consume(y),j):H(y)?(s=A,Z(y)):(e.consume(y),A)}function j(y){return y===62?ne(y):A(y)}function Q(y){return De(y)?(e.consume(y),w):n(y)}function w(y){return y===45||$e(y)?(e.consume(y),w):W(y)}function W(y){return H(y)?(s=W,Z(y)):G(y)?(e.consume(y),W):ne(y)}function Y(y){return y===45||$e(y)?(e.consume(y),Y):y===47||y===62||me(y)?X(y):n(y)}function X(y){return y===47?(e.consume(y),ne):y===58||y===95||De(y)?(e.consume(y),te):H(y)?(s=X,Z(y)):G(y)?(e.consume(y),X):ne(y)}function te(y){return y===45||y===46||y===58||y===95||$e(y)?(e.consume(y),te):B(y)}function B(y){return y===61?(e.consume(y),S):H(y)?(s=B,Z(y)):G(y)?(e.consume(y),B):X(y)}function S(y){return y===null||y===60||y===61||y===62||y===96?n(y):y===34||y===39?(e.consume(y),a=y,O):H(y)?(s=S,Z(y)):G(y)?(e.consume(y),S):(e.consume(y),D)}function O(y){return y===a?(e.consume(y),a=void 0,M):y===null?n(y):H(y)?(s=O,Z(y)):(e.consume(y),O)}function D(y){return y===null||y===34||y===39||y===60||y===61||y===96?n(y):y===47||y===62||me(y)?X(y):(e.consume(y),D)}function M(y){return y===47||y===62||me(y)?X(y):n(y)}function ne(y){return y===62?(e.consume(y),e.exit("htmlTextData"),e.exit("htmlText"),t):n(y)}function Z(y){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(y),e.exit("lineEnding"),oe}function oe(y){return G(y)?ae(e,pe,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(y):pe(y)}function pe(y){return e.enter("htmlTextData"),s(y)}}const _n={name:"labelEnd",resolveAll:xl,resolveTo:wl,tokenize:Cl},vl={tokenize:Sl},kl={tokenize:El},bl={tokenize:$l};function xl(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const a=r.type==="labelImage"?4:2;r.type="data",t+=a}}return e.length!==n.length&&_e(e,0,e.length,n),e}function wl(e,t){let n=e.length,r=0,a,i,s,l;for(;n--;)if(a=e[n][1],i){if(a.type==="link"||a.type==="labelLink"&&a._inactive)break;e[n][0]==="enter"&&a.type==="labelLink"&&(a._inactive=!0)}else if(s){if(e[n][0]==="enter"&&(a.type==="labelImage"||a.type==="labelLink")&&!a._balanced&&(i=n,a.type!=="labelLink")){r=2;break}}else a.type==="labelEnd"&&(s=n);const u={type:e[i][1].type==="labelLink"?"link":"image",start:{...e[i][1].start},end:{...e[e.length-1][1].end}},o={type:"label",start:{...e[i][1].start},end:{...e[s][1].end}},c={type:"labelText",start:{...e[i+r+2][1].end},end:{...e[s-2][1].start}};return l=[["enter",u,t],["enter",o,t]],l=Se(l,e.slice(i+1,i+r+3)),l=Se(l,[["enter",c,t]]),l=Se(l,An(t.parser.constructs.insideSpan.null,e.slice(i+r+4,s-3),t)),l=Se(l,[["exit",c,t],e[s-2],e[s-1],["exit",o,t]]),l=Se(l,e.slice(s+1)),l=Se(l,[["exit",u,t]]),_e(e,i,e.length,l),e}function Cl(e,t,n){const r=this;let a=r.events.length,i,s;for(;a--;)if((r.events[a][1].type==="labelImage"||r.events[a][1].type==="labelLink")&&!r.events[a][1]._balanced){i=r.events[a][1];break}return l;function l(f){return i?i._inactive?h(f):(s=r.parser.defined.includes(ot(r.sliceSerialize({start:i.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(f),e.exit("labelMarker"),e.exit("labelEnd"),u):n(f)}function u(f){return f===40?e.attempt(vl,c,s?c:h)(f):f===91?e.attempt(kl,c,s?o:h)(f):s?c(f):h(f)}function o(f){return e.attempt(bl,c,h)(f)}function c(f){return t(f)}function h(f){return i._balanced=!0,n(f)}}function Sl(e,t,n){return r;function r(h){return e.enter("resource"),e.enter("resourceMarker"),e.consume(h),e.exit("resourceMarker"),a}function a(h){return me(h)?Ct(e,i)(h):i(h)}function i(h){return h===41?c(h):Ur(e,s,l,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function s(h){return me(h)?Ct(e,u)(h):c(h)}function l(h){return n(h)}function u(h){return h===34||h===39||h===40?Hr(e,o,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):c(h)}function o(h){return me(h)?Ct(e,c)(h):c(h)}function c(h){return h===41?(e.enter("resourceMarker"),e.consume(h),e.exit("resourceMarker"),e.exit("resource"),t):n(h)}}function El(e,t,n){const r=this;return a;function a(l){return Rr.call(r,e,i,s,"reference","referenceMarker","referenceString")(l)}function i(l){return r.parser.defined.includes(ot(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(l):n(l)}function s(l){return n(l)}}function $l(e,t,n){return r;function r(i){return e.enter("reference"),e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),a}function a(i){return i===93?(e.enter("referenceMarker"),e.consume(i),e.exit("referenceMarker"),e.exit("reference"),t):n(i)}}const Il={name:"labelStartImage",resolveAll:_n.resolveAll,tokenize:Pl};function Pl(e,t,n){const r=this;return a;function a(l){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(l),e.exit("labelImageMarker"),i}function i(l){return l===91?(e.enter("labelMarker"),e.consume(l),e.exit("labelMarker"),e.exit("labelImage"),s):n(l)}function s(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(l):t(l)}}const Ol={name:"labelStartLink",resolveAll:_n.resolveAll,tokenize:Dl};function Dl(e,t,n){const r=this;return a;function a(s){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelLink"),i}function i(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(s):t(s)}}const nn={name:"lineEnding",tokenize:Tl};function Tl(e,t){return n;function n(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),ae(e,t,"linePrefix")}}const At={name:"thematicBreak",tokenize:Al};function Al(e,t,n){let r=0,a;return i;function i(o){return e.enter("thematicBreak"),s(o)}function s(o){return a=o,l(o)}function l(o){return o===a?(e.enter("thematicBreakSequence"),u(o)):r>=3&&(o===null||H(o))?(e.exit("thematicBreak"),t(o)):n(o)}function u(o){return o===a?(e.consume(o),r++,u):(e.exit("thematicBreakSequence"),G(o)?ae(e,l,"whitespace")(o):l(o))}}const ge={continuation:{tokenize:Vl},exit:Bl,name:"list",tokenize:Fl},_l={partial:!0,tokenize:Nl},Ll={partial:!0,tokenize:zl};function Fl(e,t,n){const r=this,a=r.events[r.events.length-1];let i=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0,s=0;return l;function l(d){const k=r.containerState.type||(d===42||d===43||d===45?"listUnordered":"listOrdered");if(k==="listUnordered"?!r.containerState.marker||d===r.containerState.marker:fn(d)){if(r.containerState.type||(r.containerState.type=k,e.enter(k,{_container:!0})),k==="listUnordered")return e.enter("listItemPrefix"),d===42||d===45?e.check(At,n,o)(d):o(d);if(!r.interrupt||d===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),u(d)}return n(d)}function u(d){return fn(d)&&++s<10?(e.consume(d),u):(!r.interrupt||s<2)&&(r.containerState.marker?d===r.containerState.marker:d===41||d===46)?(e.exit("listItemValue"),o(d)):n(d)}function o(d){return e.enter("listItemMarker"),e.consume(d),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||d,e.check(Zt,r.interrupt?n:c,e.attempt(_l,f,h))}function c(d){return r.containerState.initialBlankLine=!0,i++,f(d)}function h(d){return G(d)?(e.enter("listItemPrefixWhitespace"),e.consume(d),e.exit("listItemPrefixWhitespace"),f):n(d)}function f(d){return r.containerState.size=i+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(d)}}function Vl(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(Zt,a,i);function a(l){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,ae(e,t,"listItemIndent",r.containerState.size+1)(l)}function i(l){return r.containerState.furtherBlankLines||!G(l)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(l)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(Ll,t,s)(l))}function s(l){return r.containerState._closeFlow=!0,r.interrupt=void 0,ae(e,e.attempt(ge,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l)}}function zl(e,t,n){const r=this;return ae(e,a,"listItemIndent",r.containerState.size+1);function a(i){const s=r.events[r.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?t(i):n(i)}}function Bl(e){e.exit(this.containerState.type)}function Nl(e,t,n){const r=this;return ae(e,a,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function a(i){const s=r.events[r.events.length-1];return!G(i)&&s&&s[1].type==="listItemPrefixWhitespace"?t(i):n(i)}}const Gn={name:"setextUnderline",resolveTo:Ml,tokenize:jl};function Ml(e,t){let n=e.length,r,a,i;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){r=n;break}e[n][1].type==="paragraph"&&(a=n)}else e[n][1].type==="content"&&e.splice(n,1),!i&&e[n][1].type==="definition"&&(i=n);const s={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[a][1].type="setextHeadingText",i?(e.splice(a,0,["enter",s,t]),e.splice(i+1,0,["exit",e[r][1],t]),e[r][1].end={...e[i][1].end}):e[r][1]=s,e.push(["exit",s,t]),e}function jl(e,t,n){const r=this;let a;return i;function i(o){let c=r.events.length,h;for(;c--;)if(r.events[c][1].type!=="lineEnding"&&r.events[c][1].type!=="linePrefix"&&r.events[c][1].type!=="content"){h=r.events[c][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||h)?(e.enter("setextHeadingLine"),a=o,s(o)):n(o)}function s(o){return e.enter("setextHeadingLineSequence"),l(o)}function l(o){return o===a?(e.consume(o),l):(e.exit("setextHeadingLineSequence"),G(o)?ae(e,u,"lineSuffix")(o):u(o))}function u(o){return o===null||H(o)?(e.exit("setextHeadingLine"),t(o)):n(o)}}const Ul={tokenize:Rl};function Rl(e){const t=this,n=e.attempt(Zt,r,e.attempt(this.parser.constructs.flowInitial,a,ae(e,e.attempt(this.parser.constructs.flow,a,e.attempt(Js,a)),"linePrefix")));return n;function r(i){if(i===null){e.consume(i);return}return e.enter("lineEndingBlank"),e.consume(i),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function a(i){if(i===null){e.consume(i);return}return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const Hl={resolveAll:Kr()},ql=qr("string"),Kl=qr("text");function qr(e){return{resolveAll:Kr(e==="text"?Wl:void 0),tokenize:t};function t(n){const r=this,a=this.parser.constructs[e],i=n.attempt(a,s,l);return s;function s(c){return o(c)?i(c):l(c)}function l(c){if(c===null){n.consume(c);return}return n.enter("data"),n.consume(c),u}function u(c){return o(c)?(n.exit("data"),i(c)):(n.consume(c),u)}function o(c){if(c===null)return!0;const h=a[c];let f=-1;if(h)for(;++f<h.length;){const d=h[f];if(!d.previous||d.previous.call(r,r.previous))return!0}return!1}}}function Kr(e){return t;function t(n,r){let a=-1,i;for(;++a<=n.length;)i===void 0?n[a]&&n[a][1].type==="data"&&(i=a,a++):(!n[a]||n[a][1].type!=="data")&&(a!==i+2&&(n[i][1].end=n[a-1][1].end,n.splice(i+2,a-i-2),a=i+2),i=void 0);return e?e(n,r):n}}function Wl(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const r=e[n-1][1],a=t.sliceStream(r);let i=a.length,s=-1,l=0,u;for(;i--;){const o=a[i];if(typeof o=="string"){for(s=o.length;o.charCodeAt(s-1)===32;)l++,s--;if(s)break;s=-1}else if(o===-2)u=!0,l++;else if(o!==-1){i++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(l=0),l){const o={type:n===e.length||u||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?s:r.start._bufferIndex+s,_index:r.start._index+i,line:r.end.line,column:r.end.column-l,offset:r.end.offset-l},end:{...r.end}};r.end={...o.start},r.start.offset===r.end.offset?Object.assign(r,o):(e.splice(n,0,["enter",o,t],["exit",o,t]),n+=2)}n++}return e}const Jl={42:ge,43:ge,45:ge,48:ge,49:ge,50:ge,51:ge,52:ge,53:ge,54:ge,55:ge,56:ge,57:ge,62:Br},Ql={91:Gs},Yl={[-2]:tn,[-1]:tn,32:tn},Xl={35:al,42:At,45:[Gn,At],60:ul,61:Gn,95:At,96:Xn,126:Xn},Zl={38:Mr,92:Nr},Gl={[-5]:nn,[-4]:nn,[-3]:nn,33:Il,38:Mr,42:gn,60:[Os,ml],91:Ol,92:[rl,Nr],93:_n,95:gn,96:Us},eo={null:[gn,Hl]},to={null:[42,95]},no={null:[]},ro=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:to,contentInitial:Ql,disable:no,document:Jl,flow:Xl,flowInitial:Yl,insideSpan:eo,string:Zl,text:Gl},Symbol.toStringTag,{value:"Module"}));function io(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const a={},i=[];let s=[],l=[];const u={attempt:W(Q),check:W(w),consume:N,enter:A,exit:j,interrupt:W(w,{interrupt:!0})},o={code:null,containerState:{},defineSkip:C,events:[],now:k,parser:e,previous:null,sliceSerialize:f,sliceStream:d,write:h};let c=t.tokenize.call(o,u);return t.resolveAll&&i.push(t),o;function h(B){return s=Se(s,B),_(),s[s.length-1]!==null?[]:(Y(t,0),o.events=An(i,o.events,o),o.events)}function f(B,S){return so(d(B),S)}function d(B){return ao(s,B)}function k(){const{_bufferIndex:B,_index:S,line:O,column:D,offset:M}=r;return{_bufferIndex:B,_index:S,line:O,column:D,offset:M}}function C(B){a[B.line]=B.column,te()}function _(){let B;for(;r._index<s.length;){const S=s[r._index];if(typeof S=="string")for(B=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===B&&r._bufferIndex<S.length;)x(S.charCodeAt(r._bufferIndex));else x(S)}}function x(B){c=c(B)}function N(B){H(B)?(r.line++,r.column=1,r.offset+=B===-3?2:1,te()):B!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),o.previous=B}function A(B,S){const O=S||{};return O.type=B,O.start=k(),o.events.push(["enter",O,o]),l.push(O),O}function j(B){const S=l.pop();return S.end=k(),o.events.push(["exit",S,o]),S}function Q(B,S){Y(B,S.from)}function w(B,S){S.restore()}function W(B,S){return O;function O(D,M,ne){let Z,oe,pe,y;return Array.isArray(D)?K(D):"tokenize"in D?K([D]):fe(D);function fe(se){return Pe;function Pe(Ne){const it=Ne!==null&&se[Ne],at=Ne!==null&&se.null,Pt=[...Array.isArray(it)?it:it?[it]:[],...Array.isArray(at)?at:at?[at]:[]];return K(Pt)(Ne)}}function K(se){return Z=se,oe=0,se.length===0?ne:g(se[oe])}function g(se){return Pe;function Pe(Ne){return y=X(),pe=se,se.partial||(o.currentConstruct=se),se.name&&o.parser.constructs.disable.null.includes(se.name)?de():se.tokenize.call(S?Object.assign(Object.create(o),S):o,u,re,de)(Ne)}}function re(se){return B(pe,y),M}function de(se){return y.restore(),++oe<Z.length?g(Z[oe]):ne}}}function Y(B,S){B.resolveAll&&!i.includes(B)&&i.push(B),B.resolve&&_e(o.events,S,o.events.length-S,B.resolve(o.events.slice(S),o)),B.resolveTo&&(o.events=B.resolveTo(o.events,o))}function X(){const B=k(),S=o.previous,O=o.currentConstruct,D=o.events.length,M=Array.from(l);return{from:D,restore:ne};function ne(){r=B,o.previous=S,o.currentConstruct=O,o.events.length=D,l=M,te()}}function te(){r.line in a&&r.column<2&&(r.column=a[r.line],r.offset+=a[r.line]-1)}}function ao(e,t){const n=t.start._index,r=t.start._bufferIndex,a=t.end._index,i=t.end._bufferIndex;let s;if(n===a)s=[e[n].slice(r,i)];else{if(s=e.slice(n,a),r>-1){const l=s[0];typeof l=="string"?s[0]=l.slice(r):s.shift()}i>0&&s.push(e[a].slice(0,i))}return s}function so(e,t){let n=-1;const r=[];let a;for(;++n<e.length;){const i=e[n];let s;if(typeof i=="string")s=i;else switch(i){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=t?" ":"	";break}case-1:{if(!t&&a)continue;s=" ";break}default:s=String.fromCharCode(i)}a=i===-2,r.push(s)}return r.join("")}function lo(e){const r={constructs:ks([ro,...(e||{}).extensions||[]]),content:a(ws),defined:[],document:a(Ss),flow:a(Ul),lazy:{},string:a(ql),text:a(Kl)};return r;function a(i){return s;function s(l){return io(r,i,l)}}}function oo(e){for(;!jr(e););return e}const er=/[\0\t\n\r]/g;function uo(){let e=1,t="",n=!0,r;return a;function a(i,s,l){const u=[];let o,c,h,f,d;for(i=t+(typeof i=="string"?i.toString():new TextDecoder(s||void 0).decode(i)),h=0,t="",n&&(i.charCodeAt(0)===65279&&h++,n=void 0);h<i.length;){if(er.lastIndex=h,o=er.exec(i),f=o&&o.index!==void 0?o.index:i.length,d=i.charCodeAt(f),!o){t=i.slice(h);break}if(d===10&&h===f&&r)u.push(-3),r=void 0;else switch(r&&(u.push(-5),r=void 0),h<f&&(u.push(i.slice(h,f)),e+=f-h),d){case 0:{u.push(65533),e++;break}case 9:{for(c=Math.ceil(e/4)*4,u.push(-2);e++<c;)u.push(-1);break}case 10:{u.push(-4),e=1;break}default:r=!0,e=1}h=f+1}return l&&(r&&u.push(-5),t&&u.push(t),u.push(null)),u}}function _t(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?tr(e.position):"start"in e||"end"in e?tr(e):"line"in e||"column"in e?mn(e):""}function mn(e){return nr(e&&e.line)+":"+nr(e&&e.column)}function tr(e){return mn(e&&e.start)+"-"+mn(e&&e.end)}function nr(e){return e&&typeof e=="number"?e:1}const Wr={}.hasOwnProperty;function co(e,t,n){return typeof t!="string"&&(n=t,t=void 0),ho(n)(oo(lo(n).document().write(uo()(e,t,!0))))}function ho(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(zn),autolinkProtocol:X,autolinkEmail:X,atxHeading:i(Ln),blockQuote:i(at),characterEscape:X,characterReference:X,codeFenced:i(Pt),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:i(Pt,s),codeText:i(ti,s),codeTextData:X,data:X,codeFlowValue:X,definition:i(ni),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:i(ri),hardBreakEscape:i(Fn),hardBreakTrailing:i(Fn),htmlFlow:i(Vn,s),htmlFlowData:X,htmlText:i(Vn,s),htmlTextData:X,image:i(ii),label:s,link:i(zn),listItem:i(ai),listItemValue:f,listOrdered:i(Bn,h),listUnordered:i(Bn),paragraph:i(si),reference:g,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:i(Ln),strong:i(li),thematicBreak:i(ui)},exit:{atxHeading:u(),atxHeadingSequence:Q,autolink:u(),autolinkEmail:it,autolinkProtocol:Ne,blockQuote:u(),characterEscapeValue:te,characterReferenceMarkerHexadecimal:de,characterReferenceMarkerNumeric:de,characterReferenceValue:se,characterReference:Pe,codeFenced:u(_),codeFencedFence:C,codeFencedFenceInfo:d,codeFencedFenceMeta:k,codeFlowValue:te,codeIndented:u(x),codeText:u(M),codeTextData:te,data:te,definition:u(),definitionDestinationString:j,definitionLabelString:N,definitionTitleString:A,emphasis:u(),hardBreakEscape:u(S),hardBreakTrailing:u(S),htmlFlow:u(O),htmlFlowData:te,htmlText:u(D),htmlTextData:te,image:u(Z),label:pe,labelText:oe,lineEnding:B,link:u(ne),listItem:u(),listOrdered:u(),listUnordered:u(),paragraph:u(),referenceString:re,resourceDestinationString:y,resourceTitleString:fe,resource:K,setextHeading:u(Y),setextHeadingLineSequence:W,setextHeadingText:w,strong:u(),thematicBreak:u()}};Jr(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(b){let P={type:"root",children:[]};const q={stack:[P],tokenStack:[],config:t,enter:l,exit:o,buffer:s,resume:c,data:n},J=[];let ie=-1;for(;++ie<b.length;)if(b[ie][1].type==="listOrdered"||b[ie][1].type==="listUnordered")if(b[ie][0]==="enter")J.push(ie);else{const Ee=J.pop();ie=a(b,Ee,ie)}for(ie=-1;++ie<b.length;){const Ee=t[b[ie][0]];Wr.call(Ee,b[ie][1].type)&&Ee[b[ie][1].type].call(Object.assign({sliceSerialize:b[ie][2].sliceSerialize},q),b[ie][1])}if(q.tokenStack.length>0){const Ee=q.tokenStack[q.tokenStack.length-1];(Ee[1]||rr).call(q,void 0,Ee[0])}for(P.position={start:Me(b.length>0?b[0][1].start:{line:1,column:1,offset:0}),end:Me(b.length>0?b[b.length-2][1].end:{line:1,column:1,offset:0})},ie=-1;++ie<t.transforms.length;)P=t.transforms[ie](P)||P;return P}function a(b,P,q){let J=P-1,ie=-1,Ee=!1,Je,Le,ft,pt;for(;++J<=q;){const ye=b[J];switch(ye[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ye[0]==="enter"?ie++:ie--,pt=void 0;break}case"lineEndingBlank":{ye[0]==="enter"&&(Je&&!pt&&!ie&&!ft&&(ft=J),pt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:pt=void 0}if(!ie&&ye[0]==="enter"&&ye[1].type==="listItemPrefix"||ie===-1&&ye[0]==="exit"&&(ye[1].type==="listUnordered"||ye[1].type==="listOrdered")){if(Je){let st=J;for(Le=void 0;st--;){const Fe=b[st];if(Fe[1].type==="lineEnding"||Fe[1].type==="lineEndingBlank"){if(Fe[0]==="exit")continue;Le&&(b[Le][1].type="lineEndingBlank",Ee=!0),Fe[1].type="lineEnding",Le=st}else if(!(Fe[1].type==="linePrefix"||Fe[1].type==="blockQuotePrefix"||Fe[1].type==="blockQuotePrefixWhitespace"||Fe[1].type==="blockQuoteMarker"||Fe[1].type==="listItemIndent"))break}ft&&(!Le||ft<Le)&&(Je._spread=!0),Je.end=Object.assign({},Le?b[Le][1].start:ye[1].end),b.splice(Le||J,0,["exit",Je,ye[2]]),J++,q++}if(ye[1].type==="listItemPrefix"){const st={type:"listItem",_spread:!1,start:Object.assign({},ye[1].start),end:void 0};Je=st,b.splice(J,0,["enter",st,ye[2]]),J++,q++,ft=void 0,pt=!0}}}return b[P][1]._spread=Ee,q}function i(b,P){return q;function q(J){l.call(this,b(J),J),P&&P.call(this,J)}}function s(){this.stack.push({type:"fragment",children:[]})}function l(b,P,q){this.stack[this.stack.length-1].children.push(b),this.stack.push(b),this.tokenStack.push([P,q||void 0]),b.position={start:Me(P.start),end:void 0}}function u(b){return P;function P(q){b&&b.call(this,q),o.call(this,q)}}function o(b,P){const q=this.stack.pop(),J=this.tokenStack.pop();if(J)J[0].type!==b.type&&(P?P.call(this,b,J[0]):(J[1]||rr).call(this,b,J[0]));else throw new Error("Cannot close `"+b.type+"` ("+_t({start:b.start,end:b.end})+"): it’s not open");q.position.end=Me(b.end)}function c(){return Yt(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function f(b){if(this.data.expectingFirstListItemValue){const P=this.stack[this.stack.length-2];P.start=Number.parseInt(this.sliceSerialize(b),10),this.data.expectingFirstListItemValue=void 0}}function d(){const b=this.resume(),P=this.stack[this.stack.length-1];P.lang=b}function k(){const b=this.resume(),P=this.stack[this.stack.length-1];P.meta=b}function C(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function _(){const b=this.resume(),P=this.stack[this.stack.length-1];P.value=b.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function x(){const b=this.resume(),P=this.stack[this.stack.length-1];P.value=b.replace(/(\r?\n|\r)$/g,"")}function N(b){const P=this.resume(),q=this.stack[this.stack.length-1];q.label=P,q.identifier=ot(this.sliceSerialize(b)).toLowerCase()}function A(){const b=this.resume(),P=this.stack[this.stack.length-1];P.title=b}function j(){const b=this.resume(),P=this.stack[this.stack.length-1];P.url=b}function Q(b){const P=this.stack[this.stack.length-1];if(!P.depth){const q=this.sliceSerialize(b).length;P.depth=q}}function w(){this.data.setextHeadingSlurpLineEnding=!0}function W(b){const P=this.stack[this.stack.length-1];P.depth=this.sliceSerialize(b).codePointAt(0)===61?1:2}function Y(){this.data.setextHeadingSlurpLineEnding=void 0}function X(b){const q=this.stack[this.stack.length-1].children;let J=q[q.length-1];(!J||J.type!=="text")&&(J=oi(),J.position={start:Me(b.start),end:void 0},q.push(J)),this.stack.push(J)}function te(b){const P=this.stack.pop();P.value+=this.sliceSerialize(b),P.position.end=Me(b.end)}function B(b){const P=this.stack[this.stack.length-1];if(this.data.atHardBreak){const q=P.children[P.children.length-1];q.position.end=Me(b.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(P.type)&&(X.call(this,b),te.call(this,b))}function S(){this.data.atHardBreak=!0}function O(){const b=this.resume(),P=this.stack[this.stack.length-1];P.value=b}function D(){const b=this.resume(),P=this.stack[this.stack.length-1];P.value=b}function M(){const b=this.resume(),P=this.stack[this.stack.length-1];P.value=b}function ne(){const b=this.stack[this.stack.length-1];if(this.data.inReference){const P=this.data.referenceType||"shortcut";b.type+="Reference",b.referenceType=P,delete b.url,delete b.title}else delete b.identifier,delete b.label;this.data.referenceType=void 0}function Z(){const b=this.stack[this.stack.length-1];if(this.data.inReference){const P=this.data.referenceType||"shortcut";b.type+="Reference",b.referenceType=P,delete b.url,delete b.title}else delete b.identifier,delete b.label;this.data.referenceType=void 0}function oe(b){const P=this.sliceSerialize(b),q=this.stack[this.stack.length-2];q.label=zr(P),q.identifier=ot(P).toLowerCase()}function pe(){const b=this.stack[this.stack.length-1],P=this.resume(),q=this.stack[this.stack.length-1];if(this.data.inReference=!0,q.type==="link"){const J=b.children;q.children=J}else q.alt=P}function y(){const b=this.resume(),P=this.stack[this.stack.length-1];P.url=b}function fe(){const b=this.resume(),P=this.stack[this.stack.length-1];P.title=b}function K(){this.data.inReference=void 0}function g(){this.data.referenceType="collapsed"}function re(b){const P=this.resume(),q=this.stack[this.stack.length-1];q.label=P,q.identifier=ot(this.sliceSerialize(b)).toLowerCase(),this.data.referenceType="full"}function de(b){this.data.characterReferenceType=b.type}function se(b){const P=this.sliceSerialize(b),q=this.data.characterReferenceType;let J;q?(J=Vr(P,q==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):J=Tn(P);const ie=this.stack[this.stack.length-1];ie.value+=J}function Pe(b){const P=this.stack.pop();P.position.end=Me(b.end)}function Ne(b){te.call(this,b);const P=this.stack[this.stack.length-1];P.url=this.sliceSerialize(b)}function it(b){te.call(this,b);const P=this.stack[this.stack.length-1];P.url="mailto:"+this.sliceSerialize(b)}function at(){return{type:"blockquote",children:[]}}function Pt(){return{type:"code",lang:null,meta:null,value:""}}function ti(){return{type:"inlineCode",value:""}}function ni(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function ri(){return{type:"emphasis",children:[]}}function Ln(){return{type:"heading",depth:0,children:[]}}function Fn(){return{type:"break"}}function Vn(){return{type:"html",value:""}}function ii(){return{type:"image",title:null,url:"",alt:null}}function zn(){return{type:"link",title:null,url:"",children:[]}}function Bn(b){return{type:"list",ordered:b.type==="listOrdered",start:null,spread:b._spread,children:[]}}function ai(b){return{type:"listItem",spread:b._spread,checked:null,children:[]}}function si(){return{type:"paragraph",children:[]}}function li(){return{type:"strong",children:[]}}function oi(){return{type:"text",value:""}}function ui(){return{type:"thematicBreak"}}}function Me(e){return{line:e.line,column:e.column,offset:e.offset}}function Jr(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?Jr(e,r):fo(e,r)}}function fo(e,t){let n;for(n in t)if(Wr.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function rr(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+_t({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+_t({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+_t({start:t.start,end:t.end})+") is still open")}const po={components:{Fields:Qt,SchemaDialog:br,VueDraggable:Ei},props:{item:{type:Object,required:!0},assets:{type:Object,required:!0},content:{type:Array,required:!0},elements:{type:Object,required:!0},section:{type:String,default:"main"}},emits:["error","update:content"],data:()=>({chat:"",response:"",help:!1,refining:!1,panel:[],menu:{},index:null,checked:!1,vchange:!1,vschemas:!1,currentPage:1,lastPage:1}),setup(){const e=gi(),t=rt(),n=$t(),r=Et();return{auth:Ke(),clipboard:e,side:r,messages:t,schemas:n}},computed:{changed(){return this.content.some(e=>e._changed)},isChecked(){return this.content.filter(e=>e._checked).length}},methods:{add(e,t){let n={id:Ce(),group:this.section};e.id?(this.elements[e.id]=e,n=Object.assign(n,{type:"reference",refid:e.id})):n=Object.assign(n,{type:e.type,data:{}}),t!==null?(this.content.splice(t,0,n),this.panel.push(this.panel.includes(t)?t+1:t)):(this.content.push(n),this.panel.push(this.content.length-1)),this.$emit("update:content",this.content),this.vschemas=!1,this.store()},change(e){if(!this.content[e]){this.messages.add(this.$gettext("Content element not found"),"error");return}this.index=e,this.vchange=!0},changeTo(e,t){if(!this.content[t]){this.messages.add(this.$gettext("Content element not found"),"error");return}this.content[t]._error=!1,this.content[t].type=e.type,this.vchange=!1,this.validate().then(n=>{this.$emit("update:content",this.content),this.$emit("error",!n),this.store()})},copy(e){const t=[];if(e===void 0){for(let n=this.content.length-1;n>=0;n--)if(this.content[n]._checked){const r=JSON.parse(JSON.stringify(this.content[n]));r._checked=!1,r.id=null,t.push(r)}}else{const n=JSON.parse(JSON.stringify(this.content[e]));n._checked=!1,n.id=null,t.push(n)}this.clipboard.set("page-content",t.reverse())},createMarkdown(e){return e.type==="text"?e.data.text||"":e.type==="code"?`\`\`\`${e.data.lang||""}
${e.data.text||""}
\`\`\``:e.type==="heading"?`${"#".repeat(Number(e.data.level)||1)} ${e.data.title||""}`:""},cut(e){const t=[];if(e===void 0){for(let n=this.content.length-1;n>=0;n--)if(this.content[n]._checked){const r=JSON.parse(JSON.stringify(this.content[n]));this.content.splice(n,1),r._checked=!1,t.push(r)}}else{const n=JSON.parse(JSON.stringify(this.content[e]));this.content.splice(e,1),n._checked=!1,t.push(n)}this.clipboard.set("page-content",t.reverse()),this.$emit("update:content",this.content),this.store()},error(e,t){e._error=t,this.$emit("error",this.content.some(n=>n._error)),this.store()},fields(e){var t,n;return(t=this.schemas.content[e])!=null&&t.fields?(n=this.schemas.content[e])==null?void 0:n.fields:(console.warn(`No definition of fields for "${e}" schemas`),[])},insert(e){this.index=e,this.vschemas=!0},merge(){let e=0;const t=[];for(let r=this.content.length-1;r>=0;r--)if(this.content[r]._checked&&["text","code","heading"].includes(this.content[r].type)){t.push(this.content[r]),this.content.splice(r,1),e=r;const a=this.panel.indexOf(r);a!==-1&&this.panel.splice(a,1)}if(t.length===0)return;const n=t.reverse().reduce((r,a)=>(r.data.text+=this.createMarkdown(a)+`

`,r),{id:Ce(),group:this.section,type:"text",data:{text:""},_changed:!0});this.content.splice(e,0,n),this.$emit("update:content",this.content),this.store()},paste(e=null){e===null&&(e=this.content.length);const t=(this.clipboard.get("page-content")||[]).map(n=>(n.group=this.section,n));this.content.splice(e,0,...t),this.$emit("update:content",this.content),this.store()},purge(){for(let e=this.content.length-1;e>=0;e--)this.content[e]._checked&&this.content.splice(e,1);this.$emit("error",this.content.some(e=>e._error)),this.$emit("update:content",this.content),this.checked=!1,this.store()},refine(){const e=this.chat.trim();this.chat&&(this.refining=!0,this.$apollo.mutate({mutation:le`mutation($prompt: String!, $content: JSON!, $type: String, $context: String) {
            refine(prompt: $prompt, content: $content, type: $type, context: $context)
          }`,variables:{prompt:e,content:JSON.stringify(this.content),type:"content",context:null}}).then(t=>{var a;if(t.errors)throw t;const n=Object.fromEntries(this.content.map(i=>[i.id,i])),r=JSON.parse(((a=t.data)==null?void 0:a.refine)||"[]");r.length&&(r.forEach(i=>{i.id||(i.id=Ce()),i.group=this.section,Xi(i,n[i.id]||{})||(i._changed=!0)}),this.$emit("update:content",r)),this.refining=null,this.chat=""}).catch(t=>{this.messages.add(this.$gettext("Error refining content")+`:
`+t,"error"),this.$log("PageDetailContentList::refine(): Error refining content",t)}).finally(()=>{setTimeout(()=>{this.refining=!1},3e3)}))},remove(e){this.content.splice(e,1),this.$emit("error",this.content.some(t=>t._error)),this.$emit("update:content",this.content),this.store()},reset(){this.content.forEach(e=>{delete e._changed,delete e._error}),this.store()},search(e){e&&(e=e.toLocaleLowerCase().trim(),this.content.forEach(t=>{const n=t.type==="reference"?this.elements[t.refid]||{}:t;t._hide=!JSON.stringify(Object.values((n==null?void 0:n.data)||{})).toLocaleLowerCase().includes(e)}))},share(e){var n;if(!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=this.content[e];if(!t){this.messages.add(this.$gettext("Element not found"),"error");return}if(t.type==="reference"){this.messages.add(this.$gettext("Element is already shared"),"error");return}this.$apollo.mutate({mutation:le`
            mutation($input: ElementInput!, $files: [ID!]) {
              addElement(input: $input, files: $files) {
                id
                type
                lang
                name
                data
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  updated_at
                  editor
                }
              }
            }
          `,variables:{input:{type:t.type,lang:this.item.lang,name:this.title(t),data:JSON.stringify(t.data||{})},files:((n=t.files)==null?void 0:n.filter((r,a,i)=>i.indexOf(r)===a))||[]}}).then(r=>{if(r.errors)throw r.errors;const a=r.data.addElement;for(const i of a.files||[])i.previews=JSON.parse(i.previews||"{}"),this.assets[i.id]=i;a.data=JSON.parse(a.data),a.files=a.files.map(i=>i.id),this.elements[a.id]=a,this.content[e]={id:Ce(),group:this.section,type:"reference",refid:a.id},this.$emit("update:content",this.content),this.store()}).catch(r=>{this.messages.add(this.$gettext("Unable to make element shared")+`:
`+r,"error"),this.$log("PageDetailContentList::share(): Error making element shared",e,r)})},shown(e){const t=this.side.shown("state","valid"),n=this.side.shown("state","error"),r=this.side.shown("state","changed");return!e._hide&&this.side.shown("type",e.type)&&(n&&e._error||r&&e._changed||t&&!e._error&&!e._changed)},split(e){var r;if(!this.content[e]){this.messages.add(this.$gettext("Not available for this content element"),"error");return}const t=[],n=co(((r=this.content[e].data)==null?void 0:r.text)||"");for(const a of n.children)switch(a.type){case"code":{t.push({id:Ce(),type:"code",group:this.section,data:{lang:a.lang||null,text:a.value.trim()}});break}case"heading":{t.push({id:Ce(),type:"heading",group:this.section,data:{title:Yt(a).trim(),level:String(a.depth)}});break}case"table":{const i=a.children.map(s=>s.children.map(l=>l.children.map(u=>u.value||"").join("")).join(";")).join(`
`);t.push({id:Ce(),type:"table",group:this.section,data:{text:i.trim()}});break}default:t.push({id:Ce(),type:"text",group:this.section,data:{text:hs(a).trim()}})}this.content.splice(e,1,...t),this.$emit("error",this.content.some(a=>a._error)),this.$emit("update:content",this.content),this.store()},store(e=!0){if(!e)return;const t={},n={};return this.content.forEach(r=>{r.type&&(t[r.type]=(t[r.type]||0)+1),!r._changed&&!r._error&&(n.valid=(n.valid||0)+1),r._changed&&(n.changed=(n.changed||0)+1),r._error&&(n.error=(n.error||0)+1)}),this.side.store={type:t,state:n}},title(e){var t,n;return(((t=e.data)==null?void 0:t.title)||((n=e.data)==null?void 0:n.text)||Object.values(e.data||{}).map(r=>r&&typeof r!="object"&&typeof r!="boolean"?r:null).filter(r=>!!r).join(" - ")).substring(0,100)||this.$pgettext("st",e.type)||""},toggle(){this.content.forEach(e=>{this.shown(e)&&(e._checked=!e._checked)})},unshare(e){if(!this.content[e]){this.messages.add(this.$gettext("Content element not found"),"error");return}const t=this.content[e];if(t.type!=="reference"||!this.elements[t.refid]){this.messages.add(this.$gettext("Element is not shared"),"error");return}for(const n of this.elements[t.refid].files||[])this.assets[n.id]=n;this.content[e].type=this.elements[t.refid].type||null,this.content[e].data=this.elements[t.refid].data||{},delete this.content[e].refid,this.$emit("update:content",this.content),this.store()},update(e){e._changed=!0,e.group=this.section,this.$emit("error",this.content.some(t=>t._error)),this.$emit("update:content",this.content),this.store()},validate(){var t;const e=[];return(t=this.$refs.field)==null||t.forEach(n=>{e.push(n.validate())}),Promise.all(e).then(n=>n.every(r=>r))}},watch:{content:{handler(){this.validate().then(e=>{this.$emit("error",!e)})}}}},go={key:0,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},mo={key:1,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},yo={key:2,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},vo={key:0,class:"help"},ko={class:"header"},bo={key:0,class:"bulk"},xo={class:"element-title"},wo={class:"element-type"},Co={key:1,class:"btn-group"};function So(e,t,n,r,a,i){const s=ee("Fields"),l=ee("VueDraggable"),u=ee("SchemaDialog"),o=Ht("observe-visibility");return v(),z(ue,null,[He((v(),z("div",null,[m(gr,{modelValue:e.chat,"onUpdate:modelValue":t[3]||(t[3]=c=>e.chat=c),loading:e.refining,placeholder:e.$gettext("Describe the task you want to perform"),variant:"outlined",class:"prompt",rounded:"lg","hide-details":"",autofocus:"","auto-grow":"",clearable:"",outlined:"",rows:"1"},{prepend:p(()=>[m(Be,{onClick:t[0]||(t[0]=c=>e.help=!e.help)},{default:p(()=>[...t[21]||(t[21]=[V("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24"},[V("path",{d:"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"})],-1)])]),_:1})]),append:p(()=>[m(Be,{onClick:t[1]||(t[1]=c=>e.refining||i.refine()),onKeydown:t[2]||(t[2]=mr(c=>e.refining||i.refine(),["enter"])),title:e.refining?e.$gettext("Refining ..."):e.$gettext("Refine content based on prompt")},{default:p(()=>[e.refining===!1?(v(),z("svg",go,[...t[22]||(t[22]=[V("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M6,13H14L10.5,16.5L11.92,17.92L17.84,12L11.92,6.08L10.5,7.5L14,11H6V13Z"},null,-1)])])):$("",!0),e.refining===!0?(v(),z("svg",mo,[...t[23]||(t[23]=[V("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),V("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),V("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):$("",!0),e.refining===null?(v(),z("svg",yo,[...t[24]||(t[24]=[V("path",{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"},null,-1)])])):$("",!0)]),_:1},8,["title"])]),_:1},8,["modelValue","loading","placeholder"]),e.help?(v(),z("div",vo,[V("ul",null,[V("li",null,E(e.$gettext("AI can add or improve content based on your input")),1),V("li",null,E(e.$gettext("It can take a long time depending on the task and content size")),1)])])):$("",!0),V("div",ko,[r.auth.can("page:save")?(v(),z("div",bo,[m(Ft,{modelValue:e.checked,"onUpdate:modelValue":t[4]||(t[4]=c=>e.checked=c),onClick:t[5]||(t[5]=Ue(c=>i.toggle(),["stop"]))},null,8,["modelValue"]),m(ct,{location:"bottom left"},{activator:p(({props:c})=>[m(T,nt(c,{disabled:!i.isChecked&&!r.clipboard.get("page-content"),"append-icon":"mdi-menu-down",variant:"text"}),{default:p(()=>[F(E(e.$gettext("Actions")),1)]),_:2},1040,["disabled"])]),default:p(()=>[m(ut,null,{default:p(()=>[i.isChecked?(v(),I(R,{key:0},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[6]||(t[6]=c=>i.purge())},{default:p(()=>[F(E(e.$gettext("Delete")),1)]),_:1})]),_:1})):$("",!0),i.isChecked?(v(),I(R,{key:1},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:t[7]||(t[7]=c=>i.copy())},{default:p(()=>[F(E(e.$gettext("Copy")),1)]),_:1})]),_:1})):$("",!0),i.isChecked?(v(),I(R,{key:2},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:t[8]||(t[8]=c=>i.cut())},{default:p(()=>[F(E(e.$gettext("Cut")),1)]),_:1})]),_:1})):$("",!0),r.clipboard.get("page-content")?(v(),I(R,{key:3},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[9]||(t[9]=c=>i.paste())},{default:p(()=>[F(E(e.$gettext("Paste")),1)]),_:1})]),_:1})):$("",!0),i.isChecked>1?(v(),I(R,{key:4},{default:p(()=>[m(T,{"prepend-icon":"mdi-set-merge",variant:"text",onClick:t[10]||(t[10]=c=>i.merge())},{default:p(()=>[F(E(e.$gettext("Merge")),1)]),_:1})]),_:1})):$("",!0)]),_:1})]),_:1})])):$("",!0),m(je,{"onClick:clear":t[11]||(t[11]=c=>i.search("")),onInput:t[12]||(t[12]=c=>i.search(c.target.value)),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined",class:"search",clearable:"","hide-details":""},null,8,["label"])]),m(bn,{class:"list",modelValue:e.panel,"onUpdate:modelValue":t[15]||(t[15]=c=>e.panel=c),elevation:"0",multiple:""},{default:p(()=>[m(l,{"onUpdate:modelValue":t[14]||(t[14]=c=>e.$emit("update:content",c)),disabled:e.panel.length||!r.auth.can("page:save"),modelValue:n.content,forceFallback:!0,fallbackTolerance:"10",draggable:".content",group:"content"},{default:p(()=>[(v(!0),z(ue,null,Ie(n.content,(c,h)=>He((v(),I(xn,{key:h,class:ce(["content",{changed:c._changed,error:c._error}])},{default:p(()=>[m(wn,{"expand-icon":"mdi-pencil"},{default:p(()=>{var f;return[r.auth.can("page:save")?(v(),I(Ft,{key:0,"model-value":c._checked,onClick:Ue(d=>c._checked=!c._checked,["stop"])},null,8,["model-value","onClick"])):$("",!0),r.auth.can("page:save")?(v(),I(ct,{key:1},{activator:p(({props:d})=>[m(T,nt({ref_for:!0},d,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:p(()=>[m(ut,null,{default:p(()=>[c._error?$("",!0):(v(),I(R,{key:0},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:d=>i.copy(h)},{default:p(()=>[F(E(e.$gettext("Copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)),c._error?$("",!0):(v(),I(R,{key:1},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:d=>i.cut(h)},{default:p(()=>[F(E(e.$gettext("Cut")),1)]),_:2},1032,["onClick"])]),_:2},1024)),m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-delete",variant:"text",onClick:d=>i.remove(h)},{default:p(()=>[F(E(e.$gettext("Delete")),1)]),_:2},1032,["onClick"])]),_:2},1024),m(et),r.clipboard.get("page-content")?(v(),I(R,{key:2},{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>i.paste(h)},{default:p(()=>[F(E(e.$gettext("Paste before")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),r.clipboard.get("page-content")?(v(),I(R,{key:3},{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>i.paste(h+1)},{default:p(()=>[F(E(e.$gettext("Paste after")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:d=>i.insert(h)},{default:p(()=>[F(E(e.$gettext("Insert before")),1)]),_:2},1032,["onClick"])]),_:2},1024),m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:d=>i.insert(h+1)},{default:p(()=>[F(E(e.$gettext("Insert after")),1)]),_:2},1032,["onClick"])]),_:2},1024),m(et),!c._error&&c.type!=="reference"&&r.auth.can("element:add")?(v(),I(R,{key:4},{default:p(()=>[m(T,{"prepend-icon":"mdi-link",variant:"text",onClick:d=>i.share(h)},{default:p(()=>[F(E(e.$gettext("Make shared")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),c.type==="reference"?(v(),I(R,{key:5},{default:p(()=>[m(T,{"prepend-icon":"mdi-link-off",variant:"text",onClick:d=>i.unshare(h)},{default:p(()=>[F(E(e.$gettext("Merge copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),c.type!=="reference"?(v(),I(R,{key:6},{default:p(()=>[m(T,{"prepend-icon":"mdi-swap-horizontal",variant:"text",onClick:d=>i.change(h)},{default:p(()=>[F(E(e.$gettext("Change to")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),c.type==="text"?(v(),I(R,{key:7},{default:p(()=>[m(T,{"prepend-icon":"mdi-set-split",variant:"text",onClick:d=>i.split(h)},{default:p(()=>[F(E(e.$gettext("Split")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),c._checked&&i.isChecked>1?(v(),I(R,{key:8},{default:p(()=>[m(T,{"prepend-icon":"mdi-set-merge",variant:"text",onClick:t[13]||(t[13]=d=>i.merge())},{default:p(()=>[F(E(e.$gettext("Merge")),1)]),_:1})]),_:1})):$("",!0)]),_:2},1024)]),_:2},1024)):$("",!0),c.type==="reference"?(v(),I(Be,{key:2,title:e.$gettext("Shared element"),class:"icon-shared",icon:"mdi-link"},null,8,["title"])):$("",!0),V("div",xo,E(c.type==="reference"?(f=n.elements[c.refid])==null?void 0:f.name:i.title(c)),1),V("div",wo,E(e.$pgettext("st",c.type)),1)]}),_:2},1024),m(Cn,{eager:""},{default:p(()=>{var f,d;return[c.type==="reference"?(v(),I(s,{key:0,data:((f=n.elements[c.refid])==null?void 0:f.data)||{},fields:i.fields((d=n.elements[c.refid])==null?void 0:d.type),assets:n.assets,readonly:!0,type:c.type},null,8,["data","fields","assets","type"])):(v(),I(s,{key:1,ref_for:!0,ref:"field",data:c.data,"onUpdate:data":k=>c.data=k,files:c.files,"onUpdate:files":k=>c.files=k,readonly:!r.auth.can("page:save"),fields:i.fields(c.type),assets:n.assets,type:c.type,onError:k=>i.error(c,k),onChange:k=>i.update(c)},null,8,["data","onUpdate:data","files","onUpdate:files","readonly","fields","assets","type","onError","onChange"]))]}),_:2},1024)]),_:2},1032,["class"])),[[Rt,i.shown(c)]])),128))]),_:1},8,["disabled","modelValue"])]),_:1},8,["modelValue"]),r.auth.can("page:save")?(v(),z("div",Co,[m(T,{onClick:t[16]||(t[16]=c=>{e.index=null,e.vschemas=!0}),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):$("",!0)])),[[o,i.store]]),(v(),I(St,{to:"body"},[m(u,{modelValue:e.vschemas,"onUpdate:modelValue":t[17]||(t[17]=c=>e.vschemas=c),onAdd:t[18]||(t[18]=c=>i.add(c,e.index))},null,8,["modelValue"])])),(v(),I(St,{to:"body"},[m(u,{modelValue:e.vchange,"onUpdate:modelValue":t[19]||(t[19]=c=>e.vchange=c),elements:!1,onAdd:t[20]||(t[20]=c=>i.changeTo(c,e.index))},null,8,["modelValue"])]))],64)}const Eo=we(po,[["render",So],["__scopeId","data-v-dfd34ef6"]]),$o={components:{PageDetailContentList:Eo},props:{item:{type:Object,required:!0},assets:{type:Object,required:!0},elements:{type:Object,required:!0}},emits:["change","error"],data:()=>({changed:{},errors:{},tab:"default"}),setup(){return{config:pr()}},computed:{names(){const e=this.item.type||"page",t=this.item.theme||"cms";return this.config.get(`themes.${t}.types.${e}.sections`,["main"])},sections(){if(this.names.length<=1)return{};const e={};for(const t of this.names)e[t]=[];for(const t of this.item.content||[]){const n=t.group||"main";e[n]||(e[n]=[]),e[n].push(t)}return e}},methods:{error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},reset(){var e;this.changed={},this.errors={},Array.isArray(this.$refs.content)?this.$refs.content.forEach(t=>t.reset()):(e=this.$refs.content)==null||e.reset()},update(e,t){const n=this.sections;n[e]=t,this.item.content=Object.values(n).reduce((r,a)=>r.concat(a),[]),this.changed[e]=!0},validate(){const t=(Array.isArray(this.$refs.content)?this.$refs.content:[this.$refs.content]).map(n=>n==null?void 0:n.validate());return Promise.all(t).then(n=>n.every(r=>r))}}},Io={key:0},Po={key:1};function Oo(e,t,n,r,a,i){const s=ee("PageDetailContentList");return v(),I(dt,null,{default:p(()=>[m(ht,{class:"box scroll"},{default:p(()=>[Object.keys(i.sections).length>1?(v(),z("div",Io,[m(Jt,{class:"subtabs",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=l=>e.tab=l),"align-tabs":"center"},{default:p(()=>[(v(!0),z(ue,null,Ie(i.sections,(l,u)=>(v(),I(Re,{key:u,class:ce({changed:e.changed[u],error:e.errors[u]}),value:u},{default:p(()=>[F(E(e.$pgettext("cs",u)),1)]),_:2},1032,["class","value"]))),128))]),_:1},8,["modelValue"]),m($n,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=l=>e.tab=l),touch:!1},{default:p(()=>[(v(!0),z(ue,null,Ie(i.sections,(l,u)=>(v(),I(Ge,{key:u,value:u},{default:p(()=>[m(s,{ref_for:!0,ref:"content",section:u,item:n.item,assets:n.assets,content:l,elements:n.elements,onError:o=>i.error(u,o),"onUpdate:content":o=>{i.update(u,o),this.$emit("change","content")}},null,8,["section","item","assets","content","elements","onError","onUpdate:content"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])):(v(),z("div",Po,[t[4]||(t[4]=V("div",{class:"subtabs"},null,-1)),m(s,{ref:"content",item:n.item,assets:n.assets,content:n.item.content||[],elements:n.elements,onError:t[2]||(t[2]=l=>e.$emit("error",l)),"onUpdate:content":t[3]||(t[3]=l=>{n.item.content=l,this.$emit("change","content")})},null,8,["item","assets","content","elements"])]))]),_:1})]),_:1})}const Do=we($o,[["render",Oo],["__scopeId","data-v-3fb07532"]]),To={components:{Fields:Qt},props:{modelValue:{type:Boolean,required:!0},readonly:{type:Boolean,default:!1},element:{type:Object,required:!0},assets:{type:Object,default:()=>({})},type:{type:String,default:"content"}},emits:["update:modelValue","update:element"],setup(){return{schemas:$t()}},data(){return{error:!1}},methods:{fields(e){var t,n;return!this.schemas[this.type]||!((t=this.schemas[this.type][e])!=null&&t.fields)?(console.warn(`No definition of fields for "${e}" (${this.type}) schemas`),[]):(n=this.schemas.content[e])==null?void 0:n.fields}}};function Ao(e,t,n,r,a,i){const s=ee("Fields");return v(),I(qt,{modelValue:n.modelValue,onAfterLeave:t[6]||(t[6]=l=>e.$emit("update:modelValue",!1)),"max-width":"1200",scrollable:""},{default:p(()=>[m(Kt,null,{append:p(()=>[!n.readonly&&!a.error&&n.element._changed?(v(),I(T,{key:0,onClick:t[0]||(t[0]=l=>e.$emit("update:element",n.element)),variant:"outlined"},{default:p(()=>[F(E(e.$gettext("Save")),1)]),_:1})):$("",!0),m(T,{onClick:t[1]||(t[1]=l=>e.$emit("update:modelValue",!1)),title:e.$gettext("Close"),icon:"mdi-close",variant:"text",elevation:"0"},null,8,["title"])]),title:p(()=>[F(E(e.$gettext("Content Element")),1)]),default:p(()=>[m(et),m(Wt,null,{default:p(()=>[m(s,{data:n.element.data,"onUpdate:data":t[2]||(t[2]=l=>n.element.data=l),files:n.element.files,"onUpdate:files":t[3]||(t[3]=l=>n.element.files=l),fields:i.fields(n.element.type),readonly:n.readonly,type:n.element.type,assets:n.assets,onError:t[4]||(t[4]=l=>a.error=n.element._error=l),onChange:t[5]||(t[5]=l=>n.element._changed=!0)},null,8,["data","files","fields","readonly","type","assets"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const _o=we(To,[["render",Ao]]),Lo={components:{FieldsDialog:_o,SchemaDialog:br},props:{save:{type:Object,required:!0},item:{type:Object,required:!0},elements:{type:Object,required:!0},assets:{type:Object,default:()=>({})}},emits:["change"],setup(){const e=rt(),t=Ke();return{app:En(),auth:t,messages:e}},data(){return{pos:null,index:null,element:null,section:"main",loading:!0,expanded:!1,vcontent:!1,vschemas:!1,vpreview:!1,visible:!1,vedit:!1}},mounted(){var e;window.addEventListener("message",this.message),(e=this.$refs.iframe)==null||e.addEventListener("load",()=>{var t,n;(n=(t=this.$refs.iframe)==null?void 0:t.contentWindow)==null||n.postMessage("init","*")}),this.messages.add(this.$gettext("Double-click to edit"),"info")},beforeUnmount(){window.removeEventListener("message",this.message)},computed:{url(){return this.visible?this.app.urlpage.replace(/_domain_/,this.item.domain||"").replace(/_path_/,this.item.path||"").replace(/\/+$/,""):null}},methods:{add(e){const t=this.section||"main";this.vschemas=!1,e.id?(this.elements[e.id]=e,this.element={id:Ce(),group:t,type:"reference",refid:e.id},this.update()):(this.element={id:Ce(),group:t,type:e.type,data:{}},this.vedit=!0)},edit(){this.element=this.item.content[this.index]||null,this.vedit=!!this.element,this.index=null},fullscreen(){const e=this.$refs.preview;this.expanded?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e!=null&&e.requestFullscreen?e.requestFullscreen():e!=null&&e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.expanded=!this.expanded},load(e){this.visible=!!e},message(e){switch(e.data){case 0:this.index=null;break;case-1:this.vpreview=!0,setTimeout(()=>{this.vpreview=!1},3e3);break;case-2:this.vcontent=!0,setTimeout(()=>{this.vcontent=!1},3e3);break;default:this.index=typeof e.data=="object"&&e.data.id?this.item.content.findIndex(t=>t.id===e.data.id):null,this.section=e.data.section||"main"}},remove(){this.index!==null&&(this.item.content.splice(this.index,1),this.$emit("change","content"),this.index=null,this.save.fcn(!0).then(()=>{this.$refs.iframe.contentWindow.postMessage("reload",this.url)}))},update(){this.pos!==null&&this.item.content.splice(this.index+this.pos,0,this.element),this.vedit=!1,this.index=null,this.pos=null,this.$emit("change","content"),this.save.fcn(!0).then(()=>{this.$refs.iframe.contentWindow.postMessage("reload",this.url)})}},watch:{"save.count":function(){this.save.count>0&&this.$refs.iframe.contentWindow.postMessage("reload",this.url)}}},Fo={class:"page-preview",ref:"preview"},Vo={key:0,class:"controls"},zo={key:1,class:"controls"},Bo={key:2,class:"preview-hint"},No={key:3,class:"preview-hint"},Mo=["src"];function jo(e,t,n,r,a,i){const s=ee("FieldsDialog"),l=ee("SchemaDialog"),u=Ht("observe-visibility");return He((v(),z("div",Fo,[a.loading?(v(),z("div",Vo,[...t[11]||(t[11]=[V("svg",{class:"spinner",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[V("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),V("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),V("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1)])])):$("",!0),a.index!==null?(v(),z("div",zo,[a.index!==-1?(v(),I(T,{key:0,onClick:t[0]||(t[0]=o=>i.edit()),title:e.$gettext("Edit element"),icon:"mdi-pencil",variant:"text",elevation:"0"},null,8,["title"])):$("",!0),a.index!==-1?(v(),I(T,{key:1,onClick:t[1]||(t[1]=o=>{a.vschemas=!0,a.pos=0}),title:e.$gettext("Add element before"),icon:"mdi-table-row-plus-before",variant:"text"},null,8,["title"])):$("",!0),m(T,{onClick:t[2]||(t[2]=o=>{a.vschemas=!0,a.pos=1}),title:e.$gettext("Add element after"),icon:"mdi-table-row-plus-after",variant:"text"},null,8,["title"]),a.index!==-1?(v(),I(T,{key:2,onClick:t[3]||(t[3]=o=>i.remove()),title:e.$gettext("Remove element"),icon:"mdi-trash-can-outline",variant:"text"},null,8,["title"])):$("",!0)])):$("",!0),a.vpreview?(v(),z("div",Bo,E(e.$gettext("Preview mode")),1)):$("",!0),a.vcontent?(v(),z("div",No,E(e.$gettext("Not CMS content")),1)):$("",!0),V("iframe",{ref:"iframe",src:i.url,onLoad:t[4]||(t[4]=o=>a.loading=!1)},null,40,Mo),a.expanded?$("",!0):(v(),I(T,{key:4,onClick:t[5]||(t[5]=o=>i.fullscreen()),title:e.$gettext("Fullscreen mode"),icon:"mdi-fullscreen",class:"fullscreen",variant:"text"},null,8,["title"])),a.expanded?(v(),I(T,{key:5,onClick:t[6]||(t[6]=o=>i.fullscreen()),title:e.$gettext("Exit fullscreen mode"),icon:"mdi-fullscreen-exit",class:"fullscreen",variant:"text"},null,8,["title"])):$("",!0),a.element?(v(),I(s,{key:6,modelValue:a.vedit,"onUpdate:modelValue":t[7]||(t[7]=o=>a.vedit=o),assets:n.assets,element:a.element.type==="reference"?n.elements[a.element.refid]:a.element,readonly:!r.auth.can("page:save")||!!a.element.refid,attach:e.$refs.preview,"onUpdate:element":t[8]||(t[8]=o=>i.update())},null,8,["modelValue","assets","element","readonly","attach"])):$("",!0),m(l,{modelValue:a.vschemas,"onUpdate:modelValue":t[9]||(t[9]=o=>a.vschemas=o),attach:e.$refs.preview,onAdd:t[10]||(t[10]=o=>i.add(o))},null,8,["modelValue","attach"])])),[[u,i.load]])}const Uo=we(Lo,[["render",jo]]),Ro={components:{AsideMeta:Ci,AsideCount:Di,HistoryDialog:wi,PageDetailItem:Ji,PageDetailContent:Do,PageDetailEditor:Uo},inject:["closeView","compose","translate","txlocales"],props:{item:{type:Object,required:!0}},provide(){return{compose:this.composeText,translate:this.translateText}},setup(){const e=Sn(),t=rt(),n=$t(),r=kn();return{auth:Ke(),drawer:r,languages:e,messages:t,schemas:n}},data:()=>({tab:"editor",aside:"",asidePage:"meta",changed:{},errors:{},assets:{},elements:{},latest:null,pubmenu:null,publishAt:null,translating:!1,vhistory:!1,savecnt:0}),computed:{currentAssets(){const e=this.fileIds();return Object.fromEntries(Object.entries(this.assets||{}).filter(([t,n])=>e.includes(t)))},hasChanged(){return Object.values(this.changed).some(e=>e)},hasError(){return Object.values(this.errors).some(e=>e)},langs(){const e=[],t=["ar","bg","cs","da","de","el","en","en-GB","en_US","es","et","fi","fr","he","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt","pt-BR","ro","ru","sk","sl","sv","th","tr","uk","vi","zh","zh-HANS","zh-HANT"];return Object.entries(this.languages.available).forEach(n=>{t.includes(n[0])&&n[0]!==this.item.lang&&e.push({code:n[0],name:n[1]})}),e}},created(){var e;this.$options._compose=this.compose,!(!((e=this.item)!=null&&e.id)||!this.auth.can("page:view"))&&this.$apollo.query({query:le`query($id: ID!) {
          page(id: $id) {
            id
            latest {
              ${this.fields()}
            }
          }
        }`,variables:{id:this.item.id}}).then(t=>{var r,a,i,s,l,u;if(t.errors||!t.data.page)throw t;this.reset(),this.latest=(a=(r=t==null?void 0:t.data)==null?void 0:r.page)==null?void 0:a.latest,Object.assign(this.item,JSON.parse(((i=this.latest)==null?void 0:i.data)||"{}"));const n=JSON.parse(((s=this.latest)==null?void 0:s.aux)||"{}");this.item.content=n.content??[],this.item.config=n.config??{},this.item.meta=n.meta??{},this.assets=this.files(((l=this.latest)==null?void 0:l.files)||[]),this.elements=this.elems(((u=this.latest)==null?void 0:u.elements)||[]),this.item.content=this.obsolete(this.item.content)}).catch(t=>{this.messages.add(this.$gettext("Error fetching page")+`:
`+t,"error"),this.$log("PageDetail::watch(item): Error fetching page",t)})},methods:{clean(e,t){var n,r,a;if(e&&t){e=JSON.parse(JSON.stringify(e));for(const i in e){const s=e[i];for(const l in s)l.startsWith("_")&&delete s[l];for(const l in s.data||{})(a=(r=(n=this.schemas[t])==null?void 0:n[s.type])==null?void 0:r.fields)!=null&&a[l]||delete s.data[l]}}return e},composeText(e,t=[],n=[]){return this.$options._compose?(Array.isArray(t)||(t=[t]),t.push("page content as JSON: "+JSON.stringify(this.item.content)),t.push("required output language: "+(this.item.lang||"en")),this.$options._compose(e,t,n)):Promise.reject(new Error("Compose method is not available in PageDetail component"))},elems(e){const t={};for(const n of e)t[n.id]={...n,data:JSON.parse(n.data||"{}"),files:Object.values(this.files(n.files||[]))};return t},fields(){return`id
              aux
              data
              published
              publish_at
              created_at
              editor
              files {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                updated_at
                editor
              }
              elements {
                id
                type
                name
                data
                editor
                updated_at
                files {
                  id
                  lang
                  mime
                  name
                  path
                  previews
                  description
                  transcription
                  updated_at
                  editor
                }
              }`},fileIds(){const e=[];for(const t of this.item.content||[])e.push(...t.files||[]);for(const t in this.item.meta||{})e.push(...this.item.meta[t].files||[]);for(const t in this.item.config||{})e.push(...this.item.config[t].files||[]);return e.filter((t,n,r)=>r.indexOf(t)===n)},files(e){const t={};for(const n of e)t[n.id]={...n,previews:JSON.parse(n.previews||"{}"),description:JSON.parse(n.description||"{}"),transcription:JSON.parse(n.transcription||"{}")};return t},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"Page:"+this.item.id}),e.gc()},obsolete(e){for(const t of e)t.files&&Array.isArray(t.files)&&(t.files=t.files.filter(n=>typeof this.assets[n]<"u"));return e},publish(e=null){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var n,r;t&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!, $at: DateTime) {
              pubPage(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(r=(n=e==null?void 0:e.toISOString())==null?void 0:n.substring(0,19))==null?void 0:r.replace("T"," ")}}).then(a=>{if(a.errors)throw a.errors;e?(this.item.publish_at=e,this.messages.add(this.$gettext("Page scheduled for publishing at %{date}",{date:e.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("Page published successfully"),"success")),this.closeView()}).catch(a=>{this.messages.add(this.$gettext("Error publishing page")+`:
`+a,"error"),this.$log("PageDetail::publish(): Error publishing page",e,a)})})},reset(){var e,t;(e=this.$refs.page)==null||e.reset(),(t=this.$refs.content)==null||t.reset(),this.changed={},this.errors={}},save(e=!1){return this.auth.can("page:save")?this.hasChanged?this.validate().then(t=>{if(!t)return this.messages.add(this.$gettext("There are invalid fields, please resolve the errors first"),"error"),t;const n={};for(const a in this.item.meta||{})n[a]={type:this.item.meta[a].type||"",data:this.item.meta[a].data||{},files:this.item.meta[a].files||[]};const r={};for(const a in this.item.config||{})r[a]={type:this.item.config[a].type||"",data:this.item.config[a].data||{},files:this.item.config[a].files||[]};return this.$apollo.mutate({mutation:le`mutation ($id: ID!, $input: PageInput!, $elements: [ID!], $files: [ID!]) {
              savePage(id: $id, input: $input, elements: $elements, files: $files) {
                id
              }
            }`,variables:{id:this.item.id,input:{cache:this.item.cache||0,domain:this.item.domain||"",lang:this.item.lang||"",name:this.item.name||"",path:this.item.path||"",status:this.item.status||0,title:this.item.title||"",tag:this.item.tag||"",to:this.item.to||"",type:this.item.type||"",theme:this.item.theme||"",meta:JSON.stringify(this.clean(n,"meta")),config:JSON.stringify(this.clean(r,"config")),content:JSON.stringify(this.clean(this.item.content,"content"))},elements:Object.keys(this.elements),files:this.fileIds()}}).then(a=>{var i;if(a.errors)throw a.errors;return this.item.published=!1,(i=this.$refs.history)==null||i.reset(),this.reset(),e||this.messages.add(this.$gettext("Page saved successfully"),"success"),this.invalidate(),this.savecnt++,!0}).catch(a=>{this.messages.add(this.$gettext("Error saving page")+`:
`+a,"error"),this.$log("PageDetail::save(): Error saving page",a)})}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},translatePage(e){var r,a,i;if(!this.schemas.content){this.messages.add(this.$gettext('No page schema for "content" found'),"error");return}const t=["text","markdown","plaintext","string"],n=[{item:this.item,key:"title",text:this.item.title},{item:this.item,key:"name",text:this.item.name},{item:this.item,key:"path",text:this.item.path}];for(const s of Object.values(this.item.meta))for(const l in s.data){const u=(i=(a=(r=this.schemas.meta[s.type])==null?void 0:r.fields)==null?void 0:a[l])==null?void 0:i.type;s.data[l]&&t.includes(u)&&n.push({item:s.data,key:l,text:s.data[l]})}this.item.content.forEach(s=>{var l,u,o,c,h;for(const f in s.data){const d=(l=this.schemas.content[s.type])==null?void 0:l.fields,k=(u=d==null?void 0:d[f])==null?void 0:u.type;if(k==="items")for(const C in s.data[f]){const _=s.data[f][C];for(const x in _)t.includes((h=(c=(o=d[f])==null?void 0:o.item)==null?void 0:c[x])==null?void 0:h.type)&&n.push({item:_,key:x,text:_[x]})}else s.type!=="code"&&s.data[f]&&t.includes(k)&&n.push({item:s.data,key:f,text:s.data[f]})}}),this.translating=!0,this.translate(n.map(s=>s.text),e,this.item.lang).then(s=>{s.forEach((l,u)=>{n[u]&&(n[u].item[n[u].key]=l)}),this.changed.content=!0,this.changed.page=!0,this.item.lang=e}).finally(()=>{this.translating=!1})},translateText(e,t,n=null){return this.translate(e,t,n||this.item.lang)},update(e,t){e==="page"?Object.assign(this.item,t):this[e]=t,this.changed[e]=!0},use(e){Object.assign(this.item,e.data),this.assets=e.files,this.elements=this.elems(e.elements||[]),this.item.content=this.obsolete(this.item.content),this.changed.content=!0,this.changed.page=!0,this.vhistory=!1},validate(){var e,t;return Promise.all([(e=this.$refs.page)==null?void 0:e.validate(),(t=this.$refs.content)==null?void 0:t.validate()].filter(n=>n)).then(n=>n.every(r=>r))},versions(e){return this.auth.can("page:view")?e?this.$apollo.query({query:le`query($id: ID!) {
            page(id: $id) {
              id
              versions {
                ${this.fields()}
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.page)throw t;return(t.data.page.versions||[]).map(n=>{const r={...n,data:Object.assign(JSON.parse(n.data||"{}"),JSON.parse(n.aux||"{}"))};return r.files=this.files(n.files||[]),delete r.aux,r}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching page versions")+`:
`+t,"error"),this.$log("PageDetail::versions(): Error fetching page versions",e,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}},watch:{asidePage(e){this.aside=e}}},Ho={class:"app-title"},qo={class:"menu-content"};function Ko(e,t,n,r,a,i){var f;const s=ee("PageDetailEditor"),l=ee("PageDetailContent"),u=ee("PageDetailItem"),o=ee("AsideMeta"),c=ee("AsideCount"),h=ee("HistoryDialog");return v(),z(ue,null,[m(yr,{elevation:0,density:"compact"},{prepend:p(()=>[m(T,{onClick:t[0]||(t[0]=d=>i.closeView()),title:e.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:p(()=>[m(ct,null,{activator:p(({props:d})=>[m(T,nt(d,{title:e.$gettext("Translate page"),loading:e.translating,icon:"mdi-translate"}),null,16,["title","loading"])]),default:p(()=>[m(ut,null,{default:p(()=>[(v(!0),z(ue,null,Ie(i.txlocales(n.item.lang),d=>(v(),I(R,{key:d.code},{default:p(()=>[m(T,{onClick:k=>i.translatePage(d.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:p(()=>[F(E(d.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}),m(T,{onClick:t[1]||(t[1]=d=>e.vhistory=!0),class:ce([{hidden:n.item.published&&!i.hasChanged&&!e.latest},"no-rtl"]),title:e.$gettext("View history"),icon:"mdi-history"},null,8,["class","title"]),m(T,{onClick:t[2]||(t[2]=d=>i.save()),title:e.$gettext("Save"),disabled:!i.hasChanged||i.hasError||!r.auth.can("page:save"),variant:!i.hasChanged||i.hasError||!r.auth.can("page:save")?"plain":"flat",class:ce([{active:i.hasChanged&&!i.hasError&&r.auth.can("page:save"),error:i.hasError},"menu-save"]),icon:"mdi-database-arrow-down"},null,8,["title","disabled","variant","class"]),m(ct,{modelValue:e.pubmenu,"onUpdate:modelValue":t[5]||(t[5]=d=>e.pubmenu=d),"close-on-content-click":!1},{activator:p(({props:d})=>[m(T,nt(d,{icon:"",title:e.$gettext("Schedule publishing"),disabled:n.item.published&&!i.hasChanged||i.hasError||!r.auth.can("page:publish"),variant:n.item.published&&!i.hasChanged||i.hasError||!r.auth.can("page:publish")?"plain":"flat",class:[{active:(!n.item.published||i.hasChanged)&&!i.hasError&&r.auth.can("page:publish"),error:i.hasError},"menu-publishat"]}),{default:p(()=>[m(Be,null,{default:p(()=>[...t[23]||(t[23]=[V("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[V("path",{d:"M2,1V3H16V1H2 M2,10H6V19H12V10H16L9,3L2,10Z"}),V("path",{d:"M16.7 11.4C16.7 11.4 16.61 11.4 16.7 11.4C13.19 11.49 10.4 14.28 10.4 17.7C10.4 21.21 13.19 24 16.7 24S23 21.21 23 17.7 20.21 11.4 16.7 11.4M16.7 22.2C14.18 22.2 12.2 20.22 12.2 17.7S14.18 13.2 16.7 13.2 21.2 15.18 21.2 17.7 19.22 22.2 16.7 22.2M15.6 13.1V17.6L18.84 19.58L19.56 18.5L16.95 16.97V13.1H15.6Z"})],-1)])]),_:1})]),_:2},1040,["title","disabled","variant","class"])]),default:p(()=>[V("div",qo,[m(mi,{modelValue:e.publishAt,"onUpdate:modelValue":t[3]||(t[3]=d=>e.publishAt=d),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),m(T,{onClick:t[4]||(t[4]=d=>{i.publish(e.publishAt),e.pubmenu=!1}),disabled:!e.publishAt||i.hasError,color:e.publishAt?"primary":"",variant:"text",elevation:"0"},{default:p(()=>[F(E(e.$gettext("Publish")),1)]),_:1},8,["disabled","color"])])]),_:1},8,["modelValue"]),m(T,{icon:"",onClick:t[6]||(t[6]=d=>i.publish()),title:e.$gettext("Publish"),disabled:n.item.published&&!i.hasChanged||i.hasError||!r.auth.can("page:publish"),variant:n.item.published&&!i.hasChanged||i.hasError||!r.auth.can("page:publish")?"plain":"flat",class:ce([{active:(!n.item.published||i.hasChanged)&&!i.hasError&&r.auth.can("page:publish"),error:i.hasError},"menu-publish"])},{default:p(()=>[m(Be,null,{default:p(()=>[...t[24]||(t[24]=[V("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},[V("path",{d:"M5,2V4H19V2H5 M5,12H9V21H15V12H19L12,5L5,12Z"})],-1)])]),_:1})]),_:1},8,["title","disabled","variant","class"]),m(T,{onClick:t[7]||(t[7]=Ue(d=>r.drawer.toggle("aside"),["stop"])),title:e.$gettext("Toggle side menu"),icon:r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:p(()=>[m(kr,null,{default:p(()=>[V("div",Ho,E(e.$gettext("Page"))+": "+E(n.item.name),1)]),_:1})]),_:1}),m(vr,{class:"page-details"},{default:p(()=>[m(yi,{onSubmit:t[19]||(t[19]=Ue(()=>{},["prevent"]))},{default:p(()=>[m(Jt,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[11]||(t[11]=d=>e.tab=d)},{default:p(()=>[m(Re,{value:"editor",onClick:t[8]||(t[8]=d=>e.aside="")},{default:p(()=>[F(E(e.$gettext("Editor")),1)]),_:1}),m(Re,{value:"content",class:ce({changed:e.changed.content,error:e.errors.content}),onClick:t[9]||(t[9]=d=>e.aside="count")},{default:p(()=>[F(E(e.$gettext("Content")),1)]),_:1},8,["class"]),m(Re,{value:"page",class:ce({changed:e.changed.page,error:e.errors.page}),onClick:t[10]||(t[10]=d=>e.aside=e.asidePage)},{default:p(()=>[F(E(e.$gettext("Page")),1)]),_:1},8,["class"])]),_:1},8,["modelValue"]),m($n,{modelValue:e.tab,"onUpdate:modelValue":t[18]||(t[18]=d=>e.tab=d),touch:!1},{default:p(()=>[m(Ge,{value:"editor"},{default:p(()=>[m(s,{save:{fcn:i.save,count:e.savecnt},item:n.item,assets:e.assets,elements:e.elements,onChange:t[12]||(t[12]=d=>e.changed.content=!0)},null,8,["save","item","assets","elements"])]),_:1}),m(Ge,{value:"content"},{default:p(()=>[m(l,{ref:"content",item:n.item,assets:e.assets,elements:e.elements,onError:t[13]||(t[13]=d=>e.errors.content=d),onChange:t[14]||(t[14]=d=>e.changed.content=!0)},null,8,["item","assets","elements"])]),_:1}),m(Ge,{value:"page"},{default:p(()=>[m(u,{ref:"page",item:n.item,assets:e.assets,"onUpdate:item":t[15]||(t[15]=d=>{Object.assign(n.item,d),e.changed.page=!0}),"onUpdate:aside":t[16]||(t[16]=d=>e.asidePage=d),onError:t[17]||(t[17]=d=>e.errors.page=d)},null,8,["item","assets"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e.aside==="meta"?(v(),I(o,{key:0,item:n.item},null,8,["item"])):$("",!0),e.aside==="count"?(v(),I(c,{key:1})):$("",!0),(v(),I(St,{to:"body"},[m(h,{ref:"history",modelValue:e.vhistory,"onUpdate:modelValue":t[20]||(t[20]=d=>e.vhistory=d),current:{data:{cache:n.item.cache,domain:n.item.domain,lang:n.item.lang,name:n.item.name,path:n.item.path,status:n.item.status,title:n.item.title,tag:n.item.tag,to:n.item.to,type:n.item.type,theme:n.item.theme,meta:i.clean(n.item.meta,"meta"),config:i.clean(n.item.config,"config"),content:i.clean(n.item.content,"content")},elements:((f=e.latest)==null?void 0:f.elements)||[],files:i.currentAssets},load:()=>i.versions(n.item.id),onUse:t[21]||(t[21]=d=>i.use(d)),onRevert:t[22]||(t[22]=d=>{i.use(d),i.reset()})},null,8,["modelValue","current","load"])]))],64)}const ir=we(Ro,[["render",Ko],["__scopeId","data-v-4f9fd61f"]]);var Wo=!1,Jo=!0;/*!
 * helper-js v3.1.6
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */function Bt(e){return Object.prototype.toString.call(e)==="[object Array]"}function ar(e){return Object.prototype.toString.call(e)==="[object Object]"}function Qo(e){return typeof e=="function"}function Yo(e,t){return e<t?e:t}function Qr(e,t){let n,r=0;for(;(n=e.indexOf(t))>-1;)e.splice(n,1),r++;return r}function Yr(e){return e[e.length-1]}function Xo(e){return Bt(e)?e:[e]}function Zo(e,t){let n=new Set(t);const r={};return n.forEach(a=>{r[a]=e[a]}),r}function Go(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){if(t.reverse)if(e.length!=null)for(let n=e.length-1;n>=0;n--){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(ar(e)){const n=Object.keys(e);n.reverse();for(const r of n){const a={value:e[r],key:r};(!t.exclude||!t.exclude(a))&&(yield a)}}else throw"Unsupported type";else if(e.length!=null)for(let n=0;n<e.length;n++){const r={value:e[n],index:n};(!t.exclude||!t.exclude(r))&&(yield r)}else if(ar(e))for(const n of Object.keys(e)){const r={value:e[n],key:n};(!t.exclude||!t.exclude(r))&&(yield r)}else throw"Unsupported type"})()}function eu(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}function Xr(e,t){return Object.keys(t).forEach(n=>{eu(e,n,t[n])}),e}function tu(e){const t={};return Object.keys(e).forEach(n=>{e[n]!==void 0&&(t[n]=e[n])}),t}function Oe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=Xr({...n},{childrenKey:"children"});const{childrenKey:r}=n,a=Bt(e)?e:[e];class i{}const s=(l,u,o)=>{n.reverse&&(l=l.slice(),l.reverse());const c=l.length;for(let h=0;h<c;h++){const f=l[h],d=n.reverse?c-h-1:h,k=o?[...o,d]:[];n.childFirst&&f[r]!=null&&s(f[r],f,k);const C=t(f,d,u,k);if(C===!1)throw new i;if(C==="skip children")continue;if(C==="skip siblings")break;n.childFirst||f[r]!=null&&s(f[r],f,k)}};try{s(a,null,Bt(e)?[]:null)}catch(l){if(!(l instanceof i))throw l}}function nu(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r;return Oe(e,function(){if(t(...arguments))return r={node:arguments.length<=0?void 0:arguments[0],index:arguments.length<=1?void 0:arguments[1],parent:arguments.length<=2?void 0:arguments[2],path:arguments.length<=3?void 0:arguments[3]},!1},n),r}function ru(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=nu(e,t,n);return r==null?void 0:r.node}function Zr(e,t){const n={childrenKey:"children"};t&&Object.assign(n,t);const{childrenKey:r,nodeHandler:a}=n,i=new yn;return i.childrenKey=r,Oe(e,(s,l,u,o)=>{let c=Object.assign({},s);c[r]&&(c[r]=[]),a&&(c=a(c,{oldNode:s,index:l,parent:u,path:o})),i.set(o,c)},{childrenKey:r}),i.data}class yn{constructor(){lt(this,"data");lt(this,"childrenKey","children");let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.data=t}get rootChildren(){const{childrenKey:t}=this,{data:n}=this;return Bt(n)?n:n[t]}iteratePath(t){var n=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const{childrenKey:a,rootChildren:i}=n;if(r.reverse){const s=[...n.iteratePath(t,{...r,reverse:!1})];s.reverse();for(const{path:l,node:u}of s)yield{path:l,node:u}}else{let s=[],l=i;for(const u of t){const o=[...s,u],c=l[u];yield{path:o,node:c},s=o,l=c[a]}}})()}getFamily(t){const n=[];for(const{node:r}of this.iteratePath(t))n.push(r);return n}get(t){return Yr(this.getFamily(t))}getParentAndIndex(t){const n=t.slice(),r=n.pop();return{parent:this.get(n),index:r,parentPath:n}}getParent(t){return this.getParentAndIndex(t).parent}set(t,n){if(t==null||t.length===0)this.data=n;else{const{childrenKey:r}=this;let{rootChildren:a}=this;const{parent:i,index:s}=this.getParentAndIndex(t);let l;t.length===1?(a||(this.data?this.data[r]=[]:this.data=[]),l=a):(i[r]||(i[r]=[]),l=i[r]),l[s]=n}}delete(t){const{childrenKey:n,rootChildren:r}=this,{parent:a,index:i}=this.getParentAndIndex(t),s=t.length===1?r:a[n],l=s[i];return s.splice(i,1),l}walk(t,n){const{childrenKey:r,data:a}=this;return Oe(a,t,r,n)}clone(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Zr(this.data),tu({childrenKey:this.childrenKey,nodeHandler:t.nodeHandler||void 0})}}function sr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Qo(e)?e(...t):e}function iu(e,t){return function(){let r,a;try{r=e(...arguments)}catch(i){a=i}finally{}if(a)throw a;return r}}function vt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[];let r;const a={};let i=a;return{action:function(){for(var u=arguments.length,o=new Array(u),c=0;c<u;c++)o[c]=arguments[c];if(o.length===0)return i===a&&(i=e()),i;if(r||(r=new ou),!r.has(o)&&(r.set(o,e(...o)),t.capacity!=null)){n.push(o);const h=n.splice(0,n.length-t.capacity);for(const f of h)r.delete(f)}return r.get(o)},clearCache:()=>{r=null,n.splice(0,n.length)}}}function au(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function su(e,t){for(;;){if(e.parentNode==null)return!1;if(e.parentNode===t)return!0;e=e.parentNode}}function rn(e){let t=e.getBoundingClientRect();if(document.documentElement.clientTop>0){const n=t.top-document.documentElement.clientTop,r=t.bottom,a=t.left-document.documentElement.clientLeft,i=t.right,s=t.width||i-a,l=t.height||r-n,c={top:n,right:i,bottom:r,left:a,width:s,height:l,x:a,y:n};t={...c,toJSON:()=>c}}return t}function lr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=n&&n.withSelf?e:e.parentElement;for(;r;){const a=n.until&&r===n.until;if(a&&!n.withUntil)return;const i=t(r);if(i==="break")return;if(i)return r;if(a)return;r=r.parentElement}}function Nt(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function or(e,t){for(const n of t)if(Nt(e,n))return!0;return!1}function Te(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent(`on${t}`,n,r)}function Ae(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent(`on${t}`,n,r)}function lu(e){let t=[];const n=()=>{if(!a.listening){for(const i of e){Te.apply(this,i);const s=()=>Ae.apply(this,i);t.push(s)}a.listening=!0}},a={listening:!1,stop:()=>{if(a.listening){for(const i of t)i();t=[],a.listening=!1}},resume:n,start:n};return a.start(),a}function Mt(e,t){return getComputedStyle(e)[t]}function vn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n={start:0,end:e.length-1,maxTimes:1e3,...n};let{start:r,end:a}=n;const{returnNearestIfNoHit:i,maxTimes:s}=n;let l,u;r==null&&(r=0,a=e.length-1);let o=0,c;for(;r>=0&&r<=a;){if(o>=s)throw Error(`binarySearch: loop times is over ${s}, you can increase the limit.`);l=Math.floor((a-r)/2+r),u=e[l];const h=o+1;if(c=t(u,l,h),c>0)a=l-1;else if(c<0)r=l+1;else return{index:l,value:u,count:h,hit:!0};o++}return i?{index:l,value:u,count:o+1,hit:!1,greater:c>0}:null}class ou{constructor(){lt(this,"_map",new Map);lt(this,"_values",{});lt(this,"_objCount",0)}_keysToString(t){const{_map:n}=this;let r=[];for(const a of t){if(!n.has(a))return null;r.push(n.get(a)[0])}return r.toString()}has(t){return this._keysToString(t)!=null}get(t){const{_values:n}=this,r=this._keysToString(t);if(r==null)throw"Value not found by specified keys";return n[r][1]}set(t,n){const{_map:r,_values:a}=this;let i=[];for(const s of t){let l,u=1;r.has(s)?([l,u]=r.get(s),u++):(this._objCount++,l=this._objCount.toString()),r.set(s,[l,u]),i.push(l)}a[i.toString()]=[t.slice(),n]}delete(t){const{_values:n,_map:r}=this,a=this._keysToString(t);if(a==null)throw"Value not found by specified keys";delete n[a];for(const i of t){let[s,l]=r.get(i);l--,l===0?r.delete(i):r.set(i,[s,l])}}clear(){this._map.clear(),this._values={}}*entries(){const{_values:t}=this;for(const n in t){const[r,a]=t[n];yield[r,a]}}count(){return[...this.entries()].length}}/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const uu=It({props:{table:Boolean}}),Gr=(e,t)=>{const n=e.__vccOpts||e;for(const[r,a]of t)n[r]=a;return n},cu={key:0},du={key:1};function hu(e,t,n,r,a,i){return e.table?(v(),z("table",cu,[he(e.$slots,"prepend"),V("tbody",null,[he(e.$slots,"default")]),he(e.$slots,"append")])):(v(),z("div",du,[he(e.$slots,"prepend"),he(e.$slots,"default"),he(e.$slots,"append")]))}const fu=Gr(uu,[["render",hu]]),pu=It({components:{VirtualListTable:fu},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const t=mt(0),n=mt(e.firstRender-1),r=xe(()=>{var S;return Yo(n.value,(((S=e.items)==null?void 0:S.length)||1)-1)}),a=mt(0),i=xe(()=>f.value[t.value]?X(t.value):0),s=xe(()=>f.value.length>0?X(f.value.length-1)+Yr(h.value):0),l=xe(()=>f.value[r.value]?s.value-X(r.value)-h.value[r.value]:0),u=xe(()=>e.disabled?{}:{overflow:"auto"}),o=xe(()=>{const S={display:"flex"};return e.disabled||(e.horizontal?Object.assign(S,{"margin-left":i.value+"px","margin-right":l.value+"px",width:s.value-l.value-i.value+"px"}):Object.assign(S,{"margin-top":i.value+"px","margin-bottom":l.value+"px"})),S["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete S.display,delete S["flex-direction"]),S}),c=xe(()=>wt((e.items||[]).map(()=>null))),h=xe(()=>(e.items||[]).map((S,O)=>{var D;if(c[O]!=null)return c[O];let M=(D=e.itemSize)==null?void 0:D.call(e,S,O);return M==null&&(M=a.value),M})),f=xe(()=>{const S=[];return h.value.reduce((O,D)=>(S.push(O),O+D),0),S});cn(()=>e.items,j);const d=xe(()=>{if(!e.items||e.disabled)return;const S=[];for(let O=t.value;O<=r.value;O++){const D=e.items[O];if(!D)break;S.push({item:D,index:O})}return S}),k=mt(),C=mt();vi(async()=>{j();try{te()}catch{await Gt(),j()}});let _;function x(){const S=k.value;if(!S)return;const O=W(S);_!=null&&e.buffer-Math.abs(O-_)>=10||(_=O,j())}let N=!1,A=!1;async function j(){var S;if(N){A=!0;return}if(!e.items||e.disabled)return;N=!0;const O=k.value,D=(S=C.value)==null?void 0:S.$el;if(!O||!D)return;a.value||(a.value=fe()),t.value=pe(),n.value=y(),await Gt();let M,ne=0;const Z={},oe=e.table?D.querySelector("tbody").children:D.children;for(let K=0;K<oe.length;K++){const g=oe[K],re=Mt(g,"position");if(re&&["absolute","fixed"].includes(re))continue;const de=Mt(g,"display")!=="none"?w(g):0,se=g.getAttribute("vt-index"),Pe=se?parseInt(se):t.value+ne;Z[Pe]=(Z[Pe]||0)+de,ne++}for(const K of Object.keys(Z)){const g=parseInt(K);c.value[g]!==Z[g]&&(c.value[g]=Z[g],M=!0)}M&&await Gt(),N=!1,A&&(A=!1,j());function pe(){const K=W(O)-Y(O)-e.buffer;return vn(f.value,g=>g-K,{returnNearestIfNoHit:!0}).index}function y(){const K=W(O)-Y(O)+Q(O)+e.buffer;return vn(f.value,g=>g-K,{returnNearestIfNoHit:!0}).index}function fe(){const K=[],g=e.table?D.querySelector("tbody").children:D.children;for(let re=0;re<g.length;re++){const de=g[re],se=getComputedStyle(de);if(["absolute","fixed"].includes(se.position))continue;const Pe=w(de);if(K.push(Pe),K.length>=10)break}return K.length===0?0:K.reduce((re,de)=>re+de,0)/K.length}}function Q(S){const O=getComputedStyle(S);let D=parseFloat(e.horizontal?O.width:O.height);return O.boxSizing==="border-box"&&(e.horizontal?D=D-parseFloat(O.borderLeftWidth)-parseFloat(O.borderRightWidth):D=D-parseFloat(O.borderTopWidth)-parseFloat(O.borderBottomWidth)),D}function w(S){let O=Q(S);const D=getComputedStyle(S);return e.horizontal?O+=parseFloat(D.borderLeftWidth)+parseFloat(D.borderRightWidth)+parseFloat(D.marginLeft)+parseFloat(D.marginRight):O+=parseFloat(D.borderTopWidth)+parseFloat(D.borderBottomWidth)+parseFloat(D.marginTop)+parseFloat(D.marginBottom),O=Number.isNaN(O)?0:O,O}function W(S){return e.horizontal?S.scrollLeft:S.scrollTop}function Y(S){const O=getComputedStyle(S);return e.horizontal?parseFloat(O.paddingLeft):parseFloat(O.paddingTop)}function X(S){return f.value[S]}function te(){const S=k.value;new ResizeObserver(O=>{for(let D of O)if(Nt(D.target,"vtlist")){j();break}}).observe(S)}function B(S,O){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return O;if(typeof e.itemKey=="function")return e.itemKey(S,O)}}return{listElRef:k,listInnerRef:C,onscroll:x,listStyle:u,listInnerStyle:o,visibleItemsInfo:d,getItemKey:B,update:j,sizes:h,positions:f,runtimeSizes:c}}});function gu(e,t,n,r,a,i){const s=ee("VirtualListTable");return v(),z("div",{class:"vtlist",ref:"listElRef",style:tt(e.listStyle),onScrollPassive:t[0]||(t[0]=(...l)=>e.onscroll&&e.onscroll(...l))},[m(s,{class:"vtlist-inner",ref:"listInnerRef",style:tt(e.listInnerStyle),table:e.table},{prepend:p(()=>[he(e.$slots,"prepend")]),append:p(()=>[he(e.$slots,"append")]),default:p(()=>[e.disabled?(v(!0),z(ue,{key:0},Ie(e.items,(l,u)=>he(e.$slots,"default",{key:e.getItemKey(l,u),item:l,index:u})),128)):(v(!0),z(ue,{key:1},Ie(e.visibleItemsInfo,({item:l,index:u})=>he(e.$slots,"default",{key:e.getItemKey(l,u),item:l,index:u})),128))]),_:3},8,["style","table"])],36)}const mu=Gr(pu,[["render",gu]]);/*!
 * @he-tree/tree-utils v0.1.0-alpha.5
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Ze="children";function yu(e){const n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={...vu,...n,data:e,stats:null,statsFlat:null,_statsMap:null,initialized:!1,init(){const{data:i,childrenKey:s}=this,l=new yn([]);this._statsMap=new Map,Oe(i,(o,c,h,f)=>{const d=this.statHandler({...ur(),data:o,open:!!this.defaultOpen,parent:l.getParent(f),children:[],level:f.length});this._statsMap.set(o,d),l.set(f,d)},{childrenKey:s});const u=[];l.walk(o=>{u.push(o)}),this.stats=this.statsHandler(l.rootChildren),this.statsFlat=this.statsFlatHandler(u),this.initialized=!0},getStat(i){let s=this._statsMap.get(i);if(!s)throw new cr("Stat not found");return s},has(i){if(i.isStat)return this.statsFlat.indexOf(i)>-1;try{return!!this.getStat(i)}catch(s){if(s instanceof cr)return!1;throw s}},_getPathByStat(i){if(i==null)return[];const l=this.getSiblings(i).indexOf(i);return[...i.parent?this._getPathByStat(i.parent):[],l]},afterOneCheckChanged(i){const{checked:s}=i;if(i._ignoreCheckedOnce)return delete i._ignoreCheckedOnce,!1;const l=u=>{const{parent:o}=u;if(o){let c,h,f;for(const k of o.children)k.checked?c=!0:k.checked===0?f=!0:h=!0;const d=f?0:h?c?0:!1:!0;o.checked!==d&&(this._ignoreCheckedOnce(o),o.checked=d),l(o)}};return l(i),Oe(i.children,u=>{u.checked!==s&&(this._ignoreCheckedOnce(u),u.checked=s)},{childrenKey:Ze}),!0},_ignoreCheckedOnce(i){i._ignoreCheckedOnce=!0,setTimeout(()=>{i._ignoreCheckedOnce&&(i._ignoreCheckedOnce=!1)},100)},isVisible(i){const s=i.isStat?i:this.getStat(i),l=u=>!u||!u.hidden&&u.open&&l(u.parent);return!!(!s.hidden&&l(s.parent))},updateCheck(){Oe(this.stats,i=>{if(i.children&&i.children.length>0){const s=i.children.every(l=>l.checked);i.checked!==s&&(this._ignoreCheckedOnce(i),i.checked=s)}},{childFirst:!0,childrenKey:Ze})},getChecked(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.statsFlat.filter(s=>s.checked||i&&s.checked===0)},getUnchecked(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this.statsFlat.filter(s=>i?!s.checked:s.checked===!1)},openAll(){for(const i of this.statsFlat)i.open=!0},closeAll(){for(const i of this.statsFlat)i.open=!1},openNodeAndParents(i){const s=i.isStat?i:this.getStat(i);for(const l of this.iterateParent(s,{withSelf:!0}))l.open=!0},_calcFlatIndex(i,s){let l=i?this.statsFlat.indexOf(i)+1:0;const u=i?i.children:this.stats;for(let o=0;o<s;o++)l+=this._count(u[o]);return l},add(i,s,l){if(this.has(i))throw"Can't add because data exists in tree";const u=s?s.children:this.stats;l==null&&(l=u.length);const o=this.statHandler({...ur(),open:!!this.defaultOpen,data:i,parent:s||null,children:[],level:s?s.level+1:1});this._setPosition(o,s||null,l);const c=i[this.childrenKey];if(c){const h=c.slice();for(const f of h)this.add(f,o)}},remove(i){const s=this.getSiblings(i);if(s.includes(i)){Qr(s,i);const l=this._flat(i);this.statsFlat.splice(this.statsFlat.indexOf(i),l.length);for(const u of l)this._statsMap.delete(u.data);return this.afterRemoveStat(i),!0}return!1},getSiblings(i){const{parent:s}=i;return s?s.children:this.stats},_setPosition(i,s,l){(s?s.children:this.stats).splice(l,0,i),i.parent=s,i.level=s?s.level+1:1;const o=this._calcFlatIndex(s,l),c=this._flat(i);this.statsFlat.splice(o,0,...c);for(const h of c)this._statsMap.has(h.data)||this._statsMap.set(h.data,h);Oe(i,(h,f,d)=>{d&&(h.level=d.level+1)},{childrenKey:Ze}),this.afterSetStat(i,s,l)},*iterateParent(i,s){let l=s!=null&&s.withSelf?i:i.parent;for(;l;)yield l,l=l.parent},move(i,s,l){if(this.has(i)){if(i.parent===s&&this.getSiblings(i).indexOf(i)===l)return!1;if(i===s)throw new Error("Can't move node to it self");if(s&&i.level<s.level){let u;for(const o of this.iterateParent(s))if(o.level===i.level){u=o;break}if(i===u)throw new Error("Can't move node to its descendant")}this.remove(i)}return this._setPosition(i,s,l),!0},_flat(i){const s=[];return Oe(i,l=>{s.push(l)},{childrenKey:Ze}),s},_count(i){return this._flat(i).length},getData(i,s){const{childrenKey:l}=this,u=new yn([]);return u.childrenKey=l,Oe(s||this.stats,(o,c,h,f)=>{let d={...o.data,[l]:[]};i&&(d=i(d)),u.set(f,d)},{childrenKey:Ze}),u.data}},a=r;return r.noInitialization||a.init(),a}const vu={childrenKey:"children",defaultOpen:!1,statsHandler(e){return e},statsFlatHandler(e){return e},afterSetStat(e,t,n){},afterRemoveStat(e){},statHandler(e){return e}};function ur(){return{isStat:!0,hidden:!1,checked:!1,style:null,class:null,draggable:null,droppable:null}}class cr extends Error{constructor(t){super(t),this.name="StatNotFoundError"}}/*!
 * drag-event-service v2.0.0
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const Dt={start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","touchend"]},an={isTouch(e){return e.type&&e.type.startsWith("touch")},_getStore(e){return e._wrapperStore||(e._wrapperStore=[]),e._wrapperStore},on(e,t,n,r){const{args:a,mouseArgs:i,touchArgs:s}=dr(r),l=this._getStore(e),u=this,o=function(c){let h;if(u.isTouch(c))h={x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY,pageX:c.changedTouches[0].pageX,pageY:c.changedTouches[0].pageY,clientX:c.changedTouches[0].clientX,clientY:c.changedTouches[0].clientY,screenX:c.changedTouches[0].screenX,screenY:c.changedTouches[0].screenY};else if(h={x:c.pageX,y:c.pageY,pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,screenX:c.screenX,screenY:c.screenY},t==="start"&&c.which!==1)return;return n.call(this,c,h)};l.push({handler:n,wrapper:o}),Te.call(null,e,Dt[t][0],o,...a,...i),Te.call(null,e,Dt[t][1],o,...a,...s)},off(e,t,n,r){const{args:a,mouseArgs:i}=dr(r),s=this._getStore(e);for(let l=s.length-1;l>=0;l--){const{handler:u,wrapper:o}=s[l];n===u&&(Ae.call(null,e,Dt[t][0],o,...a,...i),Ae.call(null,e,Dt[t][1],o,...a,...i),s.splice(l,1))}}};function dr(e){e||(e={});const t=e.args||[],n=e.mouseArgs||[],r=e.touchArgs||[];return{args:t,mouseArgs:n,touchArgs:r}}/*!
 * @he-tree/dnd-utils v0.1.0-alpha.4
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: null
 * Released under the MIT License.
 */const sn=new Map,ze={triggerElement:null,dragElement:null,internal:!1,dropEffect:"none",preventDefault:!1},be=ze;function kt(e){e.dataTransfer&&(e.dataTransfer.dropEffect=be.dropEffect)}function ku(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(sn.has(e))throw"Already registered on specified element";const n={...t},r=n;Xr(n,bu),an.on(e,"start",a,{touchArgs:[{passive:!0}]}),an.on(e,"end",i);function a(h){var f;const d=h.target;d.nodeType===Node.ELEMENT_NODE&&(be.triggerElement=d);const k=d;if(n.ingoreHTMLTags&&k.tagName&&n.ingoreHTMLTags.find(_=>_.toUpperCase()===k.tagName))return;const C=(f=n.beforeDragStart)===null||f===void 0?void 0:f.call(n,h);C&&(C.setAttribute("draggable","true"),be.dragElement=C)}function i(h){be.dragElement&&be.dragElement.removeAttribute("draggable")}function s(h){var f;be.internal=!0,(f=n.onDragStart)===null||f===void 0||f.call(n,h),kt(h)}function l(h){var f;(f=n.onDrag)===null||f===void 0||f.call(n,h),kt(h)}function u(h){var f;(f=n.onDragEnd)===null||f===void 0||f.call(n,h),be.internal=!1,be.dragElement&&be.dragElement.removeAttribute("draggable"),be.triggerElement=null,be.dragElement=null,be.dropEffect="none"}const o=wu(e,{onDragLeave(h){var f;(f=n.onDragLeave)===null||f===void 0||f.call(n,h),kt(h)},onDragEnter(h){var f;r.ifPreventDefault(h)&&h.preventDefault(),(f=n.onDragEnter)===null||f===void 0||f.call(n,h),kt(h)},onDragOver(h){var f;r.ifPreventDefault(h)&&h.preventDefault(),(f=n.onDragOver)===null||f===void 0||f.call(n,h),kt(h)},onDrop(h){var f;r.ifPreventDefault(h)&&h.preventDefault(),(f=n.onDrop)===null||f===void 0||f.call(n,h)},onEnter(h){var f;(f=n.onEnter)===null||f===void 0||f.call(n,h)},onLeave(h){var f;(f=n.onLeave)===null||f===void 0||f.call(n,h)}});return Te(e,"dragstart",s),Te(e,"drag",l),Te(e,"dragend",u),Object.assign(n,{root:e,destroy:()=>{an.off(e,"start",a,{touchArgs:[{passive:!0}]}),Ae(e,"dragstart",s),Ae(e,"drag",l),Ae(e,"dragend",u),o(),sn.delete(e)}}),sn.set(e,r),r}const bu={ingoreHTMLTags:["INPUT","TEXTAREA","SELECT","OPTGROUP","OPTION"],ifPreventDefault(e){return ze.dragElement?!0:be.preventDefault},beforeDragStart(e){},onDragStart(e){},onDrag(e){},onDragEnter(e){},onDragLeave(e){},onDragOver(e){},onDragEnd(e){},onDrop(e){}};let jt=null;const xu=e=>{jt=e,setTimeout(()=>{jt=null},20)};function wu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e;let r=!1;const a=d=>{var k;r=!0,(k=t.onEnter)===null||k===void 0||k.call(t,d),c.resume()},i=d=>{var k;xu(d.target),(k=t.onDragEnter)===null||k===void 0||k.call(t,d),r||a(d)},s=d=>{var k;r||a(d),(k=t.onDragOver)===null||k===void 0||k.call(t,d)},l=d=>{var k;(k=t.onDragLeave)===null||k===void 0||k.call(t,d);const C=function(){var x;let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d;r=!1,(x=t.onLeave)===null||x===void 0||x.call(t,N),c.stop()},_=jt;jt=null,_&&su(_,n)||C()},u=d=>{var k;(k=t.onDrop)===null||k===void 0||k.call(t,d)},o=d=>{var k;d instanceof KeyboardEvent&&d.key!=="Escape"||(r=!1,c.stop(),(k=t.onEndBeforeLeave)===null||k===void 0||k.call(t,d))},c=lu([[e,"drop",o],[window,"mouseup",o],[window,"touchend",o],[window,"keydown",o]]);c.stop();const h=()=>{Te(e,"dragenter",i),Te(e,"dragover",s),Te(e,"dragleave",l),Te(e,"drop",u)},f=()=>{Ae(e,"dragenter",i),Ae(e,"dragover",s),Ae(e,"dragleave",l),Ae(e,"drop",u),c.stop()};return h(),f}/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */let Ut=!1;const Cu=()=>{Ut=!0,setTimeout(()=>{Ut=!1},100)},Su=It({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const n=xe(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));cn(()=>e.stat.checked,i=>{Ut||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),cn(()=>e.stat.open,i=>{Ut||(t(i?"open":"close",e.stat),Cu())});const r=xe(()=>{const i=[],s=c=>{var h;if(c.parent){let f=(h=c.parent)==null?void 0:h.children.indexOf(c);do{f++;let d=c.parent.children[f];if(d){if(!d.hidden)return!0}else break}while(!0)}return!1},l=e.rtl?"right":"left",u=e.btt?"top":"bottom";let o=e.stat;for(;o;){let c=(o.level-2)*e.indent+e.treeLineOffset;const h=s(o),f=()=>{i.push({style:{[l]:c+"px",[u]:h?0:"50%"}})};o===e.stat?o.level>1&&f():h&&f(),o=o.parent}return i}),a=xe(()=>{let i=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:i+"px"}});return{indentStyle:n,vLines:r,hLineStyle:a}}}),ei=(e,t)=>{const n=e.__vccOpts||e;for(const[r,a]of t)n[r]=a;return n},Eu={class:"tree-node-inner"},$u={key:1,class:"tree-node",ref:"el"};function Iu(e,t,n,r,a,i){return e.table?(v(),z("tr",$u,[he(e.$slots,"default",{indentStyle:e.indentStyle})],512)):(v(),z("div",{key:0,class:ce(["tree-node",{"tree-node--with-tree-line":e.treeLine}]),style:tt(e.indentStyle),ref:"el"},[e.treeLine?(v(),z(ue,{key:0},[(v(!0),z(ue,null,Ie(e.vLines,s=>(v(),z("div",{class:"tree-line tree-vline",style:tt(s.style)},null,4))),256)),e.stat.level>1?(v(),z("div",{key:0,class:"tree-line tree-hline",style:tt(e.hLineStyle)},null,4)):$("",!0)],64)):$("",!0),V("div",Eu,[he(e.$slots,"default",{indentStyle:e.indentStyle})])],6))}const Pu=ei(Su,[["render",Iu]]);function Ou(e,t={}){const n={...t,statHandler(r){return this._statHandler2&&(r=this._statHandler2(r)),ln(t.statHandler,wt(r))},statsHandler(r){return ln(t.statsHandler,wt(r))},statsFlatHandler(r){return ln(t.statsFlatHandler,wt(r))}};return yu(e,n)}function ln(e,t){return e?e(t):t}const Du=It({components:{VirtualList:mu,TreeNode:Pu},props:{value:{required:Wo,type:Array},modelValue:{required:Jo,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Ou([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return this.modelValue||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let n=e;return this.btt&&(n=n.slice(),n.reverse()),n.filter(r=>t(r))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit("update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:on(ve("getStat")),has:on(ve("has")),updateCheck:ve("updateCheck"),getChecked:ve("getChecked"),getUnchecked:ve("getUnchecked"),openAll:ve("openAll"),closeAll:ve("closeAll"),openNodeAndParents:ve("openNodeAndParents"),isVisible:ve("isVisible"),move:hr("move"),add:on(hr("add")),addMulti(e,t,n){this.batchUpdate(()=>{let r=n;for(const a of e)this.add(a,t,r),r!=null&&r++})},remove:ve("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const n of t)this.remove(n)})},iterateParent:ve("iterateParent"),getSiblings:ve("getSiblings"),getData:ve("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const n=e();return this.batchUpdateWaiting=t,n}},watch:{processor:{immediate:!0,handler(e){if(e){const t=n=>{if(n){const{childrenKey:r}=this;return n[r]||(n[r]=[]),n[r]}else return this.valueComputed};e._statHandler2=this.statHandler?n=>n.data===this.placeholderData?n:this.statHandler(n):null,e.afterSetStat=(n,r,a)=>{const{childrenKey:i,updateBehavior:s}=this;let l=this.valueComputed;if(s==="new"){if(this.batchUpdateWaiting)return;l=this.getData()}else if(s==="modify"){const u=t(r==null?void 0:r.data);u.includes(n.data)||u.splice(a,0,n.data)}this.batchUpdateWaiting||this._updateValue(l)},e.afterRemoveStat=n=>{var r;const{childrenKey:a,updateBehavior:i}=this;let s=this.valueComputed;if(i==="new"){if(this.batchUpdateWaiting)return;s=this.getData()}else if(i==="modify"){const l=t((r=n.parent)==null?void 0:r.data);Qr(l,n.data)}this.batchUpdateWaiting||this._updateValue(s)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,Zo(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:t}=this;t.data=e,t.init(),this.stats=t.stats,this.statsFlat=t.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function ve(e){return function(...t){return this.processor[e](...t)}}function hr(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function on(e){return function(t,...n){return t&&(t=wt(t)),e.call(this,t,...n)}}const Tu={key:0,class:"drag-placeholder he-tree-drag-placeholder"},Au=["colspan"],_u={class:"drag-placeholder he-tree-drag-placeholder"};function Lu(e,t,n,r,a,i){const s=ee("TreeNode"),l=ee("VirtualList");return v(),I(l,{class:ce(["he-tree",{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering}]),ref:"vtlist",items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},{prepend:p(()=>[he(e.$slots,"prepend",{tree:e.self})]),default:p(({item:u,index:o})=>[m(s,{"vt-index":o,class:ce([u.class,{"drag-placeholder-wrapper":u.data===e.placeholderData,"dragging-node":u===e.dragNode}]),style:tt(u.style),stat:u,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor,onClick:c=>e.$emit("click:node",u),onOpen:t[0]||(t[0]=c=>e.$emit("open:node",c)),onClose:t[1]||(t[1]=c=>e.$emit("close:node",c)),onCheck:t[2]||(t[2]=c=>e.$emit("check:node",c))},{default:p(({indentStyle:c})=>[u.data===e.placeholderData?(v(),z(ue,{key:0},[e.table?(v(),z("td",{key:1,style:tt(c),colspan:e.placeholderColspan},[V("div",_u,[he(e.$slots,"placeholder",{tree:e.self})])],12,Au)):(v(),z("div",Tu,[he(e.$slots,"placeholder",{tree:e.self})]))],64)):he(e.$slots,"default",{key:1,node:u.data,stat:u,indentStyle:c,tree:e.self},()=>[F(E(u.data[e.textKey]),1)])]),_:2},1032,["vt-index","class","style","stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor","onClick"])]),append:p(()=>[he(e.$slots,"append",{tree:e.self})]),_:3},8,["class","items","disabled","table","itemKey"])}const Fu=ei(Du,[["render",Lu]]);let U=null,L=null,Lt,xt,Xe,Tt,un,ke,fr;const bt={get startInfo(){return Lt},get targetInfo(){return xt}},Vu=It({extends:Fu,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const n=this.eachDraggable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return sr(this.rootDroppable,[this,U]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const n=this.eachDroppable(e);if(n!=null)return n}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return sr((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(o,c)=>{let h=!0;return U&&U!==this&&(h=h&&this._isMoved),this.table&&!this._isDragCopy&&(h=h&&this._isDragCopy),h&&(o.x!==c.x||o.y!==c.y)},t=(o,c)=>{L.ignoreUpdate(()=>{if(!L.has(L.placeholderData)){if(L.table){let f=0;const d=L.getRootEl().querySelector("tr");if(d)for(const{value:k}of Go(d.children))Mt(k,"display")!=="none"&&(f+=k.colSpan||1);f<1&&(f=1),L.placeholderColspan=f}L.add(L.placeholderData)}const h=L.getStat(L.placeholderData);L.move(h,o,c)})},n=()=>{const o=this;if(o.has(o.placeholderData))return o.remove(o.getStat(o.placeholderData)),!0},r=o=>{o?ze.dropEffect=U!=null&&U.dragCopy?"copy":"move":ze.dropEffect="none"},a=o=>{const c=this;o?r(!0):c.keepPlaceholder?c.has(c.placeholderData)||r(!1):(n(),r(!1))};let i={x:0,y:0};const s=this.getRootEl();let l=null;const u=()=>{L!=null&&L.has(L.placeholderData)&&L.ignoreUpdate(()=>{L.remove(L.getStat(L.placeholderData)),U&&(U.dragNode.hidden=!1,U.dragOvering=!1)})};this.treeDraggableInstance=ku(s,{beforeDragStart:o=>{if(!ze.triggerElement)return;let c=this.triggerClass;(!c||c.length===0)&&(c="tree-node");let h=Xo(c),f=lr(ze.triggerElement,d=>{if(or(d,h))return!0;if(Nt(d,"tree-node"))return"break"},{withSelf:!0,until:s});if(l=lr(f,d=>{if(Nt(d,"tree-node"))return!0},{withSelf:!0,until:s}),!!l){if(ke=this.getNodeByElement(l),!ke)throw"Can't find drag node";if(this.isDraggable(ke))return this.$emit("before-drag-start",ke),this.$emit("beforeDragStart",ke),s}},onDragStart:o=>{var c,h,f;if(!l||!ke)return;{const{x:C,y:_}=l.getBoundingClientRect(),{clientX:x,clientY:N}=o;(c=o.dataTransfer)==null||c.setDragImage(l,x-C,N-_)}un={x:o.clientX,y:o.clientY},U=this,U.dragNode=ke,Tt=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:o.clientX,y:o.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(l);{let C,_=0;if(this.table){let x=l.getBoundingClientRect();C={x:x.x,y:x.y},this.rtl&&(C.x=x.right),_=x.height}else if(!this.rtl)C=l.children[0].getBoundingClientRect().toJSON(),_=C.height;else{const x=l.children[0].getBoundingClientRect();C={x:x.right,y:x.y},_=x.height}return this.btt&&(C.y+=_),C}})(),this.dragOvering=!0;const d=U.getSiblings(U.dragNode),k=d.indexOf(ke);Lt={tree:U,dragNode:ke,parent:ke.parent,siblings:d,indexBeforeDrop:k},L=this,(h=o.dataTransfer)==null||h.setData("text",`he-tree drag start at ${new Date().toISOString()}`),U._eachDroppable()||setTimeout(()=>{ke.hidden=!0,t(ke.parent,k+1)},0),(f=this.ondragstart)==null||f.call(this,o)},onEnter:o=>{this.$emit("enter",o)},onLeave:o=>{Xe=null,this.dragOvering=!1,ze.preventDefault=!1,n(),this.$emit("leave",o)},onDragOver:iu(o=>{if(!U){if(!this.onExternalDragOver||this.onExternalDragOver(o)===!1)return;ze.preventDefault=!0}const c={x:o.clientX,y:o.clientY},h=e(c,i);if(i=c,!h)return;this.dragOvering=!0,L=this;const f=Tt?{x:Tt.x+(c.x-un.x),y:Tt.y+(c.y-un.y)}:{...c},{btt:d,rtl:k}=L;if(L.disableDrop){ze.dropEffect="none";return}let C,_;const x=L.getRootEl().querySelectorAll(".tree-node"),N=[];x.forEach(D=>{!or(D,["drag-placeholder-wrapper","dragging-node"])&&Mt(D,"display")!=="none"&&N.push(D)});const A=vn(N,D=>rn(D)[d?"bottom":"top"]-f.y,{returnNearestIfNoHit:!0});let j=null,Q,w;A.hit||(A.greater?d||(j=A.index-1,N[j]||j++):d&&(j=A.index+1,N[j]||j--)),j==null&&(j=A.index),Q=N[j],w=d?N[j-1]:N[j+1],C=Q&&L.getNodeByElement(Q),_=w&&L.getNodeByElement(w);const{indent:W}=L,Y=vt(()=>{if(L.table){let D=rn(Q).toJSON();const M=W*(C.level-1);return k?(D.width-=M,D.right-=M):D.x+=M,D}else return rn(Q.firstElementChild)}).action,X=vt(()=>d?f.y>Y().y+Y().height/2:f.y<Y().y+Y().height/2).action,te=vt(()=>d?!Q||j===N.length-1&&X():!Q||j===0&&X()).action,B=vt(()=>k?f.x-(Y().x+Y().width):Y().x-f.x).action,S=vt(()=>k?f.x<Y().x+Y().width-W:f.x>Y().x+W).action;let O;if(te())O=1,C=null;else if(C)B()>0?O=C.level-Math.ceil(B()/W):S()?O=C.level+1:O=C.level;else return;_&&O<_.level&&(O=_.level),(async()=>{let D,M,ne=!1,Z=null;const oe=async K=>{if(K.open)return!0;if(L.dragOpen)if(L.dragOpenDelay)if(Z=K,Xe===K)ne=!0;else{let g=au();Xe=K;const re=K;return setTimeout(async()=>{re!==Xe?(ne=!0,g.resolve(!0)):(L.beforeDragOpen&&await L.beforeDragOpen(K),re!==Xe?(ne=!0,g.resolve(!0)):(K.open=!0,Z=null,g.resolve(!0)))},L.dragOpenDelay),await g.promise}else return L.beforeDragOpen&&await L.beforeDragOpen(K),K.open=!0,!0;else return!1},pe=async()=>{if(L.isDroppable(C)&&await oe(C)){if(ne)return;D=C,M=null}else return!1},y=(K=O)=>{let g=C,re=[];for(;g&&g.level>=K;)g=g.parent||null,re.unshift(g);let de=0;for(const se of re){if(L.isDroppable(se))return D=se,M=re[de+1]||C,!0;de++}return!1};fr=C||null,C?O>C.level?await pe()===!1&&y(C.level):y()===!1&&await pe():L.isDroppable(null)&&(D=null),Xe=Z;const fe=!!(!ne&&(D||D===null));return{cancelled:ne,success:fe,parent:D,index:fe?M?(D?D.children:L.stats).filter(K=>K.data!==L.placeholderData).indexOf(M)+1:0:-1}})().then(D=>{if(!D.cancelled){if(!D.success){a(!1);return}if(L.maxLevel!=null&&L.maxLevel>0){let M=1;if(U){const ne=U.dragNode;let Z=0;Oe(ne,oe=>{oe.level>Z&&(Z=oe.level)},{childrenKey:Ze}),M=Z-ne.level+1}if(M+(D.parent?D.parent.level:0)>L.maxLevel){a(!1);return}}a(!0),t(D.parent,D.index)}})}),onDrop:o=>{L=this;const c=!U;if(!L)return;const h=U==null?void 0:U.dragNode;let f,d=(()=>{var k;let C=!0;if(!L.has(L.placeholderData))C=!1;else if(c)f=(k=this.externalDataHandler)==null?void 0:k.call(this,o),C=f!=null;else if(!U.dragCopy){const _=L.getStat(L.placeholderData);U===L&&_.parent===h.parent&&ru(h,x=>x===_)}return C})();if(d){const k=L.getStat(L.placeholderData),C=L.getSiblings(k);xt={tree:L,dragNode:h,parent:k.parent,siblings:C,indexBeforeDrop:C.indexOf(k)}}(()=>{if(u(),d){let k=xt.indexBeforeDrop;U&&!U.dragCopy&&U===L&&Lt.parent==xt.parent&&Lt.indexBeforeDrop<k&&k--,U&&U!==L&&!U._eachDroppable()&&U.batchUpdate(()=>{U.remove(h),U.updateCheck()}),L.batchUpdate(()=>{let C=U==null?void 0:U.dragNode,_;f?_=f:U._eachDroppable()&&(_=Zr(U.dragNode.data,{childrenKey:U.childrenKey}),U.dragCopyDataHandler&&(_=U.dragCopyDataHandler(_))),_&&(L.add(_),C=L.getStat(_)),L.move(C,xt.parent,k),L.updateCheck()})}L.$emit("after-drop"),d&&(U&&(U.dragCopy||U.$emit("change")),L!==U&&L.$emit("change"))})()},onDragEnd:o=>{u(),U&&(U.dragNode&&(U.dragNode.hidden=!1),U.dragNode=null,U.dragOvering=!1,U=null),L=null,Xe=null,ke=null,fr=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),zu={components:{Draggable:Vu},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{menu:{},items:[],loading:!0,checked:null,clip:null,term:""}},setup(){const e=Sn(),t=rt(),n=Ke();return{app:En(),auth:n,languages:e,messages:t}},created(){this.searchd=this.debounce(this.search,500),this.fetch().then(e=>{this.items=e.data,this.loading=!1})},mounted(){this.checked=!1},computed:{canTrash(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&!t.data.deleted_at))},isChecked(){var e;return this.checked||((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked))},isTrashed(){var e;return this.isChecked&&((e=this.$refs.tree)==null?void 0:e.statsFlat.some(t=>t._checked&&t.data.deleted_at))}},methods:{add(){if(this.embed||!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=this.create();this.$apollo.mutate({mutation:le`mutation ($input: PageInput!) {
            addPage(input: $input) {
              id
            }
          }`,variables:{input:e}}).then(t=>{if(t.errors)throw t.errors;if(!t.data.addPage)throw new Error("No data in addPage mutation result");const n={...t.data.addPage};this.$refs.tree.add(n),this.$emit("select",n)}).catch(t=>{this.messages.add(this.$gettext("Error adding root page")+`:
`+t,"error"),this.$log("PageList::add(): Error adding root page",t)})},change(){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const e=bt.targetInfo.parent,n=bt.targetInfo.siblings[bt.targetInfo.indexBeforeDrop+1]||null;this.$apollo.mutate({mutation:le`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:bt.startInfo.dragNode.data.id,parent:e?e.data.id:null,ref:n?n.data.id:null}}).then(r=>{if(r.errors)throw r.errors;const a=bt.startInfo.parent;a!=null&&a.data&&!(a!=null&&a.children.length)&&(a.data.has=!1),e&&(e.data.has=!0)}).catch(r=>{this.messages.add(this.$gettext("Error moving page")+`:
`+r,"error"),this.$log("PageList::change(): Error moving page",r)})},copy(e,t){this.clip={type:"copy",node:t,stat:e}},create(e={}){return Object.assign({path:"_"+Math.floor(Math.random()*1e4),lang:this.$vuetify.locale.current||this.languages.default(),status:0,cache:5},e)},cut(e,t){this.$refs.tree.statsFlat.forEach(n=>{delete n.cut}),e.cut=!0,this.clip={type:"cut",node:t,stat:e}},drop(e){if(!this.auth.can("page:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>{var r;return n._checked&&((r=n.data)==null?void 0:r.id)});t.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            dropPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)this.update(r,a=>{a.data.deleted_at=new Date().toISOString().replace(/T/," ").substring(0,19),a.check=!1});this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error trashing page")+`:
`+n,"error"),this.$log("PageList::drop(): Error trashing page",t,n)})},fetch(e=null,t=1,n=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const r=this.filter.publish||null,a=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,delete i.view,i.parent_id=e,this.$apollo.query({query:le`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:i,page:t,limit:n,trashed:a,publish:r}}).then(s=>{if(s.errors)throw s.errors;return this.transform(s.data.pages)}).catch(s=>{this.messages.add(this.$gettext("Error fetching pages")+`:
`+s,"error"),this.$log("PageList::fetch(): Error fetching page",e,t,n,s)})},fields(){return`id
          parent_id
          created_at
          deleted_at
          editor
          has
          latest {
            id
            published
            publish_at
            data
            editor
            created_at
          }`},insert(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,a=n.indexOf(e),i=this.create();let s=null;switch(t===null&&!e.open&&this.load(e,e.data),t){case 0:s=e.data.id;break;case null:s=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:s=n[a+1]?n[a+1].data.id:null;break}this.$apollo.mutate({mutation:le`mutation ($input: PageInput!, $parent: ID, $ref: ID) {
            addPage(input: $input, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{input:i,parent:r?r.data.id:null,ref:s}}).then(l=>{if(l.errors)throw l.errors;i.id=l.data.addPage.id,(t!==null||e.open)&&this.$refs.tree.add(i,r,t!==null?a+t:0),r&&(r.data.has=!0),this.invalidate()}).catch(l=>{this.messages.add(this.$gettext("Error inserting page")+`:
`+l,"error"),this.$log("PageList::insert(): Error inserting page",l)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"pages"}),e.gc()},keep(e){if(!this.auth.can("page:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(a=>a._checked&&a.data.id&&a.data.deleted_at),n=t.filter(a=>t.indexOf(a.parent)===-1),r=e.data.deleted_at||null;n.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            keepPage(id: $id) {
              id
            }
          }`,variables:{id:n.map(a=>a.data.id)}}).then(a=>{if(a.errors)throw a.errors;for(const i of n)this.update(i,s=>{r>=s.data.deleted_at&&(s.data.deleted_at=null,s.check=!1)});this.invalidate()}).catch(a=>{this.messages.add(this.$gettext("Error restoring page")+`:
`+a,"error"),this.$log("PageList::keep(): Error restoring page",n,a)})},load(e,t){!e.open&&!t.children&&(e.loading=!0,this.fetch(t.id,e.page?e.page+1:1).then(n=>{this.$refs.tree.addMulti(n.data,e,0),e.page=n.currentPage||1}).finally(()=>{e.loading=!1})),e.open=!e.open},move(e,t=null){if(!this.auth.can("page:move")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,a=n.indexOf(e);let i=null;switch(t){case 0:i=e.data.id;break;case null:i=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:i=n[a+1]?n[a+1].data.id:null;break}this.$apollo.mutate({mutation:le`mutation ($id: ID!, $parent: ID, $ref: ID) {
            movePage(id: $id, parent: $parent, ref: $ref) {
              id
            }
          }`,variables:{id:this.clip.node.id,parent:r?r.data.id:null,ref:i}}).then(s=>{var u;if(s.errors)throw s.errors;const l=t!==null?a<this.$refs.tree.getSiblings(e).indexOf(this.clip.stat)?a+t:a:0;this.$refs.tree.move(this.clip.stat,r,l),r&&((u=this.clip.stat.children)!=null&&u.length||(e.parent.data.has=!1),r.data.has=!0),this.invalidate()}).catch(s=>{this.messages.add(this.$gettext("Error moving page")+`:
`+s,"error"),this.$log("PageList::move(): Error moving page",e,t,s)}),this.show()},paste(e,t=null){if(!this.auth.can("page:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const n=this.$refs.tree.getSiblings(e),r=t!==null?e.parent:e,a=n.indexOf(e),i={...this.clip.node};let s=null;switch(t){case 0:s=e.data.id;break;case null:s=e.children&&e.children[0]?e.children[0].data.id:null;break;case 1:s=n[a+1]?n[a+1].data.id:null;break}return this.$apollo.query({query:le`query($id: ID!) {
            page(id: $id) {
              meta
              config
              content
              files {
                id
              }
              elements {
                id
              }
            }
          }`,variables:{id:i.id}}).then(l=>{var u,o,c,h,f,d,k,C,_,x;if(l.errors)throw l.errors;this.$apollo.mutate({mutation:le`mutation ($input: PageInput!, $parent: ID, $ref: ID, $elements: [ID!], $files: [ID!]) {
              addPage(input: $input, parent: $parent, ref: $ref, elements: $elements, files: $files) {
                ${this.fields()}
              }
            }`,variables:{input:{status:0,to:i.to,tag:i.tag,type:i.type,theme:i.theme,lang:i.lang,name:i.name,title:i.title,cache:i.cache,domain:i.domain,related_id:i.id,meta:((o=(u=l==null?void 0:l.data)==null?void 0:u.page)==null?void 0:o.meta)||"{}",config:((h=(c=l==null?void 0:l.data)==null?void 0:c.page)==null?void 0:h.config)||"{}",content:((d=(f=l==null?void 0:l.data)==null?void 0:f.page)==null?void 0:d.content)||"[]",path:i.path+"_"+Math.floor(Math.random()*1e4)},parent:r?r.data.id:null,ref:s,elements:((C=(k=l==null?void 0:l.data)==null?void 0:k.page)==null?void 0:C.elements.map(N=>N.id))||[],files:((x=(_=l==null?void 0:l.data)==null?void 0:_.page)==null?void 0:x.files.map(N=>N.id))||[]}}).then(N=>{if(N.errors)throw N.errors;if(!N.data.addPage)throw new Error("No page data returned");const A=t!==null?this.$refs.tree.getSiblings(e).indexOf(e)+t:0,j=N.data.addPage;this.$refs.tree.add(j,r,A),this.invalidate()}).catch(N=>{this.messages.add(this.$gettext("Error copying page")+`:
`+N,"error"),this.$log("PageList::paste(): Error copying page",e,t,N)})}).catch(l=>{this.messages.add(this.$gettext("Error fetching page")+`:
`+l,"error"),this.$log("PageList::paste(): Error fetching page",i.id,l)})},publish(e){if(!this.auth.can("page:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id&&!n.data.published);t.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            pubPage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id)}}).then(n=>{if(n.errors)throw n.errors;for(const r of t)r.data.published=!0,r.check=!1;this.invalidate()}).catch(n=>{this.messages.add(this.$gettext("Error publishing page")+`:
`+n,"error"),this.$log("PageList::publish(): Error publishing page",t,n)})},purge(e){if(!this.auth.can("page:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.$refs.tree.statsFlat.filter(n=>n._checked&&n.data.id);t.length&&this.$apollo.mutate({mutation:le`mutation ($id: [ID!]!) {
            purgePage(id: $id) {
              id
            }
          }`,variables:{id:t.map(n=>n.data.id).reverse()}}).then(n=>{var r;if(n.errors)throw n.errors;for(const a of t)this.$refs.tree.remove(a),a.parent&&!((r=a.parent.children)!=null&&r.length)&&(a.parent.data.has=!1)}).catch(n=>{this.messages.add(this.$gettext("Error purging page")+`:
`+n,"error"),this.$log("PageList::purge(): Error purging page",t,n)})},reload(e=!0){if(this.items=[],this.loading=!0,e){const n=this.$apollo.provider.defaultClient.cache;n.evict({id:"ROOT_QUERY",fieldName:"pages"}),n.gc()}(this.filter.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})},search(e=1,t=100){if(!this.auth.can("page:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const n=this.filter.publish||null,r=this.filter.trashed||"WITHOUT",a={...this.filter};return delete a.trashed,delete a.publish,delete a.view,this.term&&(a.any=this.term),this.$apollo.query({query:le`query($filter: PageFilter, $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
            pages(filter: $filter, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
              data {
                ${this.fields()}
              }
              paginatorInfo {
                currentPage
                lastPage
              }
            }
          }`,variables:{filter:a,page:e,limit:t,trashed:r,publish:n}}).then(i=>{if(i.errors)throw i.errors;return this.transform(i.data.pages)}).catch(i=>{this.messages.add(this.$gettext("Error searching pages")+`:
`+i,"error"),this.$log("PageList::search(): Error searching pages",e,t,i)})},show(e=null){e===null?this.menu={}:this.menu[e]?this.menu[e]=!1:(this.menu={},this.menu[e]=!0)},status(e,t){if(!this.auth.can("page:save")){this.messages.add(this.$gettext("Permission denied"),"error");return}(e?[e]:this.$refs.tree.statsFlat.filter(r=>r._checked&&r.data.id)).forEach(r=>{this.$apollo.mutate({mutation:le`mutation ($id: ID!, $input: PageInput!) {
              savePage(id: $id, input: $input) {
                id
              }
            }`,variables:{id:r.data.id,input:{status:t}}}).then(a=>{if(a.errors)throw a.errors;r.data.status=t}).catch(a=>{this.messages.add(this.$gettext("Error saving page")+`:
`+a,"error"),this.$log("PageList::status(): Error saving page",r,t,a)})})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),e.theme&&t.push("Theme: "+e.theme),e.type&&t.push("Page type: "+e.type),e.tag&&t.push("Tag: "+e.tag),e.cache&&t.push("Cache: "+e.cache+" min"),t.join(`
`)},toggle(){this.$refs.tree.statsFlat.forEach(e=>{e._checked=!e._checked})},transform(e){return{data:e.data.map(n=>{var a,i,s,l,u;const r=(a=n.latest)!=null&&a.data?JSON.parse(n.latest.data):{...n};return Object.assign(r,{id:n.id,has:n.has,parent_id:n.parent_id,deleted_at:n.deleted_at,created_at:n.created_at,updated_at:((i=n.latest)==null?void 0:i.created_at)||n.updated_at,editor:((s=n.latest)==null?void 0:s.editor)||n.editor,published:((l=n.latest)==null?void 0:l.published)??!0,publish_at:((u=n.latest)==null?void 0:u.publish_at)||null,latest:n.latest})}),currentPage:e.paginatorInfo.currentPage,lastPage:e.paginatorInfo.lastPage}},update(e,t){var n;if(typeof t!="function")throw new Error("Second paramter must be a function");t(e),(n=e.children)==null||n.forEach(r=>{t(r,t)})},url(e){return this.app.urlpage.replace(/_domain_/,e.domain||"").replace(/_path_/,e.path||"").replace(/\/+$/,"")}},watch:{filter:{deep:!0,handler(e){this.items=[],this.loading=!0,(e.view==="list"?this.search():this.fetch()).then(n=>{this.items=(n==null?void 0:n.data)||[],this.loading=!1})}},term:{handler(){this.reload(!1)}}}},Bu={class:"header"},Nu={class:"bulk"},Mu={class:"search"},ju={class:"actions"},Uu={key:0,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ru=["title"],Hu=["onClick"],qu={class:"item-head"},Ku={key:0,class:"item-lang"},Wu={class:"item-title"},Ju={key:0,class:"item-subtitle"},Qu=["href"],Yu={class:"item-domain"},Xu={class:"item-path item-subtitle"},Zu={key:0,class:"item-to item-subtitle"},Gu={key:0,class:"loading"},ec={key:1,class:"notfound"},tc={key:2,class:"btn-group"};function nc(e,t,n,r,a,i){const s=ee("Draggable");return v(),z(ue,null,[V("div",Bu,[V("div",Nu,[m(Ft,{modelValue:a.checked,"onUpdate:modelValue":t[0]||(t[0]=l=>a.checked=l),onClick:t[1]||(t[1]=Ue(l=>i.toggle(),["stop"]))},null,8,["modelValue"]),m(ct,{location:"bottom left"},{activator:p(({props:l})=>[m(T,nt({"append-icon":"mdi-menu-down",variant:"text"},l,{disabled:!i.isChecked}),{default:p(()=>[F(E(e.$gettext("Actions")),1)]),_:2},1040,["disabled"])]),default:p(()=>[m(ut,null,{default:p(()=>[i.isChecked&&r.auth.can("page:publish")?(v(),I(R,{key:0},{default:p(()=>[m(T,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=l=>i.publish())},{default:p(()=>[F(E(e.$gettext("Publish")),1)]),_:1})]),_:1})):$("",!0),i.isChecked&&r.auth.can("page:save")?(v(),I(R,{key:1},{default:p(()=>[m(T,{"prepend-icon":"mdi-eye",variant:"text",onClick:t[3]||(t[3]=l=>i.status(null,1))},{default:p(()=>[F(E(e.$gettext("Enable")),1)]),_:1})]),_:1})):$("",!0),i.isChecked&&r.auth.can("page:save")?(v(),I(R,{key:2},{default:p(()=>[m(T,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:t[4]||(t[4]=l=>i.status(null,0))},{default:p(()=>[F(E(e.$gettext("Disable")),1)]),_:1})]),_:1})):$("",!0),m(et),i.canTrash&&r.auth.can("page:drop")?(v(),I(R,{key:3},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[5]||(t[5]=l=>i.drop())},{default:p(()=>[F(E(e.$gettext("Delete")),1)]),_:1})]),_:1})):$("",!0),i.isTrashed&&r.auth.can("page:keep")?(v(),I(R,{key:4},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[6]||(t[6]=l=>i.keep())},{default:p(()=>[F(E(e.$gettext("Restore")),1)]),_:1})]),_:1})):$("",!0),i.isChecked&&r.auth.can("page:purge")?(v(),I(R,{key:5},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[7]||(t[7]=l=>i.purge())},{default:p(()=>[F(E(e.$gettext("Purge")),1)]),_:1})]),_:1})):$("",!0)]),_:1})]),_:1})]),V("div",Mu,[m(je,{modelValue:a.term,"onUpdate:modelValue":t[8]||(t[8]=l=>a.term=l),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),m(T,{onClick:t[9]||(t[9]=l=>i.reload()),title:e.$gettext("Reload page tree"),icon:"mdi-refresh",variant:"text",class:"no-rtl"},null,8,["title"])]),m(s,{ref:"tree",modelValue:a.items,"onUpdate:modelValue":t[13]||(t[13]=l=>a.items=l),onChange:t[14]||(t[14]=l=>i.change()),defaultOpen:!1,disableDrag:!r.auth.can("page:move"),rtl:e.$vuetify.locale.isRtl,watermark:!1,virtualization:""},{default:p(({node:l,stat:u})=>[V("div",ju,[u.loading?(v(),z("svg",Uu,[...t[16]||(t[16]=[V("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),V("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),V("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):(v(),I(T,{key:1,onClick:o=>i.load(u,l),class:ce({hidden:!l.has}),icon:u.open?"mdi-menu-down":"mdi-menu-right",title:e.$gettext("Toggle child nodes"),variant:"text"},null,8,["onClick","class","icon","title"])),m(Ft,{modelValue:u._checked,"onUpdate:modelValue":o=>u._checked=o,class:ce({draft:!l.published})},null,8,["modelValue","onUpdate:modelValue","class"]),l.id?(v(),I(ct,{key:2},{activator:p(({props:o})=>[m(T,nt(o,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",variant:"text"}),null,16,["title"])]),default:p(()=>[m(ut,null,{default:p(()=>[!l.deleted_at&&!l.published&&r.auth.can("page:publish")?(v(),I(R,{key:0},{default:p(()=>[m(T,{"prepend-icon":"mdi-publish",variant:"text",onClick:o=>i.publish(u)},{default:p(()=>[F(E(e.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),l.status!==0&&r.auth.can("page:save")?(v(),I(R,{key:1},{default:p(()=>[m(T,{"prepend-icon":"mdi-eye-off",variant:"text",onClick:o=>i.status(u,0)},{default:p(()=>[F(E(e.$gettext("Disable")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),l.status!==1&&r.auth.can("page:save")?(v(),I(R,{key:2},{default:p(()=>[m(T,{"prepend-icon":"mdi-eye",variant:"text",onClick:o=>i.status(u,1)},{default:p(()=>[F(E(e.$gettext("Enable")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),l.status!==2&&r.auth.can("page:save")?(v(),I(R,{key:3},{default:p(()=>[m(T,{"prepend-icon":"mdi-eye-off-outline",variant:"text",onClick:o=>i.status(u,2)},{default:p(()=>[F(E(e.$gettext("Hide")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),m(et),r.auth.can("page:move")?(v(),I(R,{key:4},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-cut",variant:"text",onClick:o=>i.cut(u,l)},{default:p(()=>[F(E(e.$gettext("Cut")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),!this.embed&&r.auth.can("page:add")?(v(),I(R,{key:5},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-copy",variant:"text",onClick:o=>i.copy(u,l)},{default:p(()=>[F(E(e.$gettext("Copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),a.clip&&a.clip.type=="copy"&&!this.embed&&r.auth.can("page:add")?(v(),I(R,{key:6},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[10]||(t[10]=Ue(o=>i.show("paste"),["stop"]))},{default:p(()=>[F(E(e.$gettext("Paste")),1)]),_:1})]),_:1})):$("",!0),a.clip&&a.clip.type=="copy"&&a.menu.paste&&!this.embed&&r.auth.can("page:add")?(v(),I(Ve,{key:7},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>i.paste(u,0),class:"subitem"},{default:p(()=>[F(E(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.clip&&a.clip.type=="copy"&&a.menu.paste&&!this.embed&&r.auth.can("page:add")?(v(),I(Ve,{key:8},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>i.paste(u),class:"subitem"},{default:p(()=>[F(E(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.clip&&a.clip.type=="copy"&&a.menu.paste&&!this.embed&&r.auth.can("page:add")?(v(),I(Ve,{key:9},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>i.paste(u,1),class:"subitem"},{default:p(()=>[F(E(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.clip&&a.clip.type=="cut"&&r.auth.can("page:move")?(v(),I(R,{key:10},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[11]||(t[11]=Ue(o=>i.show("move"),["stop"]))},{default:p(()=>[F(E(e.$gettext("Paste")),1)]),_:1})]),_:1})):$("",!0),a.clip&&a.clip.type=="cut"&&a.menu.move&&r.auth.can("page:move")?(v(),I(Ve,{key:11},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>i.move(u,0),class:"subitem"},{default:p(()=>[F(E(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.clip&&a.clip.type=="cut"&&a.menu.move&&r.auth.can("page:move")?(v(),I(Ve,{key:12},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>i.move(u),class:"subitem"},{default:p(()=>[F(E(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.clip&&a.clip.type=="cut"&&a.menu.move&&r.auth.can("page:move")?(v(),I(Ve,{key:13},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>i.move(u,1),class:"subitem"},{default:p(()=>[F(E(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),!this.embed&&r.auth.can("page:add")?(v(),I(R,{key:14},{default:p(()=>[m(T,{"prepend-icon":"mdi-content-paste",variant:"text",onClick:t[12]||(t[12]=Ue(o=>i.show("insert"),["stop"]))},{default:p(()=>[F(E(e.$gettext("Insert")),1)]),_:1})]),_:1})):$("",!0),a.menu.insert&&!this.embed&&r.auth.can("page:add")?(v(),I(Ve,{key:15},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-up",variant:"text",onClick:o=>i.insert(u,0),class:"subitem"},{default:p(()=>[F(E(e.$gettext("Before")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.menu.insert&&!this.embed&&r.auth.can("page:add")?(v(),I(Ve,{key:16},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-right",variant:"text",onClick:o=>i.insert(u),class:"subitem"},{default:p(()=>[F(E(e.$gettext("Into")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),a.menu.insert&&!this.embed&&r.auth.can("page:add")?(v(),I(Ve,{key:17},{default:p(()=>[m(R,null,{default:p(()=>[m(T,{"prepend-icon":"mdi-arrow-down",variant:"text",onClick:o=>i.insert(u,1),class:"subitem"},{default:p(()=>[F(E(e.$gettext("After")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):$("",!0),m(et),!l.deleted_at&&r.auth.can("page:drop")?(v(),I(R,{key:18},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete",variant:"text",onClick:o=>i.drop(u)},{default:p(()=>[F(E(e.$gettext("Delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),l.deleted_at&&r.auth.can("page:keep")?(v(),I(R,{key:19},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:o=>i.keep(u)},{default:p(()=>[F(E(e.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0),r.auth.can("page:purge")?(v(),I(R,{key:20},{default:p(()=>[m(T,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:o=>i.purge(u)},{default:p(()=>[F(E(e.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0)]),_:2},1024)]),_:2},1024)):$("",!0)]),V("div",{class:ce(["item-content",{"status-hidden":l.status==2,"status-enabled":l.status==1,"status-disabled":!l.status,trashed:l.deleted_at,cut:u.cut}]),title:i.title(l)},[V("div",{class:"item-text",onClick:o=>e.$emit("select",l)},[V("div",qu,[l.lang?(v(),z("span",Ku,E(l.lang),1)):$("",!0),l.publish_at?(v(),I(Be,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):$("",!0),l.status>1?(v(),I(Be,{key:2,class:"item-status",icon:"mdi-eye-off-outline"})):$("",!0),V("span",Wu,E(l.name||e.$gettext("New")),1)]),l.title?(v(),z("div",Ju,E(l.title),1)):$("",!0)],8,Hu),V("a",{class:"item-aux",href:i.url(l),target:"_blank",draggable:"false"},[V("div",Yu,E(l.domain),1),V("span",Xu,E(i.url(l)),1),l.to?(v(),z("span",Zu," ➔ "+E(l.to),1)):$("",!0)],8,Qu)],10,Ru)]),_:1},8,["modelValue","disableDrag","rtl"]),a.loading?(v(),z("p",Gu,[F(E(e.$gettext("Loading"))+" ",1),t[17]||(t[17]=V("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},[V("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),V("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),V("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):$("",!0),!a.loading&&!a.items.length?(v(),z("p",ec,E(e.$gettext("No entries found")),1)):$("",!0),!a.loading&&!a.items.length&&!this.embed&&this.auth.can("page:add")?(v(),z("div",tc,[m(T,{onClick:t[15]||(t[15]=l=>i.add()),title:e.$gettext("Add page"),icon:"mdi-folder-plus",color:"primary",variant:"flat"},null,8,["title"])])):$("",!0)],64)}const rc=we(zu,[["render",nc]]),ic={components:{PageListItems:rc,PageDetail:ir,Navigation:xi,AsideList:bi,User:ki},inject:["locales","openView"],data:()=>({chat:"",response:"",help:!1,shortmsg:!0,synthesizing:!1,filter:{view:"tree",trashed:"WITHOUT",publish:null,status:null,editor:null,cache:null,lang:null}}),setup(){const e=rt(),t=kn();return{auth:Ke(),drawer:t,messages:e}},computed:{message(){if(!this.response)return this.chat;const e=this.response.indexOf(`
---
`);return this.shortmsg?this.$pgettext("ai",this.response.slice(0,e)):this.response.substring(e>0?e+5:0)}},methods:{languages(){const e=[{title:this.$gettext("All"),icon:"mdi-playlist-check",value:{lang:null}}];for(const t of this.locales())e.push({title:t.title,icon:"mdi-translate",value:{lang:t.value}});return e},open(e){this.openView(ir,{item:e})},same(e,t){if(!e||!t)return!1;const n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every(a=>e[a]===t[a])},synthesize(){const e=this.chat.trim();this.chat&&(this.synthesizing=!0,this.$apollo.mutate({mutation:le`mutation($prompt: String!) {
            synthesize(prompt: $prompt)
          }`,variables:{prompt:e}}).then(t=>{var r,a;if(t.errors)throw t;this.response=((r=t.data)==null?void 0:r.synthesize)||"",this.chat=this.message;const n={view:"list",publish:"DRAFT",trashed:"WITHOUT",editor:(a=this.auth.me)==null?void 0:a.email,cache:null,lang:null,status:0};this.same(n,this.filter)?this.$refs.pagelist.reload():this.filter=n,this.synthesizing=null}).catch(t=>{this.messages.add(this.$gettext("Error synthesizing content")+`:
`+t,"error"),this.$log("PageDetailContentList::synthesize(): Error synthesizing content",t)}).finally(()=>{setTimeout(()=>{this.synthesizing=!1},3e3)}))}}},ac={key:0,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},sc={key:1,class:"spinner",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},lc={key:2,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},oc={key:0,class:"help"};function uc(e,t,n,r,a,i){var c;const s=ee("User"),l=ee("Navigation"),u=ee("PageListItems"),o=ee("AsideList");return v(),z(ue,null,[m(yr,{elevation:0,density:"compact"},{prepend:p(()=>[m(T,{onClick:t[0]||(t[0]=h=>r.drawer.toggle("nav")),title:r.drawer.nav?e.$gettext("Close navigation"):e.$gettext("Open navigation"),icon:r.drawer.nav?"mdi-close":"mdi-menu"},null,8,["title","icon"])]),append:p(()=>[m(s),m(T,{onClick:t[1]||(t[1]=h=>r.drawer.toggle("aside")),title:e.$gettext("Toggle side menu"),icon:r.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:p(()=>[m(kr,null,{default:p(()=>[F(E(e.$gettext("Pages")),1)]),_:1})]),_:1}),m(l),m(vr,{class:"page-list"},{default:p(()=>[m(dt,null,{default:p(()=>[m(ht,{class:"box scroll"},{default:p(()=>[m(gr,{modelValue:e.chat,"onUpdate:modelValue":t[5]||(t[5]=h=>e.chat=h),loading:e.synthesizing,placeholder:e.$gettext("Describe the page and content you want to create"),onDblclick:t[6]||(t[6]=h=>{e.shortmsg=!e.shortmsg,e.chat=i.message}),variant:"outlined",class:"prompt",rounded:"lg","hide-details":"",autofocus:"","auto-grow":"",clearable:"",outlined:"",rows:"1"},{prepend:p(()=>[m(Be,{onClick:t[2]||(t[2]=h=>e.help=!e.help)},{default:p(()=>[...t[9]||(t[9]=[V("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24"},[V("path",{d:"M15.07,11.25L14.17,12.17C13.45,12.89 13,13.5 13,15H11V14.5C11,13.39 11.45,12.39 12.17,11.67L13.41,10.41C13.78,10.05 14,9.55 14,9C14,7.89 13.1,7 12,7A2,2 0 0,0 10,9H8A4,4 0 0,1 12,5A4,4 0 0,1 16,9C16,9.88 15.64,10.67 15.07,11.25M13,19H11V17H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2Z"})],-1)])]),_:1})]),append:p(()=>[m(Be,{onClick:t[3]||(t[3]=h=>e.synthesizing||i.synthesize()),onKeydown:t[4]||(t[4]=mr(h=>e.synthesizing||i.synthesize(),["enter"])),title:e.synthesizing?e.$gettext("Generating ..."):e.$gettext("Generate page based on prompt")},{default:p(()=>[e.synthesizing===!1?(v(),z("svg",ac,[...t[10]||(t[10]=[V("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M6,13H14L10.5,16.5L11.92,17.92L17.84,12L11.92,6.08L10.5,7.5L14,11H6V13Z"},null,-1)])])):$("",!0),e.synthesizing===!0?(v(),z("svg",sc,[...t[11]||(t[11]=[V("circle",{class:"spin1",cx:"4",cy:"12",r:"3"},null,-1),V("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"},null,-1),V("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"},null,-1)])])):$("",!0),e.synthesizing===null?(v(),z("svg",lc,[...t[12]||(t[12]=[V("path",{d:"M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"},null,-1)])])):$("",!0)]),_:1},8,["title"])]),_:1},8,["modelValue","loading","placeholder"]),e.help?(v(),z("div",oc,[V("ul",null,[V("li",null,E(e.$gettext("AI can create a page and content based on your input and add it to the page tree")),1),V("li",null,E(e.$gettext("Double click on the response in the input field to display full response")),1)])])):$("",!0),m(u,{ref:"pagelist",onSelect:t[7]||(t[7]=h=>i.open(h)),filter:e.filter},null,8,["filter"])]),_:1})]),_:1})]),_:1}),m(o,{filter:e.filter,"onUpdate:filter":t[8]||(t[8]=h=>e.filter=h),content:[{key:"view",title:e.$gettext("view"),items:[{title:e.$gettext("Tree"),icon:"mdi-file-tree",value:{view:"tree"}},{title:e.$gettext("List"),icon:"mdi-format-list-bulleted-square",value:{view:"list"}}]},{key:"publish",title:e.$gettext("publish"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{publish:null}},{title:e.$gettext("Published"),icon:"mdi-publish",value:{publish:"PUBLISHED"}},{title:e.$gettext("Scheduled"),icon:"mdi-clock-outline",value:{publish:"SCHEDULED"}},{title:e.$gettext("Drafts"),icon:"mdi-pencil",value:{publish:"DRAFT"}}]},{key:"trashed",title:e.$gettext("trashed"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{trashed:"WITH"}},{title:e.$gettext("Available only"),icon:"mdi-delete-off",value:{trashed:"WITHOUT"}},{title:e.$gettext("Only trashed"),icon:"mdi-delete",value:{trashed:"ONLY"}}]},{key:"status",title:e.$gettext("status"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{status:null}},{title:e.$gettext("Enabled"),icon:"mdi-eye",value:{status:1}},{title:e.$gettext("Hidden"),icon:"mdi-eye-off-outline",value:{status:2}},{title:e.$gettext("Disabled"),icon:"mdi-eye-off",value:{status:0}}]},{key:"cache",title:e.$gettext("cache"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{cache:null}},{title:e.$gettext("No cache"),icon:"mdi-clock-alert-outline",value:{cache:0}}]},{key:"editor",title:e.$gettext("editor"),items:[{title:e.$gettext("All"),icon:"mdi-playlist-check",value:{editor:null}},{title:e.$gettext("Edited by me"),icon:"mdi-account",value:{editor:(c=this.auth.me)==null?void 0:c.email}}]},{key:"lang",title:e.$gettext("languages"),items:i.languages()}]},null,8,["filter","content"])],64)}const mc=we(ic,[["render",uc],["__scopeId","data-v-6c4e6f34"]]);export{mc as default};
