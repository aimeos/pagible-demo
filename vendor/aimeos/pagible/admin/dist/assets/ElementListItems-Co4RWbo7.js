import{_ as D,a5 as N,c as k,a4 as y,F as x,o as u,n as T,b,d as _,w as l,l as p,t as h,a as i,h as w,i as I,j as g,k as c,m as S,af as U,ag as j,b7 as B,a9 as q,bj as M,aa as J,bk as R,a7 as A,f,L as $,a2 as H,aJ as W,aL as F,I as z,aM as Q,a6 as Y,T as G,r as K,aN as V,aO as E,aC as X,a8 as Z}from"./index-zamkCzJL.js";import"./utils-B-NTB7yu.js";const ee={props:{data:{type:Object,default:()=>{}},files:{type:Array,default:()=>[]},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1},fields:{type:Object,required:!0},type:{type:String,default:""}},emits:["change","error","update:files"],inject:["compose","translate","txlocales"],data(){return{translating:{},composing:{},errors:{}}},setup(){return{messages:N()}},methods:{addFile(e){if(!(e!=null&&e.id)){this.$log("Fields::addFile(): Invalid item without ID",e);return}const t=[...this.files];t.push(e.id),this.assets[e.id]=e,this.$emit("update:files",t)},composeText(e){const t=['generate for field "'+(this.fields[e].label||e)+'"','required output format is "'+this.fields[e].type+'"',this.fields[e].min?"minimum characters: "+this.fields[e].min:null,this.fields[e].max?"maximum characters: "+this.fields[e].max:null,this.fields[e].placeholder?"hint text: "+this.fields[e].placeholder:null,"context information as JSON: "+JSON.stringify(this.data)];this.composing[e]=!0,this.compose(this.data[e]||"Create suitable text based on the context",t).then(s=>{this.update(e,s)}).finally(()=>{this.composing[e]=!1})},error(e,t){this.errors[e]=t,this.$emit("error",Object.values(this.errors).includes(!0))},removeFile(e){if(!e){this.$log("Fields::removeFile(): Invalid ID",e);return}const t=[...this.files],s=t.findIndex(o=>o===e);s!==-1&&t.splice(s,1),this.$emit("update:files",t)},toName(e){var t;return((t=e==null?void 0:e.charAt(0))==null?void 0:t.toUpperCase())+(e==null?void 0:e.slice(1))},translateText(e,t){this.translating[e]=!0,this.translate([this.data[e]],t).then(s=>{this.update(e,s[0]||"")}).finally(()=>{this.translating[e]=!1})},update(e,t){this.data[e]=t,this.$emit("change",this.data[e])},validate(){var t;const e=[];return this.errors={},(t=this.$refs.field)==null||t.forEach(s=>{e.push(s.validate())}),Promise.all(e).then(s=>s.every(o=>o))}}},te={key:0,class:"actions"};function se(e,t,s,o,r,n){return u(!0),k(x,null,y(s.fields,(d,a)=>(u(),k("div",{key:a,class:T(["item",{error:r.errors[a]}])},[d.type!=="hidden"?(u(),b(U,{key:0},{default:l(()=>[p(h(e.$pgettext("fn",d.label||a).replace(/-|_/g," "))+" ",1),!s.readonly&&["markdown","plaintext","string","text"].includes(d.type)?(u(),k("div",te,[i(w,null,{activator:l(({props:m})=>[i(c,S({ref_for:!0},m,{title:e.$gettext("Translate %{code} field",{code:a}),loading:r.translating[a],icon:"mdi-translate",variant:"text",elevation:"0"}),null,16,["title","loading"])]),default:l(()=>[i(I,null,{default:l(()=>[(u(!0),k(x,null,y(n.txlocales(),m=>(u(),b(g,{key:m.code},{default:l(()=>[i(c,{onClick:v=>n.translateText(a,m.code),"prepend-icon":"mdi-arrow-right-thin",variant:"text"},{default:l(()=>[p(h(m.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),i(c,{title:e.$gettext("Generate text for %{code} field",{code:a}),loading:r.composing[a],onClick:m=>n.composeText(a),icon:"mdi-creation",variant:"text",elevation:"0"},null,8,["title","loading","onClick"])])):_("",!0)]),_:2},1024)):_("",!0),(u(),b(j(n.toName(d.type)),{ref_for:!0,ref:"field",key:d.type+"-"+a,context:s.data,assets:s.assets,config:d,readonly:s.readonly,modelValue:s.data[a],onAddFile:t[0]||(t[0]=m=>n.addFile(m)),onRemoveFile:t[1]||(t[1]=m=>n.removeFile(m)),"onUpdate:modelValue":m=>n.update(a,m),onError:m=>n.error(a,m)},null,40,["context","assets","config","readonly","modelValue","onUpdate:modelValue","onError"]))],2))),128)}const we=D(ee,[["render",se],["__scopeId","data-v-038f676d"]]),ae={props:{type:{type:String,required:!0}},emits:["add"],data:()=>({tab:["basic"]}),setup(){return{schemas:B()}},computed:{groups(){const e={};for(const t in this.schemas[this.type]||{}){const s=this.schemas[this.type][t],o=s.group||this.$gettext("uncategorized");s.type=t,e[o]=e[o]||[],e[o].push(s)}return e}},methods:{add(e){this.$emit("add",{type:e.type})}}},le=["innerHTML"];function ie(e,t,s,o,r,n){return u(),k(x,null,[i(q,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=d=>e.tab=d)},{default:l(()=>[(u(!0),k(x,null,y(n.groups,(d,a)=>(u(),b(J,{key:a,value:a},{default:l(()=>[p(h(e.$pgettext("sg",a)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),i(M,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=d=>e.tab=d)},{default:l(()=>[(u(!0),k(x,null,y(Object.keys(n.groups),d=>(u(),b(R,{key:d,value:d},{default:l(()=>[i(A,null,{default:l(()=>[(u(!0),k(x,null,y(n.groups[d],a=>(u(),b(c,{key:a.type,onClick:m=>n.add(a),variant:"text",stacked:""},{prepend:l(()=>[f("span",{class:"icon",innerHTML:a.icon},null,8,le)]),default:l(()=>[p(" "+h(e.$pgettext("st",a.label||a.type)),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],64)}const re=D(ae,[["render",ie],["__scopeId","data-v-afaa5a81"]]),ne={components:{SchemaItems:re},props:{embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,vschemas:!1,checked:!1,loading:!0,trash:!1}},setup(){const e=N();return{auth:H(),messages:e}},created(){this.search(),this.searchd=this.debounce(this.search,500)},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)}},methods:{add(e){if(this.embed||!this.auth.can("element:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}return this.$apollo.mutate({mutation:$`mutation($input: ElementInput!) {
            addElement(input: $input) {
              id
              lang
              name
              type
              data
              editor
              created_at
              updated_at
              deleted_at
            }
          }`,variables:{input:{type:e.type,name:this.$gettext("New shared element"),data:"{}"}}}).then(t=>{var o;if(t.errors)throw t.errors;const s=((o=t.data)==null?void 0:o.addElement)||{};return s.data=JSON.parse(s.data)||{},s.published=!0,this.vschemas=!1,this.items.unshift(s),this.$emit("select",s),this.invalidate(),s}).catch(t=>{this.$log("ElementListItems::add(): Error adding shared element",t)})},drop(e){if(!this.auth.can("element:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:$`
            mutation($id: [ID!]!) {
              dropElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error trashing shared element")+`:
`+s,"error"),this.$log("ElementListItems::drop(): Error trashing shared element",t,s)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"elements"}),e.gc()},keep(e){if(!this.auth.can("element:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:$`
            mutation($id: [ID!]!) {
              keepElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(o=>{o.deleted_at=null}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error restoring shared element")+`:
`+s,"error"),this.$log("ElementListItems::keep(): Error restoring shared element",t,s)})},publish(e){if(!this.auth.can("element:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked&&s.id&&!s.published);t.length&&this.$apollo.mutate({mutation:$`mutation ($id: [ID!]!) {
            pubElement(id: $id) {
              id
            }
          }`,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;t.forEach(o=>{o.published=!0,o._checked=!1}),this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error publishing shared element")+`:
`+s,"error"),this.$log("ElementListItems::publish(): Error publishing shared element",t,s)})},purge(e){if(!this.auth.can("element:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(s=>s._checked);t.length&&this.$apollo.mutate({mutation:$`
            mutation($id: [ID!]!) {
              purgeElement(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(s=>s.id)}}).then(s=>{if(s.errors)throw s.errors;this.invalidate(),this.search()}).catch(s=>{this.messages.add(this.$gettext("Error purging shared element")+`:
`+s,"error"),this.$log("ElementListItems::purge(): Error purging shared element",t,s)})},search(){if(!this.auth.can("element:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",s={...this.filter};return delete s.publish,delete s.trashed,this.term&&(s.any=this.term),this.loading=!0,this.$apollo.query({query:$`
            query($filter: ElementFilter, $sort: [QueryElementsSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              elements(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  type
                  data
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:s,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(o=>{var n;if(o.errors)throw o.errors;const r=o.data.elements||{};return this.last=((n=r.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...r.data||[]].map(d=>{var m,v,C,L,P,O;const a=(m=d.latest)!=null&&m.data?JSON.parse((v=d.latest)==null?void 0:v.data):{...d,data:JSON.parse(d.data||"{}")};return Object.assign(a,{id:d.id,deleted_at:d.deleted_at,created_at:d.created_at,updated_at:((C=d.latest)==null?void 0:C.created_at)||d.updated_at,editor:((L=d.latest)==null?void 0:L.editor)||d.editor,published:((P=d.latest)==null?void 0:P.published)??!0,publish_at:((O=d.latest)==null?void 0:O.publish_at)||null,latest:d.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(o=>{this.messages.add(this.$gettext("Error fetching shared elements")+`:
`+o,"error"),this.$log("ElementListItems::search(): Error fetching shared element",o)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},de={class:"header"},oe={class:"bulk"},ue={class:"search"},he={class:"layout"},me={class:"actions"},ce=["onClick","title"],pe={class:"item-text"},fe={class:"item-head"},ge={key:0,class:"item-lang"},ve={class:"item-title"},be={class:"item-type item-subtitle"},ke={class:"item-aux"},_e={class:"item-editor"},xe={class:"item-modified item-subtitle"},$e={key:0,class:"loading"},ye={key:1,class:"notfound"},Ce={key:3,class:"btn-group"};function Ve(e,t,s,o,r,n){const d=K("SchemaItems");return u(),k(x,null,[f("div",de,[f("div",oe,[i(F,{modelValue:r.checked,"onUpdate:modelValue":t[0]||(t[0]=a=>r.checked=a),onClick:t[1]||(t[1]=W(a=>n.toggle(),["stop"]))},null,8,["modelValue"]),i(w,{location:"bottom left"},{activator:l(({props:a})=>[i(c,S(a,{disabled:!n.isChecked,"append-icon":"mdi-menu-down",variant:"text"}),{default:l(()=>[p(h(e.$gettext("Actions")),1)]),_:2},1040,["disabled"])]),default:l(()=>[i(I,null,{default:l(()=>[V(i(g,null,{default:l(()=>[i(c,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=a=>n.publish())},{default:l(()=>[p(h(e.$gettext("Publish")),1)]),_:1})]),_:1},512),[[E,n.isChecked&&o.auth.can("element:publish")]]),!this.embed&&o.auth.can("element:add")?(u(),b(g,{key:0},{default:l(()=>[i(c,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=a=>r.vschemas=!0)},{default:l(()=>[p(h(e.$gettext("Add element")),1)]),_:1})]),_:1})):_("",!0),V(i(g,null,{default:l(()=>[i(c,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=a=>n.drop())},{default:l(()=>[p(h(e.$gettext("Delete")),1)]),_:1})]),_:1},512),[[E,n.canTrash&&o.auth.can("element:drop")]]),V(i(g,null,{default:l(()=>[i(c,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=a=>n.keep())},{default:l(()=>[p(h(e.$gettext("Restore")),1)]),_:1})]),_:1},512),[[E,n.isTrashed&&o.auth.can("element:keep")]]),V(i(g,null,{default:l(()=>[i(c,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=a=>n.purge())},{default:l(()=>[p(h(e.$gettext("Purge")),1)]),_:1})]),_:1},512),[[E,n.isChecked&&o.auth.can("element:purge")]])]),_:1})]),_:1})]),f("div",ue,[i(z,{modelValue:r.term,"onUpdate:modelValue":t[7]||(t[7]=a=>r.term=a),"prepend-inner-icon":"mdi-magnify",variant:"underlined",label:e.$gettext("Search for"),"hide-details":"",clearable:""},null,8,["modelValue","label"])]),f("div",he,[i(w,{location:"bottom right"},{activator:l(({props:a})=>[i(c,S(a,{title:e.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:l(()=>{var m,v,C;return[p(h(((m=r.sort)==null?void 0:m.column)==="ID"?((v=r.sort)==null?void 0:v.order)==="DESC"?e.$gettext("latest"):e.$gettext("oldest"):((C=r.sort)==null?void 0:C.column)||""),1)]}),_:2},1040,["title"])]),default:l(()=>[i(I,null,{default:l(()=>[i(g,null,{default:l(()=>[i(c,{variant:"text",onClick:t[8]||(t[8]=a=>r.sort={column:"ID",order:"DESC"})},{default:l(()=>[p(h(e.$gettext("latest")),1)]),_:1})]),_:1}),i(g,null,{default:l(()=>[i(c,{variant:"text",onClick:t[9]||(t[9]=a=>r.sort={column:"ID",order:"ASC"})},{default:l(()=>[p(h(e.$gettext("oldest")),1)]),_:1})]),_:1}),i(g,null,{default:l(()=>[i(c,{variant:"text",onClick:t[10]||(t[10]=a=>r.sort={column:"NAME",order:"ASC"})},{default:l(()=>[p(h(e.$gettext("name")),1)]),_:1})]),_:1}),i(g,null,{default:l(()=>[i(c,{variant:"text",onClick:t[11]||(t[11]=a=>r.sort={column:"TYPE",order:"ASC"})},{default:l(()=>[p(h(e.$gettext("type")),1)]),_:1})]),_:1}),i(g,null,{default:l(()=>[i(c,{variant:"text",onClick:t[12]||(t[12]=a=>r.sort={column:"EDITOR",order:"ASC"})},{default:l(()=>[p(h(e.$gettext("editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),i(I,{class:"items"},{default:l(()=>[(u(!0),k(x,null,y(r.items,(a,m)=>(u(),b(g,{key:m},{default:l(()=>[f("div",me,[i(F,{modelValue:a._checked,"onUpdate:modelValue":v=>a._checked=v,class:T([{draft:!a.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),i(w,null,{activator:l(({props:v})=>[i(c,S({ref_for:!0},v,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text",elevation:"0"}),null,16,["title"])]),default:l(()=>[i(I,null,{default:l(()=>[V(i(g,null,{default:l(()=>[i(c,{"prepend-icon":"mdi-publish",variant:"text",onClick:v=>n.publish(a)},{default:l(()=>[p(h(e.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1536),[[E,!a.deleted_at&&!a.published&&this.auth.can("element:publish")]]),!a.deleted_at&&this.auth.can("element:drop")?(u(),b(g,{key:0},{default:l(()=>[i(c,{"prepend-icon":"mdi-delete",variant:"text",onClick:v=>n.drop(a)},{default:l(()=>[p(h(e.$gettext("Delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):_("",!0),a.deleted_at&&this.auth.can("element:keep")?(u(),b(g,{key:1},{default:l(()=>[i(c,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:v=>n.keep(a)},{default:l(()=>[p(h(e.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):_("",!0),this.auth.can("element:purge")?(u(),b(g,{key:2},{default:l(()=>[i(c,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:v=>n.purge(a)},{default:l(()=>[p(h(e.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024)]),f("div",{class:T(["item-content",{trashed:a.deleted_at}]),onClick:v=>e.$emit("select",a),title:n.title(a)},[f("div",pe,[f("div",fe,[a.lang?(u(),k("span",ge,h(a.lang),1)):_("",!0),a.publish_at?(u(),b(X,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):_("",!0),f("span",ve,h(a.name),1)]),f("div",be,h(a.type),1)]),f("div",ke,[f("div",_e,h(a.editor),1),f("div",xe,h(new Date(a.updated_at).toLocaleString()),1)])],10,ce)]),_:2},1024))),128))]),_:1}),r.loading?(u(),k("p",$e,[p(h(e.$gettext("Loading"))+" ",1),t[18]||(t[18]=f("svg",{class:"spinner",width:"32",height:"32",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[f("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),f("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),f("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):_("",!0),!r.loading&&!r.items.length?(u(),k("p",ye,h(e.$gettext("No entries found")),1)):_("",!0),r.last>1?(u(),b(Q,{key:2,modelValue:r.page,"onUpdate:modelValue":t[13]||(t[13]=a=>r.page=a),length:r.last},null,8,["modelValue","length"])):_("",!0),!this.embed&&this.auth.can("element:add")?(u(),k("div",Ce,[i(c,{onClick:t[14]||(t[14]=a=>r.vschemas=!0),title:e.$gettext("Add element"),icon:"mdi-view-grid-plus",color:"primary",variant:"flat"},null,8,["title"])])):_("",!0),(u(),b(G,{to:"body"},[i(Y,{modelValue:r.vschemas,"onUpdate:modelValue":t[16]||(t[16]=a=>r.vschemas=a),onAfterLeave:t[17]||(t[17]=a=>r.vschemas=!1),scrollable:"",width:"auto"},{default:l(()=>[i(A,null,{default:l(()=>[i(Z,null,{default:l(()=>[i(d,{type:"content",onAdd:t[15]||(t[15]=a=>n.add(a))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))],64)}const Se=D(ne,[["render",Ve],["__scopeId","data-v-ea6ab324"]]);export{Se as E,we as F,re as S};
