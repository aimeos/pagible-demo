import{_ as n,K as s,b as u,L as c,o as d}from"../index.js";const h={props:{modelValue:{type:[Object,String,Number,Boolean,null],default:null},config:{type:Object,default:()=>{}},assets:{type:Object,default:()=>{}},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","error"],inject:["debounce"],data(){return{list:this.config.options||[],loading:!1}},created(){this.graphql=this.debounce(this.graphql,500),this.rest=this.debounce(this.rest,500)},methods:{graphql(e){var t;if(!((t=this.config)!=null&&t.query))return;const i=this.config.query.replace(/_term_/g,e?JSON.stringify(e):'""');this.loading=!0,this.$apollo.query({query:s`${i}`}).then(l=>{this.list=this.items(this.toList(l.data)),this.loading=!1}).catch(l=>{this.$log("Autocomplete::graphql(): Error fetching data",e,l)})},items(e){if(!e)return[];const i=this.config["item-title"],t=this.config["item-value"];return e.map(l=>typeof l=="object"&&l!==null?i?{label:l[i]??"",value:l[t]??""}:l[t]??"":l)},rest(e){var i;(i=this.config)!=null&&i.url&&(this.loading=!0,fetch(this.config.url.replace(/_term_/g,e||""),{mode:"cors"}).then(t=>{if(!t.ok)throw t;return t.json()}).then(t=>{this.list=this.items(this.toList(t)),this.loading=!1}).catch(t=>{this.$log("Autocomplete::rest(): Error fetching data",e,t)}))},search(e){var i;switch((i=this.config)==null?void 0:i["api-type"]){case"GQL":this.graphql(e);break;case"REST":this.rest(e);break}},toList(e){return this.config["list-key"]?this.config["list-key"].split("/").reduce((i,t)=>typeof i=="object"&&i!==null?i[t]:i,e):e},update(e){this.$emit("update:modelValue",e),this.validate()},async validate(){var i;await this.$nextTick();const e=await((i=this.$refs.field)==null?void 0:i.validate());return this.$emit("error",(e==null?void 0:e.length)>0),!(e!=null&&e.length)}},watch:{modelValue:{immediate:!0,handler(e){this.validate()}}}};function f(e,i,t,l,o,r){return d(),u(c,{ref:"field",rules:[a=>!t.config.required||!!a||e.$gettext("Value is required")],loading:o.loading,readonly:t.readonly,clearable:!t.readonly,items:o.list,"no-data-text":t.config["empty-text"]||e.$gettext("No data available"),placeholder:t.config.placeholder||"","return-object":!!t.config["item-title"],multiple:t.config.multiple,chips:t.config.multiple,modelValue:t.modelValue,"onUpdate:modelValue":i[0]||(i[0]=a=>r.update(a)),"onUpdate:search":i[1]||(i[1]=a=>r.search(a)),density:"comfortable","hide-details":"auto",variant:"outlined","item-title":"label","item-value":"value"},null,8,["rules","loading","readonly","clearable","items","no-data-text","placeholder","return-object","multiple","chips","modelValue"])}const m=n(h,[["render",f]]);export{m as default};
