import{_ as Rt,K as z,a1 as _t,b as T,w as f,ay as Ve,o as b,a as c,az as Re,ac as ai,d as O,ad as Ut,ae as Wt,l as x,t as g,af as zt,aA as Ht,f as v,c as $,F as q,a3 as et,aB as ri,a4 as se,aC as si,a2 as _e,V as Ot,e as gt,G as Pe,am as ni,h as w,j as Dt,aa as xt,ab as I,I as Ct,H as Le,ag as me,a8 as Xt,a9 as It,aD as jt,aE as At,$ as ge,aF as oi,aG as li,aH as hi,r as $t,T as di,aI as ui,n as ht,Y as ci,aJ as fi,i as qt,aK as pi,aL as ve,aM as mi,aN as gi,aO as vi,a0 as bi}from"../index.js";import{u as wi,H as yi,A as xi}from"./utils-25EARmsx.js";const Di={props:{item:{type:Object,required:!0}},emits:[],data:()=>({panel:[0,1,2],versions:{},file:{}}),setup(){return{auth:_t()}},watch:{item:{immediate:!0,handler(e){!e.id||!this.auth.can("file:view")||this.$apollo.query({query:z`query ($id: ID!) {
              file(id: $id) {
                id
                bypages {
                  id
                  path
                  name
                }
                byelements {
                  id
                  type
                  name
                }
                byversions {
                  id
                  versionable_id
                  versionable_type
                  published
                  publish_at
                }
              }
            }`,variables:{id:e.id}}).then(t=>{var i,a,s;if(t.errors)throw t.errors;this.file=((i=t.data)==null?void 0:i.file)||{},this.versions=(((s=(a=t.data)==null?void 0:a.file)==null?void 0:s.byversions)||[]).map(r=>({id:r.versionable_id,type:r.versionable_type.split("\\").at(-1),published:r.published?this.$gettext("yes"):r.publish_at?new Date(r.publish_at).toLocaleDateString():this.$gettext("no")})).filter(r=>this.auth.can(r.type.toLowerCase()+":view"))}).catch(t=>{this.$log("FileDetailRef::watch(item): Error fetching file",e,t)})}}}};function Ci(e,t,i,a,s,r){return b(),T(Ve,null,{default:f(()=>[c(Re,{class:"scroll"},{default:f(()=>[c(ai,{modelValue:e.panel,"onUpdate:modelValue":t[0]||(t[0]=n=>e.panel=n),elevation:"0",multiple:""},{default:f(()=>{var n,o,h;return[(n=e.file.bypages)!=null&&n.length&&a.auth.can("page:view")?(b(),T(Ut,{key:0},{default:f(()=>[c(Wt,null,{default:f(()=>[x(g(e.$gettext("Pages")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Ht,{density:"comfortable",hover:""},{default:f(()=>[v("thead",null,[v("tr",null,[v("th",null,g(e.$gettext("ID")),1),v("th",null,g(e.$gettext("URL")),1),v("th",null,g(e.$gettext("Name")),1)])]),v("tbody",null,[(b(!0),$(q,null,et(e.file.bypages,u=>(b(),$("tr",{key:u.id},[v("td",null,g(u.id),1),v("td",null,g(u.path),1),v("td",null,g(u.name),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0),(o=e.file.byelements)!=null&&o.length&&a.auth.can("element:view")?(b(),T(Ut,{key:1},{default:f(()=>[c(Wt,null,{default:f(()=>[x(g(e.$gettext("Elements")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Ht,{density:"comfortable",hover:""},{default:f(()=>[v("thead",null,[v("tr",null,[v("th",null,g(e.$gettext("ID")),1),v("th",null,g(e.$gettext("Type")),1),v("th",null,g(e.$gettext("Name")),1)])]),v("tbody",null,[(b(!0),$(q,null,et(e.file.byelements,u=>(b(),$("tr",{key:u.id},[v("td",null,g(u.id),1),v("td",null,g(u.type),1),v("td",null,g(u.name),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0),(h=e.versions)!=null&&h.length?(b(),T(Ut,{key:2},{default:f(()=>[c(Wt,null,{default:f(()=>[x(g(e.$gettext("Versions")),1)]),_:1}),c(zt,null,{default:f(()=>[c(Ht,{density:"comfortable",hover:""},{default:f(()=>[v("thead",null,[v("tr",null,[v("th",null,g(e.$gettext("ID")),1),v("th",null,g(e.$gettext("Type")),1),v("th",null,g(e.$gettext("Published")),1)])]),v("tbody",null,[(b(!0),$(q,null,et(e.versions,u=>(b(),$("tr",{key:u.id},[v("td",null,g(u.id),1),v("td",null,g(u.type),1),v("td",null,g(u.published),1)]))),128))])]),_:1})]),_:1})]),_:1})):O("",!0)]}),_:1},8,["modelValue"])]),_:1})]),_:1})}const Ei=Rt(Di,[["render",Ci],["__scopeId","data-v-1340c7d2"]]);/*!
 * Cropper.js v1.6.2
 * https://fengyuanchen.github.io/cropperjs
 *
 * Copyright 2015-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2024-04-21T07:43:05.335Z
 */function be(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,a)}return i}function Be(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?be(Object(i),!0).forEach(function(a){Oi(e,a,i[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(i,a))})}return e}function ki(e,t){if(typeof e!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var a=i.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Ue(e){var t=ki(e,"string");return typeof t=="symbol"?t:t+""}function Gt(e){"@babel/helpers - typeof";return Gt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gt(e)}function Ti(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function we(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Ue(a.key),a)}}function Mi(e,t,i){return t&&we(e.prototype,t),i&&we(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Oi(e,t,i){return t=Ue(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function We(e){return $i(e)||Ni(e)||Si(e)||Ii()}function $i(e){if(Array.isArray(e))return Jt(e)}function Ni(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Si(e,t){if(e){if(typeof e=="string")return Jt(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Jt(e,t)}}function Jt(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function Ii(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Pt=typeof window<"u"&&typeof window.document<"u",J=Pt?window:{},ne=Pt&&J.document.documentElement?"ontouchstart"in J.document.documentElement:!1,oe=Pt?"PointerEvent"in J:!1,N="cropper",le="all",ze="crop",He="move",Ye="zoom",ot="e",lt="w",ut="s",tt="n",vt="ne",bt="nw",wt="se",yt="sw",Kt="".concat(N,"-crop"),ye="".concat(N,"-disabled"),W="".concat(N,"-hidden"),xe="".concat(N,"-hide"),Ai="".concat(N,"-invisible"),Vt="".concat(N,"-modal"),Qt="".concat(N,"-move"),kt="".concat(N,"Action"),Nt="".concat(N,"Preview"),he="crop",Fe="move",Xe="none",Zt="crop",te="cropend",ee="cropmove",ie="cropstart",De="dblclick",Vi=ne?"touchstart":"mousedown",Ri=ne?"touchmove":"mousemove",_i=ne?"touchend touchcancel":"mouseup",Ce=oe?"pointerdown":Vi,Ee=oe?"pointermove":Ri,ke=oe?"pointerup pointercancel":_i,Te="ready",Me="resize",Oe="wheel",ae="zoom",$e="image/jpeg",Pi=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,Li=/^data:/,Bi=/^data:image\/jpeg;base64,/,Ui=/^img|canvas$/i,je=200,qe=100,Ne={viewMode:0,dragMode:he,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:je,minContainerHeight:qe,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Wi='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',zi=Number.isNaN||J.isNaN;function C(e){return typeof e=="number"&&!zi(e)}var Se=function(t){return t>0&&t<1/0};function Yt(e){return typeof e>"u"}function dt(e){return Gt(e)==="object"&&e!==null}var Hi=Object.prototype.hasOwnProperty;function ct(e){if(!dt(e))return!1;try{var t=e.constructor,i=t.prototype;return t&&i&&Hi.call(i,"isPrototypeOf")}catch{return!1}}function U(e){return typeof e=="function"}var Yi=Array.prototype.slice;function Ge(e){return Array.from?Array.from(e):Yi.call(e)}function V(e,t){return e&&U(t)&&(Array.isArray(e)||C(e.length)?Ge(e).forEach(function(i,a){t.call(e,i,a,e)}):dt(e)&&Object.keys(e).forEach(function(i){t.call(e,e[i],i,e)})),e}var S=Object.assign||function(t){for(var i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];return dt(t)&&a.length>0&&a.forEach(function(r){dt(r)&&Object.keys(r).forEach(function(n){t[n]=r[n]})}),t},Fi=/\.\d*(?:0|9){12}\d*$/;function pt(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Fi.test(e)?Math.round(e*t)/t:e}var Xi=/^width|height|left|top|marginLeft|marginTop$/;function it(e,t){var i=e.style;V(t,function(a,s){Xi.test(s)&&C(a)&&(a="".concat(a,"px")),i[s]=a})}function ji(e,t){return e.classList?e.classList.contains(t):e.className.indexOf(t)>-1}function L(e,t){if(t){if(C(e.length)){V(e,function(a){L(a,t)});return}if(e.classList){e.classList.add(t);return}var i=e.className.trim();i?i.indexOf(t)<0&&(e.className="".concat(i," ").concat(t)):e.className=t}}function G(e,t){if(t){if(C(e.length)){V(e,function(i){G(i,t)});return}if(e.classList){e.classList.remove(t);return}e.className.indexOf(t)>=0&&(e.className=e.className.replace(t,""))}}function ft(e,t,i){if(t){if(C(e.length)){V(e,function(a){ft(a,t,i)});return}i?L(e,t):G(e,t)}}var qi=/([a-z\d])([A-Z])/g;function de(e){return e.replace(qi,"$1-$2").toLowerCase()}function re(e,t){return dt(e[t])?e[t]:e.dataset?e.dataset[t]:e.getAttribute("data-".concat(de(t)))}function Tt(e,t,i){dt(i)?e[t]=i:e.dataset?e.dataset[t]=i:e.setAttribute("data-".concat(de(t)),i)}function Gi(e,t){if(dt(e[t]))try{delete e[t]}catch{e[t]=void 0}else if(e.dataset)try{delete e.dataset[t]}catch{e.dataset[t]=void 0}else e.removeAttribute("data-".concat(de(t)))}var Je=/\s\s*/,Ke=function(){var e=!1;if(Pt){var t=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return e=!0,t},set:function(r){t=r}});J.addEventListener("test",i,a),J.removeEventListener("test",i,a)}return e}();function X(e,t,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=i;t.trim().split(Je).forEach(function(r){if(!Ke){var n=e.listeners;n&&n[r]&&n[r][i]&&(s=n[r][i],delete n[r][i],Object.keys(n[r]).length===0&&delete n[r],Object.keys(n).length===0&&delete e.listeners)}e.removeEventListener(r,s,a)})}function F(e,t,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=i;t.trim().split(Je).forEach(function(r){if(a.once&&!Ke){var n=e.listeners,o=n===void 0?{}:n;s=function(){delete o[r][i],e.removeEventListener(r,s,a);for(var u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];i.apply(e,l)},o[r]||(o[r]={}),o[r][i]&&e.removeEventListener(r,o[r][i],a),o[r][i]=s,e.listeners=o}e.addEventListener(r,s,a)})}function mt(e,t,i){var a;return U(Event)&&U(CustomEvent)?a=new CustomEvent(t,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(t,!0,!0,i)),e.dispatchEvent(a)}function Qe(e){var t=e.getBoundingClientRect();return{left:t.left+(window.pageXOffset-document.documentElement.clientLeft),top:t.top+(window.pageYOffset-document.documentElement.clientTop)}}var Ft=J.location,Ji=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function Ie(e){var t=e.match(Ji);return t!==null&&(t[1]!==Ft.protocol||t[2]!==Ft.hostname||t[3]!==Ft.port)}function Ae(e){var t="timestamp=".concat(new Date().getTime());return e+(e.indexOf("?")===-1?"?":"&")+t}function Et(e){var t=e.rotate,i=e.scaleX,a=e.scaleY,s=e.translateX,r=e.translateY,n=[];C(s)&&s!==0&&n.push("translateX(".concat(s,"px)")),C(r)&&r!==0&&n.push("translateY(".concat(r,"px)")),C(t)&&t!==0&&n.push("rotate(".concat(t,"deg)")),C(i)&&i!==1&&n.push("scaleX(".concat(i,")")),C(a)&&a!==1&&n.push("scaleY(".concat(a,")"));var o=n.length?n.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function Ki(e){var t=Be({},e),i=0;return V(e,function(a,s){delete t[s],V(t,function(r){var n=Math.abs(a.startX-r.startX),o=Math.abs(a.startY-r.startY),h=Math.abs(a.endX-r.endX),u=Math.abs(a.endY-r.endY),l=Math.sqrt(n*n+o*o),d=Math.sqrt(h*h+u*u),p=(d-l)/l;Math.abs(p)>Math.abs(i)&&(i=p)})}),i}function St(e,t){var i=e.pageX,a=e.pageY,s={endX:i,endY:a};return t?s:Be({startX:i,startY:a},s)}function Qi(e){var t=0,i=0,a=0;return V(e,function(s){var r=s.startX,n=s.startY;t+=r,i+=n,a+=1}),t/=a,i/=a,{pageX:t,pageY:i}}function at(e){var t=e.aspectRatio,i=e.height,a=e.width,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=Se(a),n=Se(i);if(r&&n){var o=i*t;s==="contain"&&o>a||s==="cover"&&o<a?i=a/t:a=i*t}else r?i=a/t:n&&(a=i*t);return{width:a,height:i}}function Zi(e){var t=e.width,i=e.height,a=e.degree;if(a=Math.abs(a)%180,a===90)return{width:i,height:t};var s=a%90*Math.PI/180,r=Math.sin(s),n=Math.cos(s),o=t*n+i*r,h=t*r+i*n;return a>90?{width:h,height:o}:{width:o,height:h}}function ta(e,t,i,a){var s=t.aspectRatio,r=t.naturalWidth,n=t.naturalHeight,o=t.rotate,h=o===void 0?0:o,u=t.scaleX,l=u===void 0?1:u,d=t.scaleY,p=d===void 0?1:d,D=i.aspectRatio,y=i.naturalWidth,M=i.naturalHeight,E=a.fillColor,R=E===void 0?"transparent":E,P=a.imageSmoothingEnabled,A=P===void 0?!0:P,K=a.imageSmoothingQuality,H=K===void 0?"low":K,m=a.maxWidth,k=m===void 0?1/0:m,_=a.maxHeight,Y=_===void 0?1/0:_,Q=a.minWidth,rt=Q===void 0?0:Q,st=a.minHeight,Z=st===void 0?0:st,j=document.createElement("canvas"),B=j.getContext("2d"),nt=at({aspectRatio:D,width:k,height:Y}),Mt=at({aspectRatio:D,width:rt,height:Z},"cover"),Lt=Math.min(nt.width,Math.max(Mt.width,y)),Bt=Math.min(nt.height,Math.max(Mt.height,M)),ue=at({aspectRatio:s,width:k,height:Y}),ce=at({aspectRatio:s,width:rt,height:Z},"cover"),fe=Math.min(ue.width,Math.max(ce.width,r)),pe=Math.min(ue.height,Math.max(ce.height,n)),ei=[-fe/2,-pe/2,fe,pe];return j.width=pt(Lt),j.height=pt(Bt),B.fillStyle=R,B.fillRect(0,0,Lt,Bt),B.save(),B.translate(Lt/2,Bt/2),B.rotate(h*Math.PI/180),B.scale(l,p),B.imageSmoothingEnabled=A,B.imageSmoothingQuality=H,B.drawImage.apply(B,[e].concat(We(ei.map(function(ii){return Math.floor(pt(ii))})))),B.restore(),j}var Ze=String.fromCharCode;function ea(e,t,i){var a="";i+=t;for(var s=t;s<i;s+=1)a+=Ze(e.getUint8(s));return a}var ia=/^data:.*,/;function aa(e){var t=e.replace(ia,""),i=atob(t),a=new ArrayBuffer(i.length),s=new Uint8Array(a);return V(s,function(r,n){s[n]=i.charCodeAt(n)}),a}function ra(e,t){for(var i=[],a=8192,s=new Uint8Array(e);s.length>0;)i.push(Ze.apply(null,Ge(s.subarray(0,a)))),s=s.subarray(a);return"data:".concat(t,";base64,").concat(btoa(i.join("")))}function sa(e){var t=new DataView(e),i;try{var a,s,r;if(t.getUint8(0)===255&&t.getUint8(1)===216)for(var n=t.byteLength,o=2;o+1<n;){if(t.getUint8(o)===255&&t.getUint8(o+1)===225){s=o;break}o+=1}if(s){var h=s+4,u=s+10;if(ea(t,h,4)==="Exif"){var l=t.getUint16(u);if(a=l===18761,(a||l===19789)&&t.getUint16(u+2,a)===42){var d=t.getUint32(u+4,a);d>=8&&(r=u+d)}}}if(r){var p=t.getUint16(r,a),D,y;for(y=0;y<p;y+=1)if(D=r+y*12+2,t.getUint16(D,a)===274){D+=8,i=t.getUint16(D,a),t.setUint16(D,1,a);break}}}catch{i=1}return i}function na(e){var t=0,i=1,a=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:a=-1;break;case 5:t=90,a=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90;break}return{rotate:t,scaleX:i,scaleY:a}}var oa={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,i=this.options,a=this.container,s=this.cropper,r=Number(i.minContainerWidth),n=Number(i.minContainerHeight);L(s,W),G(t,W);var o={width:Math.max(a.offsetWidth,r>=0?r:je),height:Math.max(a.offsetHeight,n>=0?n:qe)};this.containerData=o,it(s,{width:o.width,height:o.height}),L(t,W),G(s,W)},initCanvas:function(){var t=this.containerData,i=this.imageData,a=this.options.viewMode,s=Math.abs(i.rotate)%180===90,r=s?i.naturalHeight:i.naturalWidth,n=s?i.naturalWidth:i.naturalHeight,o=r/n,h=t.width,u=t.height;t.height*o>t.width?a===3?h=t.height*o:u=t.width/o:a===3?u=t.width/o:h=t.height*o;var l={aspectRatio:o,naturalWidth:r,naturalHeight:n,width:h,height:u};this.canvasData=l,this.limited=a===1||a===2,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(t.width-l.width)/2,l.top=(t.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=S({},l)},limitCanvas:function(t,i){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,o=a.viewMode,h=r.aspectRatio,u=this.cropped&&n;if(t){var l=Number(a.minCanvasWidth)||0,d=Number(a.minCanvasHeight)||0;o>1?(l=Math.max(l,s.width),d=Math.max(d,s.height),o===3&&(d*h>l?l=d*h:d=l/h)):o>0&&(l?l=Math.max(l,u?n.width:0):d?d=Math.max(d,u?n.height:0):u&&(l=n.width,d=n.height,d*h>l?l=d*h:d=l/h));var p=at({aspectRatio:h,width:l,height:d});l=p.width,d=p.height,r.minWidth=l,r.minHeight=d,r.maxWidth=1/0,r.maxHeight=1/0}if(i)if(o>(u?0:1)){var D=s.width-r.width,y=s.height-r.height;r.minLeft=Math.min(0,D),r.minTop=Math.min(0,y),r.maxLeft=Math.max(0,D),r.maxTop=Math.max(0,y),u&&this.limited&&(r.minLeft=Math.min(n.left,n.left+(n.width-r.width)),r.minTop=Math.min(n.top,n.top+(n.height-r.height)),r.maxLeft=n.left,r.maxTop=n.top,o===2&&(r.width>=s.width&&(r.minLeft=Math.min(0,D),r.maxLeft=Math.max(0,D)),r.height>=s.height&&(r.minTop=Math.min(0,y),r.maxTop=Math.max(0,y))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=s.width,r.maxTop=s.height},renderCanvas:function(t,i){var a=this.canvasData,s=this.imageData;if(i){var r=Zi({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),n=r.width,o=r.height,h=a.width*(n/a.naturalWidth),u=a.height*(o/a.naturalHeight);a.left-=(h-a.width)/2,a.top-=(u-a.height)/2,a.width=h,a.height=u,a.aspectRatio=n/o,a.naturalWidth=n,a.naturalHeight=o,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,it(this.canvas,S({width:a.width,height:a.height},Et({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var i=this.canvasData,a=this.imageData,s=a.naturalWidth*(i.width/i.naturalWidth),r=a.naturalHeight*(i.height/i.naturalHeight);S(a,{width:s,height:r,left:(i.width-s)/2,top:(i.height-r)/2}),it(this.image,S({width:a.width,height:a.height},Et(S({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvasData,a=t.aspectRatio||t.initialAspectRatio,s=Number(t.autoCropArea)||.8,r={width:i.width,height:i.height};a&&(i.height*a>i.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*s),r.height=Math.max(r.minHeight,r.height*s),r.left=i.left+(i.width-r.width)/2,r.top=i.top+(i.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=S({},r)},limitCropBox:function(t,i){var a=this.options,s=this.containerData,r=this.canvasData,n=this.cropBoxData,o=this.limited,h=a.aspectRatio;if(t){var u=Number(a.minCropBoxWidth)||0,l=Number(a.minCropBoxHeight)||0,d=o?Math.min(s.width,r.width,r.width+r.left,s.width-r.left):s.width,p=o?Math.min(s.height,r.height,r.height+r.top,s.height-r.top):s.height;u=Math.min(u,s.width),l=Math.min(l,s.height),h&&(u&&l?l*h>u?l=u/h:u=l*h:u?l=u/h:l&&(u=l*h),p*h>d?p=d/h:d=p*h),n.minWidth=Math.min(u,d),n.minHeight=Math.min(l,p),n.maxWidth=d,n.maxHeight=p}i&&(o?(n.minLeft=Math.max(0,r.left),n.minTop=Math.max(0,r.top),n.maxLeft=Math.min(s.width,r.left+r.width)-n.width,n.maxTop=Math.min(s.height,r.top+r.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=s.width-n.width,n.maxTop=s.height-n.height))},renderCropBox:function(){var t=this.options,i=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,t.movable&&t.cropBoxMovable&&Tt(this.face,kt,a.width>=i.width&&a.height>=i.height?He:le),it(this.cropBox,S({width:a.width,height:a.height},Et({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),mt(this.element,Zt,this.getData())}},la={initPreview:function(){var t=this.element,i=this.crossOrigin,a=this.options.preview,s=i?this.crossOriginUrl:this.url,r=t.alt||"The image to preview",n=document.createElement("img");if(i&&(n.crossOrigin=i),n.src=s,n.alt=r,this.viewBox.appendChild(n),this.viewBoxImage=n,!!a){var o=a;typeof a=="string"?o=t.ownerDocument.querySelectorAll(a):a.querySelector&&(o=[a]),this.previews=o,V(o,function(h){var u=document.createElement("img");Tt(h,Nt,{width:h.offsetWidth,height:h.offsetHeight,html:h.innerHTML}),i&&(u.crossOrigin=i),u.src=s,u.alt=r,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',h.innerHTML="",h.appendChild(u)})}},resetPreview:function(){V(this.previews,function(t){var i=re(t,Nt);it(t,{width:i.width,height:i.height}),t.innerHTML=i.html,Gi(t,Nt)})},preview:function(){var t=this.imageData,i=this.canvasData,a=this.cropBoxData,s=a.width,r=a.height,n=t.width,o=t.height,h=a.left-i.left-t.left,u=a.top-i.top-t.top;!this.cropped||this.disabled||(it(this.viewBoxImage,S({width:n,height:o},Et(S({translateX:-h,translateY:-u},t)))),V(this.previews,function(l){var d=re(l,Nt),p=d.width,D=d.height,y=p,M=D,E=1;s&&(E=p/s,M=r*E),r&&M>D&&(E=D/r,y=s*E,M=D),it(l,{width:y,height:M}),it(l.getElementsByTagName("img")[0],S({width:n*E,height:o*E},Et(S({translateX:-h*E,translateY:-u*E},t))))}))}},ha={bind:function(){var t=this.element,i=this.options,a=this.cropper;U(i.cropstart)&&F(t,ie,i.cropstart),U(i.cropmove)&&F(t,ee,i.cropmove),U(i.cropend)&&F(t,te,i.cropend),U(i.crop)&&F(t,Zt,i.crop),U(i.zoom)&&F(t,ae,i.zoom),F(a,Ce,this.onCropStart=this.cropStart.bind(this)),i.zoomable&&i.zoomOnWheel&&F(a,Oe,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&F(a,De,this.onDblclick=this.dblclick.bind(this)),F(t.ownerDocument,Ee,this.onCropMove=this.cropMove.bind(this)),F(t.ownerDocument,ke,this.onCropEnd=this.cropEnd.bind(this)),i.responsive&&F(window,Me,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,i=this.options,a=this.cropper;U(i.cropstart)&&X(t,ie,i.cropstart),U(i.cropmove)&&X(t,ee,i.cropmove),U(i.cropend)&&X(t,te,i.cropend),U(i.crop)&&X(t,Zt,i.crop),U(i.zoom)&&X(t,ae,i.zoom),X(a,Ce,this.onCropStart),i.zoomable&&i.zoomOnWheel&&X(a,Oe,this.onWheel,{passive:!1,capture:!0}),i.toggleDragModeOnDblclick&&X(a,De,this.onDblclick),X(t.ownerDocument,Ee,this.onCropMove),X(t.ownerDocument,ke,this.onCropEnd),i.responsive&&X(window,Me,this.onResize)}},da={resize:function(){if(!this.disabled){var t=this.options,i=this.container,a=this.containerData,s=i.offsetWidth/a.width,r=i.offsetHeight/a.height,n=Math.abs(s-1)>Math.abs(r-1)?s:r;if(n!==1){var o,h;t.restore&&(o=this.getCanvasData(),h=this.getCropBoxData()),this.render(),t.restore&&(this.setCanvasData(V(o,function(u,l){o[l]=u*n})),this.setCropBoxData(V(h,function(u,l){h[l]=u*n})))}}},dblclick:function(){this.disabled||this.options.dragMode===Xe||this.setDragMode(ji(this.dragBox,Kt)?Fe:he)},wheel:function(t){var i=this,a=Number(this.options.wheelZoomRatio)||.1,s=1;this.disabled||(t.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50),t.deltaY?s=t.deltaY>0?1:-1:t.wheelDelta?s=-t.wheelDelta/120:t.detail&&(s=t.detail>0?1:-1),this.zoom(-s*a,t)))},cropStart:function(t){var i=t.buttons,a=t.button;if(!(this.disabled||(t.type==="mousedown"||t.type==="pointerdown"&&t.pointerType==="mouse")&&(C(i)&&i!==1||C(a)&&a!==0||t.ctrlKey))){var s=this.options,r=this.pointers,n;t.changedTouches?V(t.changedTouches,function(o){r[o.identifier]=St(o)}):r[t.pointerId||0]=St(t),Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?n=Ye:n=re(t.target,kt),Pi.test(n)&&mt(this.element,ie,{originalEvent:t,action:n})!==!1&&(t.preventDefault(),this.action=n,this.cropping=!1,n===ze&&(this.cropping=!0,L(this.dragBox,Vt)))}},cropMove:function(t){var i=this.action;if(!(this.disabled||!i)){var a=this.pointers;t.preventDefault(),mt(this.element,ee,{originalEvent:t,action:i})!==!1&&(t.changedTouches?V(t.changedTouches,function(s){S(a[s.identifier]||{},St(s,!0))}):S(a[t.pointerId||0]||{},St(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var i=this.action,a=this.pointers;t.changedTouches?V(t.changedTouches,function(s){delete a[s.identifier]}):delete a[t.pointerId||0],i&&(t.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,ft(this.dragBox,Vt,this.cropped&&this.options.modal)),mt(this.element,te,{originalEvent:t,action:i}))}}},ua={change:function(t){var i=this.options,a=this.canvasData,s=this.containerData,r=this.cropBoxData,n=this.pointers,o=this.action,h=i.aspectRatio,u=r.left,l=r.top,d=r.width,p=r.height,D=u+d,y=l+p,M=0,E=0,R=s.width,P=s.height,A=!0,K;!h&&t.shiftKey&&(h=d&&p?d/p:1),this.limited&&(M=r.minLeft,E=r.minTop,R=M+Math.min(s.width,a.width,a.left+a.width),P=E+Math.min(s.height,a.height,a.top+a.height));var H=n[Object.keys(n)[0]],m={x:H.endX-H.startX,y:H.endY-H.startY},k=function(Y){switch(Y){case ot:D+m.x>R&&(m.x=R-D);break;case lt:u+m.x<M&&(m.x=M-u);break;case tt:l+m.y<E&&(m.y=E-l);break;case ut:y+m.y>P&&(m.y=P-y);break}};switch(o){case le:u+=m.x,l+=m.y;break;case ot:if(m.x>=0&&(D>=R||h&&(l<=E||y>=P))){A=!1;break}k(ot),d+=m.x,d<0&&(o=lt,d=-d,u-=d),h&&(p=d/h,l+=(r.height-p)/2);break;case tt:if(m.y<=0&&(l<=E||h&&(u<=M||D>=R))){A=!1;break}k(tt),p-=m.y,l+=m.y,p<0&&(o=ut,p=-p,l-=p),h&&(d=p*h,u+=(r.width-d)/2);break;case lt:if(m.x<=0&&(u<=M||h&&(l<=E||y>=P))){A=!1;break}k(lt),d-=m.x,u+=m.x,d<0&&(o=ot,d=-d,u-=d),h&&(p=d/h,l+=(r.height-p)/2);break;case ut:if(m.y>=0&&(y>=P||h&&(u<=M||D>=R))){A=!1;break}k(ut),p+=m.y,p<0&&(o=tt,p=-p,l-=p),h&&(d=p*h,u+=(r.width-d)/2);break;case vt:if(h){if(m.y<=0&&(l<=E||D>=R)){A=!1;break}k(tt),p-=m.y,l+=m.y,d=p*h}else k(tt),k(ot),m.x>=0?D<R?d+=m.x:m.y<=0&&l<=E&&(A=!1):d+=m.x,m.y<=0?l>E&&(p-=m.y,l+=m.y):(p-=m.y,l+=m.y);d<0&&p<0?(o=yt,p=-p,d=-d,l-=p,u-=d):d<0?(o=bt,d=-d,u-=d):p<0&&(o=wt,p=-p,l-=p);break;case bt:if(h){if(m.y<=0&&(l<=E||u<=M)){A=!1;break}k(tt),p-=m.y,l+=m.y,d=p*h,u+=r.width-d}else k(tt),k(lt),m.x<=0?u>M?(d-=m.x,u+=m.x):m.y<=0&&l<=E&&(A=!1):(d-=m.x,u+=m.x),m.y<=0?l>E&&(p-=m.y,l+=m.y):(p-=m.y,l+=m.y);d<0&&p<0?(o=wt,p=-p,d=-d,l-=p,u-=d):d<0?(o=vt,d=-d,u-=d):p<0&&(o=yt,p=-p,l-=p);break;case yt:if(h){if(m.x<=0&&(u<=M||y>=P)){A=!1;break}k(lt),d-=m.x,u+=m.x,p=d/h}else k(ut),k(lt),m.x<=0?u>M?(d-=m.x,u+=m.x):m.y>=0&&y>=P&&(A=!1):(d-=m.x,u+=m.x),m.y>=0?y<P&&(p+=m.y):p+=m.y;d<0&&p<0?(o=vt,p=-p,d=-d,l-=p,u-=d):d<0?(o=wt,d=-d,u-=d):p<0&&(o=bt,p=-p,l-=p);break;case wt:if(h){if(m.x>=0&&(D>=R||y>=P)){A=!1;break}k(ot),d+=m.x,p=d/h}else k(ut),k(ot),m.x>=0?D<R?d+=m.x:m.y>=0&&y>=P&&(A=!1):d+=m.x,m.y>=0?y<P&&(p+=m.y):p+=m.y;d<0&&p<0?(o=bt,p=-p,d=-d,l-=p,u-=d):d<0?(o=yt,d=-d,u-=d):p<0&&(o=vt,p=-p,l-=p);break;case He:this.move(m.x,m.y),A=!1;break;case Ye:this.zoom(Ki(n),t),A=!1;break;case ze:if(!m.x||!m.y){A=!1;break}K=Qe(this.cropper),u=H.startX-K.left,l=H.startY-K.top,d=r.minWidth,p=r.minHeight,m.x>0?o=m.y>0?wt:vt:m.x<0&&(u-=d,o=m.y>0?yt:bt),m.y<0&&(l-=p),this.cropped||(G(this.cropBox,W),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}A&&(r.width=d,r.height=p,r.left=u,r.top=l,this.action=o,this.renderCropBox()),V(n,function(_){_.startX=_.endX,_.startY=_.endY})}},ca={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&L(this.dragBox,Vt),G(this.cropBox,W),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=S({},this.initialImageData),this.canvasData=S({},this.initialCanvasData),this.cropBoxData=S({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(S(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),G(this.dragBox,Vt),L(this.cropBox,W)),this},replace:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,V(this.previews,function(a){a.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,G(this.cropper,ye)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,L(this.cropper,ye)),this},destroy:function(){var t=this.element;return t[N]?(t[N]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=a.left,r=a.top;return this.moveTo(Yt(t)?t:s+Number(t),Yt(i)?i:r+Number(i))},moveTo:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.canvasData,s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(C(t)&&(a.left=t,s=!0),C(i)&&(a.top=i,s=!0),s&&this.renderCanvas(!0)),this},zoom:function(t,i){var a=this.canvasData;return t=Number(t),t<0?t=1/(1-t):t=1+t,this.zoomTo(a.width*t/a.naturalWidth,null,i)},zoomTo:function(t,i,a){var s=this.options,r=this.canvasData,n=r.width,o=r.height,h=r.naturalWidth,u=r.naturalHeight;if(t=Number(t),t>=0&&this.ready&&!this.disabled&&s.zoomable){var l=h*t,d=u*t;if(mt(this.element,ae,{ratio:t,oldRatio:n/h,originalEvent:a})===!1)return this;if(a){var p=this.pointers,D=Qe(this.cropper),y=p&&Object.keys(p).length?Qi(p):{pageX:a.pageX,pageY:a.pageY};r.left-=(l-n)*((y.pageX-D.left-r.left)/n),r.top-=(d-o)*((y.pageY-D.top-r.top)/o)}else ct(i)&&C(i.x)&&C(i.y)?(r.left-=(l-n)*((i.x-r.left)/n),r.top-=(d-o)*((i.y-r.top)/o)):(r.left-=(l-n)/2,r.top-=(d-o)/2);r.width=l,r.height=d,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return t=Number(t),C(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var i=this.imageData.scaleY;return this.scale(t,C(i)?i:1)},scaleY:function(t){var i=this.imageData.scaleX;return this.scale(C(i)?i:1,t)},scale:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,a=this.imageData,s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(C(t)&&(a.scaleX=t,s=!0),C(i)&&(a.scaleY=i,s=!0),s&&this.renderCanvas(!0,!0)),this},getData:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,i=this.options,a=this.imageData,s=this.canvasData,r=this.cropBoxData,n;if(this.ready&&this.cropped){n={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height};var o=a.width/a.naturalWidth;if(V(n,function(l,d){n[d]=l/o}),t){var h=Math.round(n.y+n.height),u=Math.round(n.x+n.width);n.x=Math.round(n.x),n.y=Math.round(n.y),n.width=u-n.x,n.height=h-n.y}}else n={x:0,y:0,width:0,height:0};return i.rotatable&&(n.rotate=a.rotate||0),i.scalable&&(n.scaleX=a.scaleX||1,n.scaleY=a.scaleY||1),n},setData:function(t){var i=this.options,a=this.imageData,s=this.canvasData,r={};if(this.ready&&!this.disabled&&ct(t)){var n=!1;i.rotatable&&C(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,n=!0),i.scalable&&(C(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,n=!0),C(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,n=!0)),n&&this.renderCanvas(!0,!0);var o=a.width/a.naturalWidth;C(t.x)&&(r.left=t.x*o+s.left),C(t.y)&&(r.top=t.y*o+s.top),C(t.width)&&(r.width=t.width*o),C(t.height)&&(r.height=t.height*o),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?S({},this.containerData):{}},getImageData:function(){return this.sized?S({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,i={};return this.ready&&V(["left","top","width","height","naturalWidth","naturalHeight"],function(a){i[a]=t[a]}),i},setCanvasData:function(t){var i=this.canvasData,a=i.aspectRatio;return this.ready&&!this.disabled&&ct(t)&&(C(t.left)&&(i.left=t.left),C(t.top)&&(i.top=t.top),C(t.width)?(i.width=t.width,i.height=t.width/a):C(t.height)&&(i.height=t.height,i.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var t=this.cropBoxData,i;return this.ready&&this.cropped&&(i={left:t.left,top:t.top,width:t.width,height:t.height}),i||{}},setCropBoxData:function(t){var i=this.cropBoxData,a=this.options.aspectRatio,s,r;return this.ready&&this.cropped&&!this.disabled&&ct(t)&&(C(t.left)&&(i.left=t.left),C(t.top)&&(i.top=t.top),C(t.width)&&t.width!==i.width&&(s=!0,i.width=t.width),C(t.height)&&t.height!==i.height&&(r=!0,i.height=t.height),a&&(s?i.height=i.width/a:r&&(i.width=i.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var i=this.canvasData,a=ta(this.image,this.imageData,i,t);if(!this.cropped)return a;var s=this.getData(t.rounded),r=s.x,n=s.y,o=s.width,h=s.height,u=a.width/Math.floor(i.naturalWidth);u!==1&&(r*=u,n*=u,o*=u,h*=u);var l=o/h,d=at({aspectRatio:l,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),p=at({aspectRatio:l,width:t.minWidth||0,height:t.minHeight||0},"cover"),D=at({aspectRatio:l,width:t.width||(u!==1?a.width:o),height:t.height||(u!==1?a.height:h)}),y=D.width,M=D.height;y=Math.min(d.width,Math.max(p.width,y)),M=Math.min(d.height,Math.max(p.height,M));var E=document.createElement("canvas"),R=E.getContext("2d");E.width=pt(y),E.height=pt(M),R.fillStyle=t.fillColor||"transparent",R.fillRect(0,0,y,M);var P=t.imageSmoothingEnabled,A=P===void 0?!0:P,K=t.imageSmoothingQuality;R.imageSmoothingEnabled=A,K&&(R.imageSmoothingQuality=K);var H=a.width,m=a.height,k=r,_=n,Y,Q,rt,st,Z,j;k<=-o||k>H?(k=0,Y=0,rt=0,Z=0):k<=0?(rt=-k,k=0,Y=Math.min(H,o+k),Z=Y):k<=H&&(rt=0,Y=Math.min(o,H-k),Z=Y),Y<=0||_<=-h||_>m?(_=0,Q=0,st=0,j=0):_<=0?(st=-_,_=0,Q=Math.min(m,h+_),j=Q):_<=m&&(st=0,Q=Math.min(h,m-_),j=Q);var B=[k,_,Y,Q];if(Z>0&&j>0){var nt=y/o;B.push(rt*nt,st*nt,Z*nt,j*nt)}return R.drawImage.apply(R,[a].concat(We(B.map(function(Mt){return Math.floor(pt(Mt))})))),E},setAspectRatio:function(t){var i=this.options;return!this.disabled&&!Yt(t)&&(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var i=this.options,a=this.dragBox,s=this.face;if(this.ready&&!this.disabled){var r=t===he,n=i.movable&&t===Fe;t=r||n?t:Xe,i.dragMode=t,Tt(a,kt,t),ft(a,Kt,r),ft(a,Qt,n),i.cropBoxMovable||(Tt(s,kt,t),ft(s,Kt,r),ft(s,Qt,n))}return this}},fa=J.Cropper,ti=function(){function e(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Ti(this,e),!t||!Ui.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=S({},Ne,ct(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return Mi(e,[{key:"init",value:function(){var i=this.element,a=i.tagName.toLowerCase(),s;if(!i[N]){if(i[N]=this,a==="img"){if(this.isImg=!0,s=i.getAttribute("src")||"",this.originalUrl=s,!s)return;s=i.src}else a==="canvas"&&window.HTMLCanvasElement&&(s=i.toDataURL());this.load(s)}}},{key:"load",value:function(i){var a=this;if(i){this.url=i,this.imageData={};var s=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(Li.test(i)){Bi.test(i)?this.read(aa(i)):this.clone();return}var n=new XMLHttpRequest,o=this.clone.bind(this);this.reloading=!0,this.xhr=n,n.onabort=o,n.onerror=o,n.ontimeout=o,n.onprogress=function(){n.getResponseHeader("content-type")!==$e&&n.abort()},n.onload=function(){a.read(n.response)},n.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&Ie(i)&&s.crossOrigin&&(i=Ae(i)),n.open("GET",i,!0),n.responseType="arraybuffer",n.withCredentials=s.crossOrigin==="use-credentials",n.send()}}},{key:"read",value:function(i){var a=this.options,s=this.imageData,r=sa(i),n=0,o=1,h=1;if(r>1){this.url=ra(i,$e);var u=na(r);n=u.rotate,o=u.scaleX,h=u.scaleY}a.rotatable&&(s.rotate=n),a.scalable&&(s.scaleX=o,s.scaleY=h),this.clone()}},{key:"clone",value:function(){var i=this.element,a=this.url,s=i.crossOrigin,r=a;this.options.checkCrossOrigin&&Ie(a)&&(s||(s="anonymous"),r=Ae(a)),this.crossOrigin=s,this.crossOriginUrl=r;var n=document.createElement("img");s&&(n.crossOrigin=s),n.src=r||a,n.alt=i.alt||"The image to crop",this.image=n,n.onload=this.start.bind(this),n.onerror=this.stop.bind(this),L(n,xe),i.parentNode.insertBefore(n,i.nextSibling)}},{key:"start",value:function(){var i=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var s=J.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(J.navigator.userAgent),r=function(u,l){S(i.imageData,{naturalWidth:u,naturalHeight:l,aspectRatio:u/l}),i.initialImageData=S({},i.imageData),i.sizing=!1,i.sized=!0,i.build()};if(a.naturalWidth&&!s){r(a.naturalWidth,a.naturalHeight);return}var n=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=n,n.onload=function(){r(n.width,n.height),s||o.removeChild(n)},n.src=a.src,s||(n.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(n))}},{key:"stop",value:function(){var i=this.image;i.onload=null,i.onerror=null,i.parentNode.removeChild(i),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var i=this.element,a=this.options,s=this.image,r=i.parentNode,n=document.createElement("div");n.innerHTML=Wi;var o=n.querySelector(".".concat(N,"-container")),h=o.querySelector(".".concat(N,"-canvas")),u=o.querySelector(".".concat(N,"-drag-box")),l=o.querySelector(".".concat(N,"-crop-box")),d=l.querySelector(".".concat(N,"-face"));this.container=r,this.cropper=o,this.canvas=h,this.dragBox=u,this.cropBox=l,this.viewBox=o.querySelector(".".concat(N,"-view-box")),this.face=d,h.appendChild(s),L(i,W),r.insertBefore(o,i.nextSibling),G(s,xe),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,L(l,W),a.guides||L(l.getElementsByClassName("".concat(N,"-dashed")),W),a.center||L(l.getElementsByClassName("".concat(N,"-center")),W),a.background&&L(o,"".concat(N,"-bg")),a.highlight||L(d,Ai),a.cropBoxMovable&&(L(d,Qt),Tt(d,kt,le)),a.cropBoxResizable||(L(l.getElementsByClassName("".concat(N,"-line")),W),L(l.getElementsByClassName("".concat(N,"-point")),W)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),U(a.ready)&&F(i,Te,a.ready,{once:!0}),mt(i,Te)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var i=this.cropper.parentNode;i&&i.removeChild(this.cropper),G(this.element,W)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=fa,e}},{key:"setDefaults",value:function(i){S(Ne,ct(i)&&i)}}])}();S(ti.prototype,oa,la,ha,da,ua,ca);const pa={props:{item:{type:Object,required:!0},save:{type:Object,required:!0}},emits:["update:item","update:file","error"],inject:["compose","locales","translate","txlocales","url"],data(){return{transcribing:!1,translating:!1,composing:!1,cropping:!1,covering:!1,tabtrans:null,tabdesc:null,cropper:null,scaleX:1,scaleY:1}},setup(){const e=ri(),t=se(),i=si(),a=_t();return{app:_e(),auth:a,languages:e,messages:t,side:i}},mounted(){this.init()},beforeUnmount(){this.cropper&&this.cropper.destroy()},computed:{desclangs(){return this.languages.available.concat(Object.keys(this.item.description||{})).filter((e,t,i)=>i.indexOf(e)===t)},ratio(){if(!this.cropper)return NaN;const e=this.cropper.getImageData();return e.naturalWidth/e.naturalHeight},readonly(){return!this.auth.can("file:save")}},methods:{addCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const e=this,t=this.$refs.video;if(!t)return this.messages.add(this.$gettext("No video element found"),"error");const i=this.item.path.replace(/\.[A-Za-z0-9]+$/,".png").split("/").pop(),a=document.createElement("canvas"),s=a.getContext("2d");a.width=t.videoWidth,a.height=t.videoHeight,s.drawImage(t,0,0,t.videoWidth,t.videoHeight),a.toBlob(function(r){const n=new File([r],i,{type:"image/png"});e.covering=!0,e.$apollo.mutate({mutation:z`mutation($id: ID!, $preview: Upload) {
              saveFile(id: $id, input: {}, preview: $preview) {
                id
                latest {
                  data
                  created_at
                }
              }
            }`,variables:{id:e.item.id,preview:n},context:{hasUpload:!0}}).then(o=>{var u,l,d;if(o.errors)throw o.errors;const h=(l=(u=o.data)==null?void 0:u.saveFile)==null?void 0:l.latest;h&&(e.item.previews=((d=JSON.parse(h.data||"{}"))==null?void 0:d.previews)||{},e.item.updated_at=h.created_at)}).catch(o=>{e.messages.add(this.$gettext("Error saving video cover"),"error"),this.$log("FileDetailItem::addCover(): Error saving video cover",o)}).finally(()=>{e.covering=!1})},"image/png",1)},aspect(e){this.cropper.setAspectRatio(e),this.cropper.setDragMode("crop"),this.cropping=!0},composeText(){const e=this.desclangs.shift()||this.item.lang||"en",t=`Summarize the content of the file in a few words in plain text format for a title tag in the language with the ISO code "${e}":`;this.composing=!0,this.compose(t,null,[this.item.id]).then(i=>{this.update("description",Object.assign(this.item.description||{},{[e]:i}))}).finally(()=>{this.composing=!1})},crop(){this.cropping=!1,this.cropper.setDragMode("none"),this.cropper.getCroppedCanvas().toBlob(e=>{this.$emit("update:file",e)})},download(){this.cropper.getCroppedCanvas().toBlob(e=>{const t=URL.createObjectURL(e),i=document.createElement("a");i.href=t,i.download=this.item.name||"download",i.click(),URL.revokeObjectURL(t)})},flipX(){this.scaleX=-this.scaleX,this.cropper.scaleX(this.scaleX),this.updateFile()},flipY(){this.scaleY=-this.scaleY,this.cropper.scaleY(this.scaleY),this.updateFile()},init(){var e;!this.readonly&&((e=this.item.mime)!=null&&e.startsWith("image/"))&&(this.cropper&&(this.cropper.destroy(),this.cropper=null),this.cropper=new ti(this.$refs.image,{aspectRatio:NaN,background:!0,responsive:!0,dragMode:"none",movable:!1,autoCrop:!1,zoomable:!1,zoomOnWheel:!1,zoomOnTouch:!1,checkCrossOrigin:!1,checkOrientation:!1,viewMode:1}))},removeCover(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.covering=!0,this.item.previews={},this.$apollo.mutate({mutation:z`mutation($id: ID!, $preview: Boolean) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:!1}}).then(e=>{var i,a,s;if(e.errors)throw e.errors;const t=(a=(i=e.data)==null?void 0:i.saveFile)==null?void 0:a.latest;t&&(this.item.previews=((s=JSON.parse(t.data||"{}"))==null?void 0:s.previews)||{},this.item.updated_at=t.created_at)}).catch(e=>{this.messages.add(this.$gettext("Error removing video cover"),"error"),this.$log("FileDetailItem::removeCover(): Error removing video cover",e)}).finally(()=>{this.covering=!1})},reset(){this.cropping=!1,this.$emit("update:file",null),this.cropper.reset(),this.cropper.clear(),this.scaleX=1,this.scaleY=1},rotate(e){this.cropper.rotate(e),this.updateFile(),this.$nextTick(()=>{const t=this.cropper.getContainerData(),i=this.cropper.getImageData();let a,s;Math.abs(Math.abs(i.rotate)-180)===90?(a=t.width/i.naturalHeight,s=t.height/i.naturalWidth):(a=t.width/i.naturalWidth,s=t.height/i.naturalHeight),this.cropper.zoomTo(Math.min(a,s))})},transcribe(){var e,t;if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!((e=this.item.mime)!=null&&e.startsWith("audio/"))&&!((t=this.item.mime)!=null&&t.startsWith("video/")))return this.messages.add(this.$gettext("Transcription is only available for audio and video files"),"error");this.transcribing=!0,wi(this.url(this.item.path,!0)).then(i=>this.$apollo.mutate({mutation:z`mutation($file: Upload!) {
              transcribe(file: $file)
            }`,variables:{file:new File([i],"audio.mp3",{type:"audio/mpeg"})},context:{hasUpload:!0}})).then(i=>{var s;if(i.errors)throw i;const a=this.desclangs.shift()||this.item.lang||"en";this.update("transcription",Object.assign(this.item.transcription||{},{[a]:((s=i.data)==null?void 0:s.transcribe)||""}))}).catch(i=>{this.messages.add(this.$gettext("Error transcribing file"),"error"),this.$log("FileDetailItem::transcribe(): Error transcribing from media URL",i)}).finally(()=>{this.transcribing=!1})},translateText(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!e||typeof e!="object"){this.$log("FileDetailItem::translateText(): Invalid map object",e);return}const t=[],[i,a]=Object.entries(e||{}).find(([s,r])=>!!r);return this.translating=!0,this.txlocales(i).map(s=>s.code).forEach(s=>{t.push(this.translate(a,s).then(r=>{r[0]&&(e[s]=r[0])}).catch(r=>{this.$log("FileDetailItem::translateText(): Error translating text",r)}))}),Promise.all(t).then(()=>(this.$emit("update:item",this.item),this.translating=!1,e))},translateVTT(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");if(!e||typeof e!="object"){this.$log("FileDetailItem::translateVTT(): Invalid map object",e);return}const t=/^\d{2}:\d{2}:\d{2}\.\d{3} --\> \d{2}:\d{2}:\d{2}\.\d{3}(?: .*)?$/,i={...e};for(const[a,s]of Object.entries(i))s&&(i[a]=s.split(`
`).map(r=>r.startsWith("WEBVTT")||t.test(r)?`<x>${r}</x>`:r).filter(r=>r.trim()!=="").join(""));this.translateText(i).then(a=>{for(const[s,r]of Object.entries(a))a[s]&&(e[s]=a[s].replaceAll(/\<x\>/g,`

`).replaceAll(/\<\/x\>/g,`
`).trim());this.$emit("update:item",this.item)}).catch(a=>{this.$log("FileDetailItem::translateVTT(): Error translating VTT",a)})},update(e,t){this.item[e]=t,this.$emit("update:item",this.item)},updateFile(){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");this.cropper.getCroppedCanvas().toBlob(e=>{this.$emit("update:file",e)})},uploadCover(e){if(this.readonly)return this.messages.add(this.$gettext("Permission denied"),"error");const t=e.target.files[0];if(!t)return this.messages.add(this.$gettext("No file selected"),"error");this.covering=!0,this.$apollo.mutate({mutation:z`mutation($id: ID!, $preview: Upload) {
            saveFile(id: $id, input: {}, preview: $preview) {
              id
              latest {
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,preview:t},context:{hasUpload:!0}}).then(i=>{var s,r,n;if(i.errors)throw i.errors;const a=(r=(s=i.data)==null?void 0:s.saveFile)==null?void 0:r.latest;a&&(this.item.previews=((n=JSON.parse(a.data||"{}"))==null?void 0:n.previews)||{},this.item.updated_at=a.created_at)}).catch(i=>{this.messages.add(this.$gettext("Error uploading video cover"),"error"),this.$log("FileDetailItem::uploadCover(): Error uploading video cover",i)}).finally(()=>{this.covering=!1})}},watch:{"save.count":function(){this.save.count>0&&this.$nextTick(()=>{this.init()})}}},ma={key:0,ref:"editorContainer",class:"editor-container"},ga=["src"],va={key:0,class:"floating-toolbar"},ba={class:"toolbar-group"},wa={class:"toolbar-group"},ya={class:"toolbar-group"},xa={class:"toolbar-group"},Da={key:1,class:"editor-container"},Ca=["src"],Ea={key:0,class:"floating-toolbar"},ka={class:"toolbar-group"},Ta=["src"],Ma={key:1,class:"toolbar-group"},Oa=["src"],$a={key:3,xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-file-earmark-binary",viewBox:"0 0 16 16"},Na={key:0,class:"actions"},Sa={key:0,class:"actions"};function Ia(e,t,i,a,s,r){return b(),T(Ve,null,{default:f(()=>[c(Re,{class:"scroll"},{default:f(()=>{var n,o;return[c(Ot,null,{default:f(()=>[c(gt,{cols:"12",md:"6"},{default:f(()=>[c(Pe,{ref:"name",readonly:r.readonly,modelValue:i.item.name,"onUpdate:modelValue":t[0]||(t[0]=h=>r.update("name",h)),variant:"underlined",label:e.$gettext("Name"),counter:"255",maxlength:"255"},null,8,["readonly","modelValue","label"])]),_:1}),c(gt,{cols:"12",md:"6"},{default:f(()=>[c(ni,{ref:"lang",items:r.locales(!0),readonly:r.readonly,modelValue:i.item.lang,"onUpdate:modelValue":t[1]||(t[1]=h=>r.update("lang",h)),variant:"underlined",label:e.$gettext("Language")},null,8,["items","readonly","modelValue","label"])]),_:1})]),_:1}),c(Ot,null,{default:f(()=>[i.item?(b(),T(gt,{key:0,cols:"12",class:"preview"},{default:f(()=>{var h,u,l;return[(h=i.item.mime)!=null&&h.startsWith("image/")?(b(),$("div",ma,[v("img",{ref:"image",src:r.url(i.item.path,!0),class:"element",crossorigin:"anonymous"},null,8,ga),r.readonly?O("",!0):(b(),$("div",va,[v("div",ba,[s.cropping?(b(),T(w,{key:0,onClick:t[2]||(t[2]=d=>r.crop()),title:e.$gettext("Use cropped image"),icon:"mdi-image-check",class:"no-rtl"},null,8,["title"])):(b(),T(Dt,{key:1},{activator:f(({props:d})=>[c(w,Ct(d,{icon:"mdi-crop",class:"no-rtl",title:e.$gettext("Crop image")}),null,16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[3]||(t[3]=d=>r.aspect(r.ratio))},{default:f(()=>[x(g(e.$gettext("Original ratio")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[4]||(t[4]=d=>r.aspect(NaN))},{default:f(()=>[x(g(e.$gettext("No ratio")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[5]||(t[5]=d=>r.aspect(1))},{default:f(()=>[x(g(e.$gettext("Square")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[6]||(t[6]=d=>r.aspect(3/2))},{default:f(()=>t[26]||(t[26]=[x("3:2",-1)])),_:1,__:[26]})]),_:1}),c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[7]||(t[7]=d=>r.aspect(4/3))},{default:f(()=>t[27]||(t[27]=[x("4:3",-1)])),_:1,__:[27]})]),_:1}),c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[8]||(t[8]=d=>r.aspect(5/3))},{default:f(()=>t[28]||(t[28]=[x("5:3",-1)])),_:1,__:[28]})]),_:1}),c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-crop",class:"no-rtl",variant:"text",onClick:t[9]||(t[9]=d=>r.aspect(16/9))},{default:f(()=>t[29]||(t[29]=[x("16:9",-1)])),_:1,__:[29]})]),_:1})]),_:1})]),_:1}))]),v("div",wa,[c(w,{icon:"mdi-rotate-left",class:"no-rtl",onClick:t[10]||(t[10]=d=>r.rotate(-90)),title:e.$gettext("Rotate counter-clockwise")},null,8,["title"]),c(w,{icon:"mdi-rotate-right",class:"no-rtl",onClick:t[11]||(t[11]=d=>r.rotate(90)),title:e.$gettext("Rotate clockwise")},null,8,["title"])]),v("div",ya,[c(w,{icon:"mdi-flip-horizontal",class:"no-rtl",onClick:r.flipX,title:e.$gettext("Flip horizontally")},null,8,["onClick","title"]),c(w,{icon:"mdi-flip-vertical",class:"no-rtl",onClick:r.flipY,title:e.$gettext("Flip vertically")},null,8,["onClick","title"])]),v("div",xa,[c(w,{icon:"mdi-history",class:"no-rtl",onClick:t[12]||(t[12]=d=>r.reset()),title:e.$gettext("Reset")},null,8,["title"]),c(w,{icon:"mdi-download",class:"no-rtl",onClick:t[13]||(t[13]=d=>r.download()),title:e.$gettext("Download")},null,8,["title"])])]))],512)):(u=i.item.mime)!=null&&u.startsWith("video/")?(b(),$("div",Da,[v("video",{ref:"video",src:r.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Ca),r.readonly?O("",!0):(b(),$("div",Ea,[v("div",ka,[Object.values(i.item.previews).length?(b(),$("img",{key:0,class:"video-preview",src:r.url(Object.values(i.item.previews).shift()),onClick:t[14]||(t[14]=d=>r.removeCover())},null,8,Ta)):(b(),$("div",Ma,[c(w,{icon:"mdi-tooltip-image",loading:s.covering,title:e.$gettext("Use as cover image"),onClick:t[15]||(t[15]=d=>r.addCover())},null,8,["loading","title"]),c(w,{icon:"",loading:s.covering,title:e.$gettext("Upload cover image"),onClick:t[17]||(t[17]=d=>e.$refs.coverInput.click())},{default:f(()=>[c(Le,null,{default:f(()=>t[30]||(t[30]=[x("mdi-image-plus",-1)])),_:1,__:[30]}),v("input",{ref:"coverInput",type:"file",class:"cover-input",onChange:t[16]||(t[16]=d=>r.uploadCover(d))},null,544)]),_:1},8,["loading","title"])]))])]))])):(l=i.item.mime)!=null&&l.startsWith("audio/")?(b(),$("audio",{key:2,src:r.url(i.item.path),crossorigin:"anonymous",class:"element",controls:""},null,8,Oa)):(b(),$("svg",$a,t[31]||(t[31]=[v("path",{d:"M7.05 11.885c0 1.415-.548 2.206-1.524 2.206C4.548 14.09 4 13.3 4 11.885c0-1.412.548-2.203 1.526-2.203.976 0 1.524.79 1.524 2.203m-1.524-1.612c-.542 0-.832.563-.832 1.612q0 .133.006.252l1.559-1.143c-.126-.474-.375-.72-.733-.72zm-.732 2.508c.126.472.372.718.732.718.54 0 .83-.563.83-1.614q0-.129-.006-.25zm6.061.624V14h-3v-.595h1.181V10.5h-.05l-1.136.747v-.688l1.19-.786h.69v3.633z"},null,-1),v("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"},null,-1)])))]}),_:1})):O("",!0)]),_:1}),c(Ot,null,{default:f(()=>[c(gt,{cols:"12",class:"description"},{default:f(()=>[c(me,null,{default:f(()=>[x(g(e.$gettext("Descriptions"))+" ",1),r.readonly?O("",!0):(b(),$("div",Na,[Object.values(i.item.description||{}).find(h=>!!h)?(b(),T(w,{key:0,onClick:t[18]||(t[18]=h=>r.translateText(i.item.description)),title:e.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"flat"},null,8,["title","loading"])):O("",!0),c(w,{onClick:t[19]||(t[19]=h=>r.composeText()),title:e.$gettext("Generate description"),loading:s.composing,icon:"mdi-creation",variant:"flat"},null,8,["title","loading"])]))]),_:1}),c(Xt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[20]||(t[20]=h=>s.tabdesc=h)},{default:f(()=>[(b(!0),$(q,null,et(r.locales(),h=>(b(),T(It,{value:h.value},{default:f(()=>[x(g(h.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),c(jt,{modelValue:s.tabdesc,"onUpdate:modelValue":t[21]||(t[21]=h=>s.tabdesc=h)},{default:f(()=>[(b(!0),$(q,null,et(r.locales(),h=>(b(),T(At,{value:h.value},{default:f(()=>{var u;return[c(ge,{ref_for:!0,ref:"description","onUpdate:modelValue":l=>{i.item.description[h.value]=l,e.$emit("update:item",i.item)},label:e.$gettext("Description (%{lang})",{lang:h.value}),modelValue:((u=i.item.description)==null?void 0:u[h.value])||"",readonly:r.readonly,variant:"underlined",counter:"500",rows:"2","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(n=i.item.mime)!=null&&n.startsWith("audio/")||(o=i.item.mime)!=null&&o.startsWith("video/")?(b(),T(Ot,{key:0},{default:f(()=>[c(gt,{cols:"12",class:"transcription"},{default:f(()=>[c(me,null,{default:f(()=>[x(g(e.$gettext("Transcriptions"))+" ",1),r.readonly?O("",!0):(b(),$("div",Sa,[Object.values(i.item.transcription||{}).find(h=>!!h)?(b(),T(w,{key:0,onClick:t[22]||(t[22]=h=>r.translateVTT(i.item.transcription)),title:e.$gettext("Translate text"),loading:s.translating,icon:"mdi-translate",variant:"flat"},null,8,["title","loading"])):O("",!0),c(w,{onClick:t[23]||(t[23]=h=>r.transcribe()),title:e.$gettext("Transcribe file content"),loading:s.transcribing,icon:"mdi-creation",variant:"flat"},null,8,["title","loading"])]))]),_:1}),c(Xt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[24]||(t[24]=h=>s.tabtrans=h)},{default:f(()=>[(b(!0),$(q,null,et(r.locales(),h=>(b(),T(It,{value:h.value},{default:f(()=>[x(g(h.title),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"]),c(jt,{modelValue:s.tabtrans,"onUpdate:modelValue":t[25]||(t[25]=h=>s.tabtrans=h)},{default:f(()=>[(b(!0),$(q,null,et(r.locales(),h=>(b(),T(At,{value:h.value},{default:f(()=>{var u;return[c(ge,{ref_for:!0,ref:"transcription","onUpdate:modelValue":l=>{i.item.transcription[h.value]=l,e.$emit("update:item",i.item)},label:e.$gettext("Transcription (%{lang})",{lang:h.value}),modelValue:((u=i.item.transcription)==null?void 0:u[h.value])||"",readonly:r.readonly,variant:"underlined",rows:"20","auto-grow":"",clearable:""},null,8,["onUpdate:modelValue","label","modelValue","readonly"])]}),_:2},1032,["value"]))),256))]),_:1},8,["modelValue"])]),_:1})]),_:1})):O("",!0)]}),_:1})]),_:1})}const Aa=Rt(pa,[["render",Ia],["__scopeId","data-v-387c0095"]]),Va={components:{AsideMeta:xi,HistoryDialog:yi,FileDetailItem:Aa,FileDetailRefs:Ei},inject:["closeView"],props:{item:{type:Object,required:!0}},data:()=>({file:null,error:!1,changed:!1,publishAt:null,pubmenu:!1,vhistory:!1,tab:"file",savecnt:0}),setup(){const e=se(),t=oi();return{auth:_t(),drawer:t,messages:e}},methods:{publish(e=null){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}this.save(!0).then(t=>{var i,a;t&&this.$apollo.mutate({mutation:z`mutation ($id: [ID!]!, $at: DateTime) {
              pubFile(id: $id, at: $at) {
                id
              }
            }`,variables:{id:[this.item.id],at:(a=(i=e==null?void 0:e.toISOString())==null?void 0:i.substring(0,19))==null?void 0:a.replace("T"," ")}}).then(s=>{if(s.errors)throw s.errors;e?(this.item.publish_at=e,this.messages.add(this.$gettext("File scheduled for publishing at %{date}",{date:e.toLocaleDateString()}),"info")):(this.item.published=!0,this.messages.add(this.$gettext("File published successfully"),"success")),this.closeView()}).catch(s=>{this.messages.add(this.$gettext("Error publishing file"),"error"),this.$log("FileDetail::publish(): Error publishing file",e,s)})})},reset(){this.changed=!1,this.error=!1},save(e=!1){return this.auth.can("file:save")?this.changed?this.$apollo.mutate({mutation:z`mutation ($id: ID!, $input: FileInput!, $file: Upload) {
            saveFile(id: $id, input: $input, file: $file) {
              id
              latest {
                id
                data
                created_at
              }
            }
          }`,variables:{id:this.item.id,input:{transcription:JSON.stringify(this.item.transcription||{}),description:JSON.stringify(this.item.description||{}),previews:JSON.stringify(this.item.previews||{}),path:this.item.path,name:this.item.name,lang:this.item.lang},file:this.file},context:{hasUpload:!0}}).then(t=>{var a,s;if(t.errors)throw t.errors;const i=(s=(a=t.data)==null?void 0:a.saveFile)==null?void 0:s.latest;return Object.assign(this.item,JSON.parse((i==null?void 0:i.data)||"{}")),this.item.updated_at=i==null?void 0:i.created_at,this.item.published=!1,this.reset(),e||this.messages.add(this.$gettext("File saved successfully"),"success"),this.savecnt++,!0}).catch(t=>{this.messages.add(this.$gettext("Error saving file"),"error"),this.$log("FileDetail::save(): Error saving file",t)}):Promise.resolve(!0):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve(!1))},use(e){Object.assign(this.item,e.data),this.vhistory=!1,this.changed=!0,this.savecnt++},versions(e){return this.auth.can("file:view")?e?this.$apollo.query({query:z`query($id: ID!) {
            file(id: $id) {
              id
              versions {
                id
                published
                publish_at
                data
                editor
                created_at
              }
            }
          }`,variables:{id:e}}).then(t=>{if(t.errors||!t.data.file)throw t;const i=["previews","description","transcription"];return(t.data.file.versions||[]).map(a=>{const s={...a,data:JSON.parse(a.data||"{}")};return i.forEach(r=>s[r]??(s[r]={})),s}).reverse()}).catch(t=>{this.messages.add(this.$gettext("Error fetching file versions"),"error"),this.$log("FileDetail::versions(): Error fetching file versions",e,t)}):Promise.resolve([]):(this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]))}}},Ra={class:"app-title"},_a={class:"menu-content"};function Pa(e,t,i,a,s,r){const n=$t("FileDetailItem"),o=$t("FileDetailRefs"),h=$t("AsideMeta"),u=$t("HistoryDialog");return b(),$(q,null,[c(li,{elevation:0,density:"compact"},{prepend:f(()=>[c(w,{onClick:t[0]||(t[0]=l=>r.closeView()),title:e.$gettext("Back to list view"),icon:"mdi-keyboard-backspace"},null,8,["title"])]),append:f(()=>[c(w,{onClick:t[1]||(t[1]=l=>e.vhistory=!0),title:e.$gettext("View history"),class:ht([{hidden:i.item.published&&!e.changed&&!i.item.latest},"no-rtl"]),icon:"mdi-history"},null,8,["title","class"]),c(w,{onClick:t[2]||(t[2]=l=>r.save()),class:ht([{error:e.error},"menu-save"]),disabled:!e.changed||e.error||!a.auth.can("file:save"),variant:"text"},{default:f(()=>[x(g(e.$gettext("Save")),1)]),_:1},8,["class","disabled"]),c(Dt,{modelValue:e.pubmenu,"onUpdate:modelValue":t[6]||(t[6]=l=>e.pubmenu=l),"close-on-content-click":!1},{activator:f(({props:l})=>[c(fi,{class:"menu-publish",variant:"text"},{default:f(()=>[c(w,{onClick:t[3]||(t[3]=d=>r.publish()),class:ht([{error:e.error},"button"]),disabled:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish")},{default:f(()=>[x(g(e.$gettext("Publish")),1)]),_:1},8,["class","disabled"]),c(w,Ct(l,{class:[{error:e.error},"icon"],disabled:i.item.published&&!e.changed||e.error||!a.auth.can("file:publish"),title:e.$gettext("Schedule publishing"),icon:"mdi-menu-down"}),null,16,["class","disabled","title"])]),_:2},1024)]),default:f(()=>[v("div",_a,[c(ci,{modelValue:e.publishAt,"onUpdate:modelValue":t[4]||(t[4]=l=>e.publishAt=l),"hide-header":"","show-adjacent-months":""},null,8,["modelValue"]),c(w,{onClick:t[5]||(t[5]=l=>{r.publish(e.publishAt),e.pubmenu=!1}),color:e.publishAt?"primary":"",disabled:!e.publishAt||e.error,variant:"flat"},{default:f(()=>[x(g(e.$gettext("Publish")),1)]),_:1},8,["color","disabled"])])]),_:1},8,["modelValue"]),c(w,{onClick:t[7]||(t[7]=qt(l=>a.drawer.toggle("aside"),["stop"])),title:e.$gettext("Toggle side menu"),icon:a.drawer.aside?"mdi-chevron-right":"mdi-chevron-left"},null,8,["title","icon"])]),default:f(()=>[c(ui,null,{default:f(()=>[v("div",Ra,g(e.$gettext("File"))+": "+g(i.item.name),1)]),_:1})]),_:1}),c(hi,{class:"file-details"},{default:f(()=>[c(pi,{onSubmit:t[13]||(t[13]=qt(()=>{},["prevent"]))},{default:f(()=>[c(Xt,{"fixed-tabs":"",modelValue:e.tab,"onUpdate:modelValue":t[8]||(t[8]=l=>e.tab=l)},{default:f(()=>[c(It,{value:"file",class:ht({changed:e.changed,error:e.error})},{default:f(()=>[x(g(e.$gettext("File")),1)]),_:1},8,["class"]),c(It,{value:"refs"},{default:f(()=>[x(g(e.$gettext("Used by")),1)]),_:1})]),_:1},8,["modelValue"]),c(jt,{modelValue:e.tab,"onUpdate:modelValue":t[12]||(t[12]=l=>e.tab=l)},{default:f(()=>[c(At,{value:"file"},{default:f(()=>[c(n,{"onUpdate:item":t[9]||(t[9]=l=>{this.$emit("update:item",i.item),e.changed=!0}),"onUpdate:file":t[10]||(t[10]=l=>{this.file=l,e.changed=!0}),onError:t[11]||(t[11]=l=>e.error=l),save:{count:e.savecnt},item:i.item},null,8,["save","item"])]),_:1}),c(At,{value:"refs"},{default:f(()=>[c(o,{item:i.item},null,8,["item"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),c(h,{item:i.item},null,8,["item"]),(b(),T(di,{to:"body"},[c(u,{modelValue:e.vhistory,"onUpdate:modelValue":t[14]||(t[14]=l=>e.vhistory=l),current:{data:{lang:i.item.lang,name:i.item.name,mime:i.item.mime,path:i.item.path,previews:i.item.previews,description:i.item.description,transcription:i.item.transcription}},load:()=>r.versions(i.item.id),onUse:t[15]||(t[15]=l=>r.use(l)),onRevert:t[16]||(t[16]=l=>{r.use(l),r.reset()})},null,8,["modelValue","current","load"])]))],64)}const sr=Rt(Va,[["render",Pa],["__scopeId","data-v-76ededaf"]]),La={props:{grid:{type:Boolean,default:!1},embed:{type:Boolean,default:!1},filter:{type:Object,default:()=>({})}},emits:["select"],inject:["debounce","url","srcset"],data(){return{items:[],term:"",sort:{column:"ID",order:"DESC"},page:1,last:1,limit:100,checked:!1,loading:!0,vgrid:!1}},setup(){const e=se(),t=_t();return{app:_e(),auth:t,messages:e}},created(){this.searchd=this.debounce(this.search,500),this.vgrid=this.grid,this.search()},computed:{canTrash(){return this.items.some(e=>e._checked&&!e.deleted_at)},isChecked(){return this.items.some(e=>e._checked)},isTrashed(){return this.items.some(e=>e._checked&&e.deleted_at)}},methods:{add(e){if(this.embed||!this.auth.can("file:add")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=[],i=e.target.files||e.dataTransfer.files||[];if(i.length)return Array.from(i).forEach(a=>{t.push(this.$apollo.mutate({mutation:z`mutation($file: Upload!) {
              addFile(file: $file) {
                id
                lang
                mime
                name
                path
                previews
                description
                transcription
                editor
                created_at
                updated_at
                deleted_at
              }
            }`,variables:{file:a},context:{hasUpload:!0}}).then(s=>{var n;if(s.errors)throw s.errors;const r=((n=s.data)==null?void 0:n.addFile)||{};return r.previews=JSON.parse(r.previews)||{},r.description=JSON.parse(r.description)||{},r.transcription=JSON.parse(r.transcription)||{},r.published=!0,this.items.unshift(r),this.$emit("select",r),r}).catch(s=>{this.messages.add(this.$gettext("Error adding file %{path}",{path:a.name}),"error"),this.$log("FileListItems::add(): Error adding file",e,s)}))}),Promise.all(t).then(()=>{this.invalidate()})},drop(e){if(!this.auth.can("file:drop")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:z`
            mutation($id: [ID!]!) {
              dropFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error trashing file"),"error"),this.$log("FileListItems::drop(): Error trashing file",e,i)})},invalidate(){const e=this.$apollo.provider.defaultClient.cache;e.evict({id:"ROOT_QUERY",fieldName:"files"}),e.gc()},keep(e){if(!this.auth.can("file:keep")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:z`
            mutation($id: [ID!]!) {
              keepFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;t.forEach(a=>{a.deleted_at=null}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error restoring file"),"error"),this.$log("FileListItems::keep(): Error restoring file",e,i)})},publish(e){if(!this.auth.can("file:publish")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked&&i.id&&!i.published);t.length&&this.$apollo.mutate({mutation:z`mutation ($id: [ID!]!) {
            pubFile(id: $id) {
              id
            }
          }`,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;t.forEach(a=>{a.published=!0,a._checked=!1}),this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error publishing file"),"error"),this.$log("FileListItems::publish(): Error publishing file",e,i)})},purge(e){if(!this.auth.can("file:purge")){this.messages.add(this.$gettext("Permission denied"),"error");return}const t=e?[e]:this.items.filter(i=>i._checked);t.length&&this.$apollo.mutate({mutation:z`
            mutation($id: [ID!]!) {
              purgeFile(id: $id) {
                id
              }
            }
          `,variables:{id:t.map(i=>i.id)}}).then(i=>{if(i.errors)throw i.errors;this.invalidate(),this.search()}).catch(i=>{this.messages.add(this.$gettext("Error purging file"),"error"),this.$log("FileListItems::purge(): Error purging file",e,i)})},search(){if(!this.auth.can("file:view"))return this.messages.add(this.$gettext("Permission denied"),"error"),Promise.resolve([]);const e=this.filter.publish||null,t=this.filter.trashed||"WITHOUT",i={...this.filter};return delete i.trashed,delete i.publish,this.term&&(i.any=this.term),this.loading=!0,this.$apollo.query({query:z`
            query($filter: FileFilter, $sort: [QueryFilesSortOrderByClause!], $limit: Int!, $page: Int!, $trashed: Trashed, $publish: Publish) {
              files(filter: $filter, sort: $sort, first: $limit, page: $page, trashed: $trashed, publish: $publish) {
                data {
                  id
                  lang
                  name
                  mime
                  path
                  previews
                  description
                  transcription
                  editor
                  created_at
                  updated_at
                  deleted_at
                  latest {
                    id
                    published
                    publish_at
                    data
                    editor
                    created_at
                  }
                }
                paginatorInfo {
                  lastPage
                }
              }
            }
          `,variables:{filter:i,page:this.page,limit:this.limit,sort:[this.sort],trashed:t,publish:e}}).then(a=>{var n;if(a.errors)throw a.errors;const s=a.data.files||{},r=["previews","description","transcription"];return this.last=((n=s.paginatorInfo)==null?void 0:n.lastPage)||1,this.items=[...s.data||[]].map(o=>{var u,l,d,p,D,y;const h=(u=o.latest)!=null&&u.data?JSON.parse((l=o.latest)==null?void 0:l.data):{...o,previews:JSON.parse(o.previews||"{}"),description:JSON.parse(o.description||"{}"),transcription:JSON.parse(o.transcription||"{}")};return r.forEach(M=>h[M]??(h[M]={})),Object.assign(h,{id:o.id,deleted_at:o.deleted_at,created_at:o.created_at,updated_at:((d=o.latest)==null?void 0:d.created_at)||o.updated_at,editor:((p=o.latest)==null?void 0:p.editor)||o.editor,published:((D=o.latest)==null?void 0:D.published)??!0,publish_at:((y=o.latest)==null?void 0:y.publish_at)||null,latest:o.latest})}),this.checked=!1,this.loading=!1,this.items}).catch(a=>{this.messages.add(this.$gettext("Error fetching files"),"error"),this.$log("FileListItems::search(): Error fetching files",a)})},title(e){const t=[];return e.publish_at&&t.push("Publish at: "+new Date(e.publish_at).toLocaleDateString()),t.join(`
`)},toggle(){this.items.forEach(e=>{e._checked=!e._checked})}},watch:{filter:{deep:!0,handler(){this.search()}},term(){this.searchd()},page(){this.search()},sort(){this.search()}}},Ba={class:"header"},Ua={class:"bulk"},Wa={class:"search"},za={class:"layout"},Ha=["onClick","title"],Ya=["onClick","title"],Fa={class:"item-text"},Xa={class:"item-head"},ja={key:0,class:"item-lang"},qa={class:"item-title"},Ga={class:"item-mime item-subtitle"},Ja={class:"item-aux"},Ka={class:"item-editor"},Qa={class:"item-modified item-subtitle"},Za={key:0,class:"loading"},tr={key:1,class:"notfound"},er={key:3,class:"btn-group"};function ir(e,t,i,a,s,r){return b(),$(q,null,[v("div",Ba,[v("div",Ua,[c(ve,{modelValue:s.checked,"onUpdate:modelValue":t[0]||(t[0]=n=>s.checked=n),onClick:t[1]||(t[1]=qt(n=>r.toggle(),["stop"]))},null,8,["modelValue"]),c(Dt,{location:"bottom left"},{activator:f(({props:n})=>[c(w,Ct(n,{disabled:!r.isChecked&&this.embed,"append-icon":"mdi-menu-down",variant:"text"}),{default:f(()=>[x(g(e.$gettext("Actions")),1)]),_:2},1040,["disabled"])]),default:f(()=>[c(xt,null,{default:f(()=>[r.isChecked&&a.auth.can("file:publish")?(b(),T(I,{key:0},{default:f(()=>[c(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:t[2]||(t[2]=n=>r.publish())},{default:f(()=>[x(g(e.$gettext("Publish")),1)]),_:1})]),_:1})):O("",!0),!this.embed&&a.auth.can("file:add")?(b(),T(I,{key:1},{default:f(()=>[c(w,{"prepend-icon":"mdi-folder-plus",variant:"text",onClick:t[3]||(t[3]=n=>e.$refs.upload.click())},{default:f(()=>[x(g(e.$gettext("Add files")),1)]),_:1})]),_:1})):O("",!0),r.canTrash&&a.auth.can("file:drop")?(b(),T(I,{key:2},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:t[4]||(t[4]=n=>r.drop())},{default:f(()=>[x(g(e.$gettext("Delete")),1)]),_:1})]),_:1})):O("",!0),r.isTrashed&&a.auth.can("file:keep")?(b(),T(I,{key:3},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:t[5]||(t[5]=n=>r.keep())},{default:f(()=>[x(g(e.$gettext("Restore")),1)]),_:1})]),_:1})):O("",!0),r.isChecked&&a.auth.can("file:purge")?(b(),T(I,{key:4},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:t[6]||(t[6]=n=>r.purge())},{default:f(()=>[x(g(e.$gettext("Purge")),1)]),_:1})]),_:1})):O("",!0)]),_:1})]),_:1})]),v("div",Wa,[c(Pe,{modelValue:s.term,"onUpdate:modelValue":t[7]||(t[7]=n=>s.term=n),label:e.$gettext("Search for"),"prepend-inner-icon":"mdi-magnify",variant:"underlined","hide-details":"",clearable:""},null,8,["modelValue","label"])]),v("div",za,[s.vgrid?O("",!0):(b(),T(w,{key:0,onClick:t[8]||(t[8]=n=>s.vgrid=!0),title:e.$gettext("Grid view"),icon:"mdi-view-grid-outline",variant:"flat"},null,8,["title"])),s.vgrid?(b(),T(w,{key:1,onClick:t[9]||(t[9]=n=>s.vgrid=!1),title:e.$gettext("List view"),icon:"mdi-format-list-bulleted-square",variant:"flat"},null,8,["title"])):O("",!0),c(Dt,{location:"bottom right"},{activator:f(({props:n})=>[c(w,Ct(n,{title:e.$gettext("Sort by"),"append-icon":"mdi-menu-down","prepend-icon":"mdi-sort",variant:"text"}),{default:f(()=>{var o,h,u;return[x(g(((o=s.sort)==null?void 0:o.column)==="ID"?((h=s.sort)==null?void 0:h.order)==="DESC"?e.$gettext("latest"):e.$gettext("oldest"):((u=s.sort)==null?void 0:u.column)||""),1)]}),_:2},1040,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[c(I,null,{default:f(()=>[c(w,{variant:"text",onClick:t[10]||(t[10]=n=>s.sort={column:"ID",order:"DESC"})},{default:f(()=>[x(g(e.$gettext("latest")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{variant:"text",onClick:t[11]||(t[11]=n=>s.sort={column:"ID",order:"ASC"})},{default:f(()=>[x(g(e.$gettext("oldest")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{variant:"text",onClick:t[12]||(t[12]=n=>s.sort={column:"NAME",order:"ASC"})},{default:f(()=>[x(g(e.$gettext("name")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{variant:"text",onClick:t[13]||(t[13]=n=>s.sort={column:"MIME",order:"ASC"})},{default:f(()=>[x(g(e.$gettext("mime")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{variant:"text",onClick:t[14]||(t[14]=n=>s.sort={column:"LANG",order:"ASC"})},{default:f(()=>[x(g(e.$gettext("language")),1)]),_:1})]),_:1}),c(I,null,{default:f(()=>[c(w,{variant:"text",onClick:t[15]||(t[15]=n=>s.sort={column:"EDITOR",order:"ASC"})},{default:f(()=>[x(g(e.$gettext("editor")),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),c(xt,{class:ht(["items",{grid:s.vgrid,list:!s.vgrid}])},{default:f(()=>[(b(!0),$(q,null,et(s.items,(n,o)=>(b(),T(I,{key:o},{default:f(()=>[c(ve,{modelValue:n._checked,"onUpdate:modelValue":h=>n._checked=h,class:ht([{draft:!n.published},"item-check"])},null,8,["modelValue","onUpdate:modelValue","class"]),c(Dt,{location:"bottom "+(s.vgrid?"right":"left")},{activator:f(({props:h})=>[c(w,Ct({ref_for:!0},h,{title:e.$gettext("Actions"),icon:"mdi-dots-vertical",class:"item-menu",variant:"text"}),null,16,["title"])]),default:f(()=>[c(xt,null,{default:f(()=>[gi(c(I,null,{default:f(()=>[c(w,{"prepend-icon":"mdi-publish",variant:"text",onClick:h=>r.publish(n)},{default:f(()=>[x(g(e.$gettext("Publish")),1)]),_:2},1032,["onClick"])]),_:2},1536),[[vi,!n.deleted_at&&!n.published&&a.auth.can("file:publish")]]),!n.deleted_at&&a.auth.can("file:drop")?(b(),T(I,{key:0},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete",variant:"text",onClick:h=>r.drop(n)},{default:f(()=>[x(g(e.$gettext("Delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),n.deleted_at&&a.auth.can("file:keep")?(b(),T(I,{key:1},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-restore",variant:"text",onClick:h=>r.keep(n)},{default:f(()=>[x(g(e.$gettext("Restore")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0),a.auth.can("file:purge")?(b(),T(I,{key:2},{default:f(()=>[c(w,{"prepend-icon":"mdi-delete-forever",variant:"text",onClick:h=>r.purge(n)},{default:f(()=>[x(g(e.$gettext("Purge")),1)]),_:2},1032,["onClick"])]),_:2},1024)):O("",!0)]),_:2},1024)]),_:2},1032,["location"]),v("div",{class:"item-preview",onClick:h=>e.$emit("select",n),title:r.title(n)},[n.previews?(b(),T(bi,{key:0,src:r.url(n.path),srcset:r.srcset(n.previews),alt:n.name},null,8,["src","srcset","alt"])):O("",!0)],8,Ha),v("div",{class:ht(["item-content",{trashed:n.deleted_at}]),onClick:h=>e.$emit("select",n),title:r.title(n)},[v("div",Fa,[v("div",Xa,[n.lang?(b(),$("span",ja,g(n.lang),1)):O("",!0),n.publish_at?(b(),T(Le,{key:1,class:"publish-at",icon:"mdi-clock-outline"})):O("",!0),v("span",qa,g(n.name),1)]),v("div",Ga,g(n.mime),1)]),v("div",Ja,[v("div",Ka,g(n.editor),1),v("div",Qa,g(new Date(n.updated_at).toLocaleString()),1)])],10,Ya)]),_:2},1024))),128))]),_:1},8,["class"]),s.loading?(b(),$("p",Za,[x(g(e.$gettext("Loading"))+" ",1),t[19]||(t[19]=v("svg",{class:"spinner",width:"32",height:"32",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[v("circle",{class:"spin1",cx:"4",cy:"12",r:"3"}),v("circle",{class:"spin1 spin2",cx:"12",cy:"12",r:"3"}),v("circle",{class:"spin1 spin3",cx:"20",cy:"12",r:"3"})],-1))])):O("",!0),!s.loading&&!s.items.length?(b(),$("p",tr,g(e.$gettext("No entries found")),1)):O("",!0),s.last>1?(b(),T(mi,{key:2,modelValue:s.page,"onUpdate:modelValue":t[16]||(t[16]=n=>s.page=n),length:s.last},null,8,["modelValue","length"])):O("",!0),!this.embed&&a.auth.can("file:add")?(b(),$("div",er,[v("input",{onChange:t[17]||(t[17]=n=>r.add(n)),ref:"upload",type:"file",multiple:"",hidden:""},null,544),c(w,{onClick:t[18]||(t[18]=n=>e.$refs.upload.click()),title:e.$gettext("Add files"),icon:"mdi-folder-plus",color:"primary"},null,8,["title"])])):O("",!0)],64)}const nr=Rt(La,[["render",ir],["__scopeId","data-v-a8247342"]]);export{nr as F,sr as a};
